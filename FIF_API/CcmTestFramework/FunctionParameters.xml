<?xml version="1.0" encoding="UTF-8"?>
<baseInclusion:TransformationIncludeRepository
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.arcor.de/transformer/SOMToFIFTransformationSchema"
  xmlns:baseInclusion="http://www.arcor.de/transformer/BaseInclusionSchema"
  xmlns:base="http://www.arcor.de/transformer/BaseTransformationSchema"

  xsi:schemaLocation="http://www.arcor.de/transformer/BaseInclusionSchema BaseInclusionSchema.xsd
  http://www.arcor.de/transformer/SOMToFIFTransformationSchema SOMToFIFTransformationSchema.xsd">

    <baseInclusion:Part id="installationServiceParameters">
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/desiredDate/configured" />
            </TemplateConditions>
            <RPMapping targetName="desiredDate" sourceAttrName="*/desiredDate/configured" formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>

        <RPMapping targetName="installationServiceCode"
            sourceAttrName="
            '${#:targetTechnology}' = 'FTTx' or
            '${#:targetTechnology}' = 'LTE' or
            '${#:targetTechnology}' = 'oneNetBusiness' or
            '${#:targetTechnology}' = '' and ('${#:currentTechnology}' = 'FTTx' or '${#:currentTechnology}' = 'LTE') or
            count(/*/*/*/ipCentrex) > 0 and name(../*[@ID = '${refFunctionID/*}']) != 'internet'"
            decoding="'true', 'VI060', 'V0277'" />

        <RPMapping sourceAttrName="refFunctionID" targetName="type" method="configuredExisting"/>
        <RPMapping targetName="installationPackage"
            sourceAttrName="*/installationPackage"
            method="configuredExisting"/>
        <RPMapping targetName="signatureRequiredIndicator"
            sourceAttrName="*/signatureRequiredIndicator"
            method="configuredExisting"
            decoding="'true', 'Y', 'N'" />
        <RPMapping targetName="contactPhoneNumber"
            sourceAttrName="*/contactPhoneNumber"
            method="configuredExisting"/>
        <RPMapping targetName="sundayService"
            sourceAttrName="*/sundayServiceIndicator"
            method="configuredExisting"
            decoding="'true', 'Y', 'N'" />
        <RPMapping targetName="quantity"
            sourceAttrName="*/quantity"
            method="configuredExisting" />
    </baseInclusion:Part>

    <baseInclusion:Part id="safetyPackageParameters">
        <RPMapping targetName="functionID" sourceAttrName="@ID" />
        <RPMapping targetName="customerNumber" sourceAttrName="#:targetCustomerNumber"/>
        <RPMapping targetName="tariff" sourceAttrName="*/pricingStructureCode" method="configuredExisting" />
        <base:Include fileIDRef="functionParameters" partIDRef="providerTrackingNumberCreation"/>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="true" sourceAttrName="#:isProductChangeScenario" />
            </TemplateConditions>
            <RPMapping sourceAttrName="/*/*/accesses/*[@ID='${#:currentMainAccessID}']/ccbId[@type='S']/existing"
                targetName="serviceSubscriptionId" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="#:isProductChangeScenario" />
            </TemplateConditions>
            <RPMapping sourceAttrName="../voice[@refAccessID='${#:currentMainAccessID}']/@ID" targetName="type"/>
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="/*/*/parentBarcode" />
            </TemplateConditions>
            <RPMapping targetName="OMTSOrderID" sourceAttrName="/*/*/parentBarcode" />
        </TransformationTemplate>

        <RPMapping targetName="primaryCustSignName"
            sourceAttrName="*/primaryCustSignName"
            method="configuredExisting" />
        <RPMapping targetName="primaryCustSignDate"
            sourceAttrName="*/primaryCustSignDate"
            method="configuredExisting"
            formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="minPeriodDurationValue"
            sourceAttrName="*/minimumDurationPeriod/value"
            method="configuredExisting" />
        <RPMapping targetName="minPeriodDurationUnit"
            sourceAttrName="*/minimumDurationPeriod/unit"
            method="configuredExisting" />
        <RPMapping targetName="autoExtentPeriodValue"
            sourceAttrName="*/autoExtension/value"
            method="configuredExisting" />
        <RPMapping targetName="autoExtentPeriodUnit"
            sourceAttrName="*/autoExtension/unit"
            method="configuredExisting" />
        <RPMapping targetName="autoExtensionInd"
            sourceAttrName="*/autoExtension/autoExtensionIndicator"
            method="configuredExisting"
            decoding="'true', 'Y', 'N'" />
        <RPMapping targetName="terminationRestriction"
            sourceAttrName="*/noticePeriod/noticeRestriction"
            method="configuredExisting" />
    </baseInclusion:Part>

    <baseInclusion:Part id="tvCenterParameters">
        <RPMapping targetName="functionID" sourceAttrName="@ID" />
        <RPMapping targetName="accountNumber" sourceAttrName="#:targetAccountNumber"/>
        <RPMapping targetName="customerNumber" sourceAttrName="#:targetCustomerNumber"/>
        <base:Include fileIDRef="functionParameters" partIDRef="providerTrackingNumberCreation"/>

        <!-- orderVariant depending on orderPositionType -->
        <RPMapping targetName="orderVariant"
            sourceAttrName="name(../..)"
            decoding="'relocation', 'Umzug', 'Echte Neuanschaltung'" />

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/*/configured" />
            </TemplateConditions>
            <RPMapping targetName="multimediaType"
                sourceAttrName="name(tvCenterBundledConfiguration/*/configured/../.. | tvCenterStandaloneConfiguration/*/configured/../..)"
                decoding="'tvCenterBundledConfiguration', 'TV_CENTER', 'tvCenterStandaloneConfiguration', 'TV_CENTER_SA'" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/*/configured" />
            </TemplateConditions>
            <RPMapping targetName="multimediaType"
                sourceAttrName="name(tvCenterBundledConfiguration/*/existing/../.. | tvCenterStandaloneConfiguration/*/existing/../..)"
                decoding="'tvCenterBundledConfiguration', 'TV_CENTER', 'tvCenterStandaloneConfiguration', 'TV_CENTER_SA'" />
        </TransformationTemplate>

        <RPMapping targetName="multimediaProduct"
            sourceAttrName="/*/*/accesses/*/*/multimediaPort"
            method="configuredExisting"/>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="../../accesses/*/*/locationAddress/configured" />
            </TemplateConditions>
            <RPMapping targetName="streetName" sourceAttrName="../../accesses/*/*/locationAddress/configured/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="../../accesses/*/*/locationAddress/configured/streetNumber" />
            <RPMapping targetName="postalCode" sourceAttrName="../../accesses/*/*/locationAddress/configured/postalCode" />
            <RPMapping targetName="city" sourceAttrName="../../accesses/*/*/locationAddress/configured/city" />
            <RPMapping targetName="citySuffix" sourceAttrName="../../accesses/*/*/locationAddress/configured/citySuffix" />
            <RPMapping targetName="additionalText" sourceAttrName="../../accesses/*/*/locationAddress/configured/additionalAddressDescription" />
            <RPMapping targetName="numberSuffix" sourceAttrName="../../accesses/*/*/locationAddress/configured/streetNumberSuffix" />
            <RPMapping targetName="countryCode" sourceAttrName="../../accesses/*/*/locationAddress/configured/country" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="../../accesses/*/*/locationAddress/configured" />
            </TemplateConditions>
            <RPMapping targetName="streetName" sourceAttrName="../../accesses/*/*/locationAddress/existing/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="../../accesses/*/*/locationAddress/existing/streetNumber" />
            <RPMapping targetName="postalCode" sourceAttrName="../../accesses/*/*/locationAddress/existing/postalCode" />
            <RPMapping targetName="city" sourceAttrName="../../accesses/*/*/locationAddress/existing/city" />
            <RPMapping targetName="citySuffix" sourceAttrName="../../accesses/*/*/locationAddress/existing/citySuffix" />
            <RPMapping targetName="additionalText" sourceAttrName="../../accesses/*/*/locationAddress/existing/additionalAddressDescription" />
            <RPMapping targetName="numberSuffix" sourceAttrName="../../accesses/*/*/locationAddress/existing/streetNumberSuffix" />
            <RPMapping targetName="countryCode" sourceAttrName="../../accesses/*/*/locationAddress/existing/country" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="@targetAccessID" />
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="isdn" sourceAttrName="name(../../accesses/*[@ID='${@targetAccessID}'])" />
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="../voice/@ID" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotMember value="isdn" sourceAttrName="name(../../accesses/*[@ID='${@targetAccessID}'])" />
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="../internet/@ID" />
            </TransformationTemplate>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="@targetAccessID" />
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="isdn" sourceAttrName="name(../../accesses/*[@ID='${@refAccessID}'])" />
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="../voice[@refAccessID='${#:currentMainAccessID}']/@ID" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotMember value="isdn" sourceAttrName="name(../../accesses/*[@ID='${@refAccessID}'])" />
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="../internet[@refAccessID='${#:currentMainAccessID}']/@ID" />
            </TransformationTemplate>
        </TransformationTemplate>

        <RPMapping targetName="tariff"
            sourceAttrName="*/pricingStructureCode"
            method="configuredExisting" />
        <RPMapping targetName="allowPartialCancel"
            sourceAttrName="*/allowPartialCancel"
            method="configuredExisting"
            decoding="'true', 'ja', 'false', 'nein'"/>
        <RPMapping targetName="FSKLevel"
            sourceAttrName="*/fskLevel"
            method="configuredExisting" />
        <RPMapping targetName="initialOrderType"
            sourceAttrName="*/initialOrderType"
            method="configuredExisting" />

        <RPMapping targetName="primaryCustSignName"
            sourceAttrName="*/primaryCustSignName"
            method="configuredExisting"/>
        <RPMapping targetName="primaryCustSignDate"
            sourceAttrName="*/primaryCustSignDate"
            formatter="SOMToCCBDateFormatter"
            method="configuredExisting"/>
        <RPMapping targetName="minPeriodDurationValue"
            sourceAttrName="*/minimumDurationPeriod/value"
            method="configuredExisting"/>
        <RPMapping targetName="minPeriodDurationUnit"
            sourceAttrName="*/minimumDurationPeriod/unit"
            method="configuredExisting"/>
        <RPMapping targetName="termStartDate"
            sourceAttrName="*/minimumDurationPeriod/startDate"
            formatter="SOMToCCBDateFormatter"
            method="configuredExisting"/>
        <RPMapping targetName="autoExtentPeriodValue"
            sourceAttrName="*/autoExtension/value"
            method="configuredExisting"/>
        <RPMapping targetName="autoExtentPeriodUnit"
            sourceAttrName="*/autoExtension/unit"
            method="configuredExisting"/>
        <RPMapping targetName="autoExtensionInd"
            sourceAttrName="*/autoExtension/autoExtensionIndicator"
            decoding="'true', 'Y', 'N'"
            method="configuredExisting"/>
        <RPMapping targetName="specialTerminationRight"
            sourceAttrName="*/specialTerminationRight"
            decoding="'true', 'Y', 'N'"
            method="configuredExisting"/>
        <RPMapping targetName="terminationRestriction"
            sourceAttrName="*/noticePeriod/noticeRestriction"
            method="configuredExisting"/>
        <RPMapping targetName="VISTrackingPosition"
            sourceAttrName="*/visTrackingPosition"
            method="configuredExisting"/>
    </baseInclusion:Part>

    <baseInclusion:Part id="directoryEntryParameters">

        <RPMapping targetName="serviceCode"
            sourceAttrName="
            '${#:technology}' = 'sipTrunk' or
            '${#:technology}' = 'businessVoip' or
            '${#:targetTechnology}' = 'LTE' or
            '${#:targetTechnology}' = '' and '${#:currentTechnology}' = 'LTE'"
            decoding="'true', 'V0327', 'V0100'" />

        <RPMapping targetName="customerNumber" sourceAttrName="#:targetCustomerNumber"/>
        <RPMapping targetName="directoryEntryText" sourceAttrName="*/directoryEntryText/configured" />
        <RPMapping targetName="DTAGID" sourceAttrName="*/dtagId/configured" />
        <RPMapping targetName="type" sourceAttrName="refFunctionID" method="configuredExisting" />
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/name/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="name" sourceAttrName="*/name" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/forename/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="forename" sourceAttrName="*/forename" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/nobilityPrefixDescription/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="nobilityPrefixDescription" sourceAttrName="*/nobilityPrefixDescription" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/titleDescription/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="titleDescription" sourceAttrName="*/titleDescription" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/surnamePrefix/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="surnamePrefix" sourceAttrName="*/surnamePrefix" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/profession/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="profession" sourceAttrName="*/profession" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="count(*/industrialSectorRd/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="industrialSectorRd" sourceAttrName="*/industrialSectorRd" method="configuredExisting" />
        </TransformationTemplate>
        
        <RPMapping targetName="directoryEntryType" sourceAttrName="*/directoryEntryType" method="configuredExisting" />
        <RPMapping targetName="inverseSearchIndicator"
            sourceAttrName="*/inverseSearchIndicator"
            method="configuredExisting"
            decoding="'true','J','N'" />

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/listedAddress/configured" />
                <base:IsMember value="true" sourceAttrName="count(*/listedAddress/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="additionalText" sourceAttrName="*/listedAddress/configured/additionalAddressDescription" />
            <RPMapping targetName="streetName" sourceAttrName="*/listedAddress/configured/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="*/listedAddress/configured/streetNumber" />
            <RPMapping targetName="numberSuffix" sourceAttrName="*/listedAddress/configured/streetNumberSuffix" />
            <RPMapping targetName="postalCode" sourceAttrName="*/listedAddress/configured/postalCode" />
            <RPMapping targetName="city" sourceAttrName="*/listedAddress/configured/city" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/listedAddress/configured" />
                <base:IsMember value="true" sourceAttrName="count(*/listedAddress/@action) = 0" />
            </TemplateConditions>
            <RPMapping targetName="additionalText" sourceAttrName="*/listedAddress/existing/additionalAddressDescription" />
            <RPMapping targetName="streetName" sourceAttrName="*/listedAddress/existing/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="*/listedAddress/existing/streetNumber" />
            <RPMapping targetName="numberSuffix" sourceAttrName="*/listedAddress/existing/streetNumberSuffix" />
            <RPMapping targetName="postalCode" sourceAttrName="*/listedAddress/existing/postalCode" />
            <RPMapping targetName="city" sourceAttrName="*/listedAddress/existing/city" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/listedPhoneNumber/configured" />
            </TemplateConditions>
            <RPMapping targetName="countryCode" sourceAttrName="*/listedPhoneNumber/configured/countryCode" />
            <RPMapping targetName="areaCode" sourceAttrName="*/listedPhoneNumber/configured/localAreaCode" />
            <RPMapping targetName="localNumber" sourceAttrName="*/listedPhoneNumber/configured/pilotNumber" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/listedPhoneNumber/configured" />
            </TemplateConditions>
            <RPMapping targetName="countryCode" sourceAttrName="*/listedPhoneNumber/existing/countryCode" />
            <RPMapping targetName="areaCode" sourceAttrName="*/listedPhoneNumber/existing/localAreaCode" />
            <RPMapping targetName="localNumber" sourceAttrName="*/listedPhoneNumber/existing/pilotNumber" />
        </TransformationTemplate>
    </baseInclusion:Part>

    <baseInclusion:Part id="hardwareParameters">

        <RPMapping targetName="functionID" sourceAttrName="@ID" />
        <RPMapping targetName="isRentedHardware" 
        	sourceAttrName="count(rentedHardwareConfiguration) > 0 or 
        		count(*/hardwareServiceCode/configured) > 0 and */hardwareServiceCode/configured = 'I1359' or 
        		count(*/hardwareServiceCode/configured) = 0 and */hardwareServiceCode/existing = 'I1359' or
        		count(*/hardwareServiceCode) = 0 and */hardwareType/configured = 'STB'"
        	decoding="'true', 'Y', 'false', 'N'"/>
        
        <RPMapping targetName="shippingCosts" sourceAttrName="*/shippingCosts" method="configuredExisting"/>
        <RPMapping targetName="articleNumber" 
            sourceAttrName="*/articleNumber" 
            method="configuredExisting" 
            decoding="'undefine', 'undefined'"/>
        <RPMapping targetName="articleName" sourceAttrName="*/articleName" method="configuredExisting" />
        <RPMapping targetName="imei" sourceAttrName="*/imei" method="configuredExisting" />
        <RPMapping targetName="sapActionCode" sourceAttrName="*/sapActionCode" method="configuredExisting" />
        <RPMapping targetName="sapOrderId" sourceAttrName="*/sapOrderId" method="configuredExisting" />
        <RPMapping targetName="serialNumber" sourceAttrName="*/serialNumber" method="configuredExisting" />
        <RPMapping targetName="simSerialNumber" sourceAttrName="*/simSerialNumber" method="configuredExisting" />
        <RPMapping targetName="deliveryNoteNumber" sourceAttrName="*/deliveryNoteNumber" method="configuredExisting" />
        <RPMapping targetName="remarkForTechnician" sourceAttrName="*/remarksForTechnician" method="configuredExisting" />

		<!-- read deliveryDate from the respective element, if available and from resultDate for added hardware otherwise -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/deliveryDate"/>
            </TemplateConditions>
            <RPMapping targetName="deliveryDate" sourceAttrName="*/deliveryDate" method="configuredExisting" formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/deliveryDate"/>
                <base:IsMember value="ADD" sourceAttrName="processingType" />
            </TemplateConditions>
            <RPMapping targetName="deliveryDate" sourceAttrName="resultDate" formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="
                	count (*/quantityOfPartiallyExchangedHardware) > 0 and 
                	*/quantityOfPartiallyExchangedHardware != */quantity/existing"/>
            </TemplateConditions>
            <RPMapping targetName="quantity" sourceAttrName="*/quantityOfPartiallyExchangedHardware" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="true" sourceAttrName="
                	count (*/quantityOfPartiallyExchangedHardware) > 0 and 
                	*/quantityOfPartiallyExchangedHardware != */quantity/existing"/>
            </TemplateConditions>
            <RPMapping targetName="quantity" sourceAttrName="*/quantity" method="configuredExisting" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsExisting sourceAttrName="refFunctionID/configured" />
                    <base:IsNotMember value="true" sourceAttrName="#:isTechnologyChange" />
                </OrComposite>
            </TemplateConditions>
            <RPMapping targetName="type" sourceAttrName="refFunctionID" method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="refFunctionID/configured" />
                <base:IsMember value="true" sourceAttrName="#:isTechnologyChange" />
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <OrComposite>
                        <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology" />
                        <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology" />
                    </OrComposite>
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="../voice[@refAccessID = '${#:currentMainAccessID}']/@ID" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <OrComposite>
                        <base:IsMember value="ISDN" sourceAttrName="#:currentTechnology" />
                        <base:IsMember value="ISDNP2P" sourceAttrName="#:currentTechnology" />
                    </OrComposite>
                    <base:IsNotMember value="ISDN" sourceAttrName="#:targetTechnology" />
                    <base:IsNotMember value="ISDNP2P" sourceAttrName="#:targetTechnology" />
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="../internet[@refAccessID = '${#:currentMainAccessID}']/@ID" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotMember value="ISDN" sourceAttrName="#:currentTechnology" />
                    <base:IsNotMember value="ISDN" sourceAttrName="#:targetTechnology" />
                    <base:IsNotMember value="ISDNP2P" sourceAttrName="#:currentTechnology" />
                    <base:IsNotMember value="ISDNP2P" sourceAttrName="#:targetTechnology" />
                </TemplateConditions>
                <RPMapping targetName="type" sourceAttrName="refFunctionID" method="configuredExisting" />
            </TransformationTemplate>
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="ADD" sourceAttrName="processingType" />
                <OrComposite>
                    <base:IsNotMember value="contractPartnerChange" sourceAttrName="name(../..) " />
                    <base:IsNotMember value="I1359" sourceAttrName="*/hardwareServiceCode/existing" />
                </OrComposite>
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="*/orderReason/configured" />
                </TemplateConditions>
                <RPMapping targetName="orderReason" sourceAttrName="*/orderReason/configured" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="*/orderReason/configured" />
                </TemplateConditions>
                <RPMapping targetName="orderReason" staticValue="Doku - Kein Versand" />
            </TransformationTemplate>
        </TransformationTemplate>
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="ADD" sourceAttrName="processingType" />
                <base:IsMember value="contractPartnerChange" sourceAttrName="name(../..) " />
                <base:IsMember value="I1359" sourceAttrName="*/hardwareServiceCode/existing" />
            </TemplateConditions>
            <RPMapping targetName="orderReason" staticValue="Backendversand TV" />
        </TransformationTemplate>
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="ADD" sourceAttrName="processingType" />
            </TemplateConditions>
            <RPMapping targetName="orderReason" sourceAttrName="*/orderReason" method="configuredExisting" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/hardwareServiceCode" />
            </TemplateConditions>
            <base:DataBufferWriter keyValue="hardwareServiceCodeConfiguredExisting"
                sourceAttrName="count(*/hardwareServiceCode/configured) > 0"
                decoding="'true', 'configured', 'existing'" />
            <base:DataBufferWriter keyValue="hardwareServiceCodeSOM"
                sourceAttrName="*/hardwareServiceCode/${#:hardwareServiceCodeConfiguredExisting}" />            
            <base:DataBufferWriter keyValue="hardwareServiceCode"
                sourceAttrName="#:hardwareServiceCodeSOM"
                decoding="'V0330','V011A', 'V0328','V0114'"/>
            <RPMapping targetName="hardwareServiceCode" sourceAttrName="#:hardwareServiceCode" />
            
            <base:DataBufferWriter keyValue="refFunctionIDConfiguredExisting"
                sourceAttrName="count(refFunctionID/configured) > 0"
                decoding="'true', 'configured', 'existing'" />
            <base:DataBufferWriter keyValue="referencedAccess"
                sourceAttrName="name(../../accesses/*[@ID = '${../*[@ID = '${refFunctionID/${#:refFunctionIDConfiguredExisting}}']/@refAccessID}'])" />
            <base:DataBufferWriter keyValue="referencedAccessConfig"
                sourceAttrName="substring-before(name(../../accesses/*[@ID = '${/*/*/functions/*[@ID = '${refFunctionID/*}']/@refAccessID}']/*[contains(name(.), 'Configuration')]), 'Configuration')" />
            
            <TransformationTemplate>
                <TemplateConditions>
                	<AndComposite>	
                	<OrComposite>
                    		<base:IsMember value="LTE" sourceAttrName="#:targetTechnology" />
                    		<base:IsMember value="businessIpBitstream" sourceAttrName="#:referencedAccessConfig" />
                    </OrComposite>
                    <base:IsNotMember value="sip" sourceAttrName="#:referencedAccess"/>
                    <base:IsNotMember value="mobile" sourceAttrName="#:referencedAccess"/>
                    </AndComposite>
                </TemplateConditions>
                <RPMapping targetName="isDependentService" 
                    sourceAttrName="#:hardwareServiceCode"
                    decoding="'I1350', 'N', 'I1359', 'N', 'Y'" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <OrComposite>
                    	<AndComposite>
                    		<base:IsNotMember value="LTE" sourceAttrName="#:targetTechnology" />
                    		<base:IsNotMember value="businessIpBitstream" sourceAttrName="#:referencedAccessConfig" />
                    	</AndComposite>
                        <base:IsMember value="sip" sourceAttrName="#:referencedAccess"/>
                        <base:IsMember value="mobile" sourceAttrName="#:referencedAccess"/>
                    </OrComposite>
                </TemplateConditions>
                <RPMapping targetName="isDependentService" 
                    sourceAttrName="#:hardwareServiceCode"
                    decoding="'V0114', 'N', 'I1350', 'N', 'I1359', 'N', 'Y'" />
            </TransformationTemplate>
        </TransformationTemplate>
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/hardwareServiceCode" />
            </TemplateConditions>
            
            <base:DataBufferWriter keyValue="isLTEFTTx"
                sourceAttrName="'${#:targetTechnology}' = 'LTE' or '${#:targetTechnology}' = 'FTTx'" />            
            <RPMapping targetName="isDependentService" 
                sourceAttrName="concat(*/hardwareType/configured, ';', '${#:isLTEFTTx}')"
                decoding="
                'STB;true', 'N', 
                'STB;false', 'N', 
                'EG;false', 'N', 
                'Y'" />
            
            <RPMapping targetName="hardwareServiceCode"
                sourceAttrName="*/hardwareType/configured"
                decoding="
                'IAD', 'V011A',
                'STB', 'I1359',
                'EG', 'V0114',
                'TVEG', 'V011A',
                'V0114'" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/subventionCode" />
            </TemplateConditions>
            <RPMapping targetName="subventionIndicator" sourceAttrName="*/subventionCode" method="configuredExisting"/>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/subventionCode" />
            </TemplateConditions>
            <RPMapping targetName="subventionIndicator"
                sourceAttrName="*/subventionIndicator"
                decoding="'true','1','false','0'"
                method="configuredExisting"/>
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/hardwareRecipient/*" />
            </TemplateConditions>
            <RPMapping targetName="hardwareDeliverySalutation" sourceAttrName="*/hardwareRecipient/*/salutationDescription" />
            <RPMapping targetName="hardwareDeliveryForename" sourceAttrName="*/hardwareRecipient/*/forename" />
            <RPMapping targetName="hardwareDeliverySurname" sourceAttrName="*/hardwareRecipient/*/name" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/name/*" />
                <base:IsNotExisting sourceAttrName="*/hardwareRecipient/*" />
            </TemplateConditions>
            <RPMapping targetName="hardwareDeliverySalutation" sourceAttrName="*/salutationDescription/*" />
            <RPMapping targetName="hardwareDeliveryForename" sourceAttrName="*/forename/*" />
            <RPMapping targetName="hardwareDeliverySurname" sourceAttrName="*/name/*" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/name/*" />
                <base:IsNotExisting sourceAttrName="*/hardwareRecipient/*" />
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="../../beneficiary/targetCustomerNodeRefID" />
                </TemplateConditions>
                <RPMapping targetName="hardwareDeliverySalutation" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/salutation/*" />
                <RPMapping targetName="hardwareDeliveryForename" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/forename/*" />
                <RPMapping targetName="hardwareDeliverySurname" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/name/*" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="../../beneficiary/targetCustomerNodeRefID" />
                </TemplateConditions>
                <RPMapping targetName="hardwareDeliverySalutation" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/salutation/*" />
                <RPMapping targetName="hardwareDeliveryForename" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/forename/*" />
                <RPMapping targetName="hardwareDeliverySurname" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/name/*" />
            </TransformationTemplate>
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/hardwareMailingAddress" />
            </TemplateConditions>
            <RPMapping targetName="hardwareDeliveryCity" sourceAttrName="*/hardwareMailingAddress/*/city" />
            <RPMapping targetName="hardwareDeliveryPostalCode" sourceAttrName="*/hardwareMailingAddress/*/postalCode" />
            <RPMapping targetName="hardwareDeliveryStreet" sourceAttrName="*/hardwareMailingAddress/*/street" />
            <RPMapping targetName="hardwareDeliveryNumber" sourceAttrName="*/hardwareMailingAddress/*/streetNumber" />
            <RPMapping targetName="hardwareDeliveryNumberSuffix" sourceAttrName="*/hardwareMailingAddress/*/streetNumberSuffix" />
            <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/hardwareMailingAddress" />
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="../../beneficiary/targetCustomerNodeRefID" />
                </TemplateConditions>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsExisting sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured" />
                    </TemplateConditions>
                    <RPMapping targetName="hardwareDeliveryCity" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured/city" />
                    <RPMapping targetName="hardwareDeliveryPostalCode" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured/postalCode" />
                    <RPMapping targetName="hardwareDeliveryStreet" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured/street" />
                    <RPMapping targetName="hardwareDeliveryNumber" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured/streetNumber" />
                    <RPMapping targetName="hardwareDeliveryNumberSuffix" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured/streetNumberSuffix" />
                    <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsNotExisting sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/configured" />
                    </TemplateConditions>
                    <RPMapping targetName="hardwareDeliveryCity" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/existing/city" />
                    <RPMapping targetName="hardwareDeliveryPostalCode" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/existing/postalCode" />
                    <RPMapping targetName="hardwareDeliveryStreet" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/existing/street" />
                    <RPMapping targetName="hardwareDeliveryNumber" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/existing/streetNumber" />
                    <RPMapping targetName="hardwareDeliveryNumberSuffix" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/customerNodeRefID}']/*/address/existing/streetNumberSuffix" />
                    <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
                </TransformationTemplate>
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="../../beneficiary/targetCustomerNodeRefID" />
                </TemplateConditions>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsExisting sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured" />
                    </TemplateConditions>
                    <RPMapping targetName="hardwareDeliveryCity" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured/city" />
                    <RPMapping targetName="hardwareDeliveryPostalCode" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured/postalCode" />
                    <RPMapping targetName="hardwareDeliveryStreet" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured/street" />
                    <RPMapping targetName="hardwareDeliveryNumber" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured/streetNumber" />
                    <RPMapping targetName="hardwareDeliveryNumberSuffix" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured/streetNumberSuffix" />
                    <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsNotExisting sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/configured" />
                    </TemplateConditions>
                    <RPMapping targetName="hardwareDeliveryCity" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/existing/city" />
                    <RPMapping targetName="hardwareDeliveryPostalCode" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/existing/postalCode" />
                    <RPMapping targetName="hardwareDeliveryStreet" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/existing/street" />
                    <RPMapping targetName="hardwareDeliveryNumber" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/existing/streetNumber" />
                    <RPMapping targetName="hardwareDeliveryNumberSuffix" sourceAttrName="/*/*/customer[@ID='${../../beneficiary/targetCustomerNodeRefID}']/*/address/existing/streetNumberSuffix" />
                    <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
                </TransformationTemplate>
            </TransformationTemplate>
        </TransformationTemplate>
    </baseInclusion:Part>

    <!-- template for all product change scenarios (aka clone scenarios):
       - relocation
       - technology change
       - product type change (former trx upgradeToPremium and downgradeToBasis)
       - provider change
       - contract partner change
    -->
    <baseInclusion:Part id="productChangeParameters">
        <RPMapping targetName="voiceFunctionID" sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/@ID" />
        <RPMapping targetName="providerTrackingNumberVoiceDefault" 
            sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'default']/configured" />
        <RPMapping targetName="providerTrackingNumberVoiceTarget" 
            sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'target']/configured" />
        <RPMapping targetName="providerTrackingNumberVoiceChange" 
            sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'change']/configured" />        
        
        <RPMapping targetName="internetFunctionID" sourceAttrName="*/internet[@refAccessID = '${#:currentMainAccessID}']/@ID" />
        <RPMapping targetName="providerTrackingNumberInternetDefault" 
            sourceAttrName="*/internet[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'default']/configured" />
        <RPMapping targetName="providerTrackingNumberInternetTarget" 
            sourceAttrName="*/internet[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'target']/configured" />
        <RPMapping targetName="providerTrackingNumberInternetChange" 
            sourceAttrName="*/internet[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'change']/configured" />

        <RPMapping targetName="providerTrackingNumberDirectoryEntryTarget" 
            sourceAttrName="*/directoryEntry[@refAccessID = '${#:currentMainAccessID}']/providerTrackingNumber[@type = 'target']/configured" />

        <RPMapping targetName="tariffDSL" sourceAttrName="*/internet[@refAccessID = '${#:currentMainAccessID}']/*/pricingStructureCode" method="configuredExisting" />
        <RPMapping targetName="tariffVoice" sourceAttrName="*/voice[@refAccessID='${#:currentMainAccessID}']/*/pricingStructureCode" method="configuredExisting" />
        <RPMapping targetName="currentTechnology" sourceAttrName="#:currentTechnology" />

        <RPMapping targetName="pricingStructureBillingName"
            sourceAttrName="concat('Internet: ', */internet[@refAccessID = '${#:currentMainAccessID}']/*/pricingStructureBillingName/configured,
            ' . Voice: ', */voice[@refAccessID = '${#:currentMainAccessID}']/*/pricingStructureBillingName/configured)" />

        <!-- contract conditions -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="contractPartnerChange" sourceAttrName="name(.)" />
            </TemplateConditions>
            <RPMapping targetName="primaryCustSignName"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/primaryCustSignName"
                method="configuredExisting" />
            <!-- TODO server cannot handle new termStartDate yet. Therefore only consider configured minimum durations -->
            <RPMapping targetName="minPeriodDurationValue"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/minimumDurationPeriod/value/configured" />
            <RPMapping targetName="minPeriodDurationUnit"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/minimumDurationPeriod/unit"
                method="configuredExisting" />
            <RPMapping targetName="termStartDate"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/minimumDurationPeriod/startDate"
                method="configuredExisting"
                formatter="SOMToCCBDateFormatter" />
            <RPMapping targetName="autoExtentPeriodValue"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/autoExtension/value"
                method="configuredExisting" />
            <RPMapping targetName="autoExtentPeriodUnit"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/autoExtension/unit"
                method="configuredExisting" />
            <RPMapping targetName="autoExtensionInd"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/autoExtension/autoExtensionIndicator"
                method="configuredExisting"
                decoding="'true', 'Y', 'N'" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="contractPartnerChange" sourceAttrName="name(.)" />
            </TemplateConditions>
            <RPMapping targetName="primaryCustSignName"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/primaryCustSignName/configured"/>
            <RPMapping targetName="minPeriodDurationValue"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/minimumDurationPeriod/value/configured"/>
            <RPMapping targetName="minPeriodDurationUnit"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/minimumDurationPeriod/unit/configured"/>
            <RPMapping targetName="termStartDate"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/minimumDurationPeriod/startDate/configured"
                formatter="SOMToCCBDateFormatter" />
            <RPMapping targetName="autoExtentPeriodValue"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/autoExtension/value/configured"/>
            <RPMapping targetName="autoExtentPeriodUnit"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/autoExtension/unit/configured" />
            <RPMapping targetName="autoExtensionInd"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/autoExtension/autoExtensionIndicator/configured"
                decoding="'true', 'Y', 'N'" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="'${#:targetTechnology}' = ''" />
            </TemplateConditions>
            <RPMapping targetName="targetTechnology" sourceAttrName="#:currentTechnology" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="false" sourceAttrName="'${#:targetTechnology}' = ''" />
            </TemplateConditions>
            <RPMapping targetName="targetTechnology" sourceAttrName="#:targetTechnology" />
        </TransformationTemplate>
        <RPMapping targetName="currentProductType" sourceAttrName="#:currentProductType" />

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="'${#:targetProductType}' != ''" />
            </TemplateConditions>
            <RPMapping targetName="targetProductType" sourceAttrName="#:targetProductType" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="true" sourceAttrName="'${#:targetProductType}' != ''" />
            </TemplateConditions>
            <RPMapping targetName="targetProductType" sourceAttrName="#:currentProductType" />
        </TransformationTemplate>

        <!-- main access service subscription -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="ISDN" sourceAttrName="#:currentTechnology" />
            </TemplateConditions>
            <RPMapping targetName="serviceSubscriptionId" sourceAttrName="*/voice[@refAccessID='${#:currentMainAccessID}']/ccbId[@type='S']/existing" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="ISDN" sourceAttrName="#:currentTechnology" />
            </TemplateConditions>
            <RPMapping targetName="serviceSubscriptionId" sourceAttrName="*/internet[@refAccessID='${#:currentMainAccessID}']/ccbId[@type='S']/existing" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="relocation" sourceAttrName="name(.)" />
            </TemplateConditions>
            <RPMapping targetName="keepAccessNumbers"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/*/keepExistingNumbers/configured"
                decoding="'false','N','Y'" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="relocation" sourceAttrName="name(.)" />
            </TemplateConditions>
            <RPMapping targetName="keepAccessNumbers"
                sourceAttrName="keepFixedNumbersIndicator"
                decoding="'false','N','Y'" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/*/numberOfNewAccessNumbers/configured" />
            </TemplateConditions>
            <RPMapping targetName="numberOfNewAccessNumbers"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/*/numberOfNewAccessNumbers/configured" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/*/numberOfNewAccessNumbers/configured" />
            </TemplateConditions>
            <RPMapping targetName="numberOfNewAccessNumbers" staticValue="0" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="Premium" sourceAttrName="#:targetProductType" />
            </TemplateConditions>
            <RPMapping targetName="desiredPremiumType"
                sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/connectionType/configured"
                decoding="'comfortClassic', 'Classic', 'comfortPlus', 'Plus'" />
            <RPMapping targetName="allowPremiumTypeChange" sourceAttrName="*/voice[@refAccessID = '${#:currentMainAccessID}']/*/allowPremiumTypeChange/configured" decoding="'true','Ja','Nein'" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="Basis" sourceAttrName="#:targetProductType" />
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="*/*[@refAccessID='${#:currentMainAccessID}']/voiceBasisConfiguration/portingAccessNumbers/*[configured = 'bernehmen']" />
                </TemplateConditions>
                <base:DataBufferWriter keyValue="selectedAccessNumber"
                    sourceAttrName="substring-after(name(*/*[@refAccessID='${#:currentMainAccessID}']/voiceBasisConfiguration/portingAccessNumbers/*[configured = 'bernehmen']), 'portingMode')"/>
                <RPListTemplate listName="accessNumberList">
                    <RPListItemTemplate>
                        <RPMapping sourceAttrName="*/*[@refAccessID='${#:currentMainAccessID}']/*/*/accessNumber${#:selectedAccessNumber}/existing/countryCode" targetName="countryCode" />
                        <RPMapping sourceAttrName="*/*[@refAccessID='${#:currentMainAccessID}']/*/*/accessNumber${#:selectedAccessNumber}/existing/localAreaCode" targetName="areaCode" />
                        <RPMapping sourceAttrName="*/*[@refAccessID='${#:currentMainAccessID}']/*/*/accessNumber${#:selectedAccessNumber}/existing/pilotNumber" targetName="localNumber" />
                    </RPListItemTemplate>
                </RPListTemplate>
            </TransformationTemplate>
        </TransformationTemplate>

        <!-- list of old access numbers, used for setting porting characteristics -->
        <RPListTemplate listName="oldAccessNumberList">
            <RPListItemTemplate sourceWorkingPath="*/voice[@refAccessID='${#:currentMainAccessID}']/*/portingAccessNumbers/*/existing[localAreaCode != '00']/countryCode">
                <RPMapping sourceAttrName="." targetName="countryCode" />
                <RPMapping sourceAttrName="../localAreaCode" targetName="areaCode" />
                <RPMapping sourceAttrName="../pilotNumber" targetName="localNumber" />
            </RPListItemTemplate>
        </RPListTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/*[@refAccessID='${#:currentMainAccessID}']/voiceBasisConfiguration/portingAccessNumbers/*[configured = 'bernehmen']" />
            </TemplateConditions>
            <RPListTemplate listName="accessNumberList">
                <RPListItemTemplate sourceWorkingPath="*/*[@refAccessID='${#:currentMainAccessID}']/*/portingAccessNumbers/*/configured[localAreaCode != '00']/countryCode">
                    <RPMapping sourceAttrName="." targetName="countryCode" />
                    <RPMapping sourceAttrName="../localAreaCode" targetName="areaCode" />
                    <RPMapping sourceAttrName="../pilotNumber" targetName="localNumber" />
                </RPListItemTemplate>
            </RPListTemplate>
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ADD" sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/processingType" />
                    <base:IsMember value="CHANGE" sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/processingType" />
                    <base:IsMember value="IGNORE" sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/processingType" />
                </OrComposite>
            </TemplateConditions>

            <!-- only create DSL for the customer, if no narrowband flatrate is ordered -->
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="true"
                        sourceAttrName="
                        */internet/processingType != 'TERM' and
                        count(*/internet/*/DSLBandwidth/configured) = 0 and
                        count(*/internet/*/DSLBandwidth/existing) > 0 and
                        */internet/*/DSLBandwidth/existing != 'V0115'
                        or
                        count(*/internet/*/DSLBandwidth/configured) > 0 and
                        */internet/*/DSLBandwidth/configured != 'V0115'" />
                </TemplateConditions>
                <RPMapping staticValue="Y" targetName="createDSL" />
            </TransformationTemplate>

            <!-- DSL bandwidth -->
            <RPMapping targetName="DSLBandwidth"
                sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/*/DSLBandwidth"
                decoding=" 'V0116','DSL 768',  'V0118','DSL 1000', 'V0117','DSL 1500',
                'V0174','DSL 2000', 'V0175','DSL 3000', 'V0178','DSL 6000',
                'V018C','DSL 16000',  'V018G','DSL 25000',  'V018H','DSL 50000', ''"
                method="configuredExisting"/>
            <RPMapping targetName="upstreamBandwidth"
                sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/*/upstreamBandwidth"
                decoding="'V0198', '384', 'Standard'"
                method="configuredExisting"/>
            <RPMapping targetName="desiredBandwidth"
                sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/*/desiredBandwidth"
                decoding=" 'V0116','DSL 768',  'V0118','DSL 1000', 'V0117','DSL 1500',
                'V0174','DSL 2000', 'V0175','DSL 3000', 'V0178','DSL 6000',
                'V018C','DSL 16000',  'V018G','DSL 25000',  'V018H','DSL 50000', ''"
                method="configuredExisting"/>
            <RPMapping targetName="allowDowngrade"
                sourceAttrName="functions/internet[@refAccessID='${#:currentMainAccessID}']/*/allowBandwidthDowngrade"
                decoding="'true','Ja','Nein'"
                method="configuredExisting"/>
        </TransformationTemplate>

        <RPMapping targetName="activationDate" sourceAttrName="desiredDate" formatter="SOMToCCBDateFormatter" />

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/instantAccess"/>
                <OrComposite>
                    <base:IsMember value="ADD" sourceAttrName="*/instantAccess[refFunctionID/configured = '${*/internet[@refAccessID='${#:currentMainAccessID}']/@ID}']/processingType" />
                    <base:IsMember value="CHANGE" sourceAttrName="*/instantAccess[refFunctionID/configured = '${*/internet[@refAccessID='${#:currentMainAccessID}']/@ID}']/processingType" />
                </OrComposite>
            </TemplateConditions>
            <RPMapping targetName="instantAccessIndicator"
                sourceAttrName="*/instantAccess[refFunctionID/configured = '${*/internet[@refAccessID='${#:currentMainAccessID}']/@ID}']/*/instantAccessVariant"
                method="configuredExisting"/>
        </TransformationTemplate>

        <RPMapping targetName="multimediaProduct"
            sourceAttrName="accesses/*/*/multimediaPort"
            method="configuredExisting"/>
        <RPMapping targetName="setACSIndicator"
            sourceAttrName="*/isdn/*/acsIndicator"
            decoding="'true', 'Ja', 'false', 'Nein'"
            method="configuredExisting"/>
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="accesses/*/*/accessTechnology" />          
            </TemplateConditions>
            <RPMapping targetName="portType"
                sourceAttrName="accesses/*/*/vdslEnabledIndicator"
                decoding="'true', 'VDSL', 'false', 'ADSL'"
                method="configuredExisting"/>
        </TransformationTemplate> 
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="accesses/*/*/accessTechnology" />          
            </TemplateConditions>
            <RPMapping targetName="portType"
                sourceAttrName="accesses/*/*/accessTechnology"
                method="configuredExisting"/>
        </TransformationTemplate> 
    </baseInclusion:Part>

    <baseInclusion:Part id="providerTrackingNumberCreation">
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="providerTrackingNumber[@type='target']" />
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber"
                sourceAttrName="providerTrackingNumber[@type='target']"
                method="configuredExisting"/>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="providerTrackingNumber[@type='target']" />
                <base:IsExisting sourceAttrName="providerTrackingNumber[@type='default']" />
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber"
                sourceAttrName="providerTrackingNumber[@type='default']"
                method="configuredExisting"/>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="providerTrackingNumber[@type='target']" />
                <base:IsNotExisting sourceAttrName="providerTrackingNumber[@type='default']" />
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber"
                sourceAttrName="providerTrackingNumber"
                method="configuredExisting"/>
        </TransformationTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="providerTrackingNumberTermination">
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="providerTrackingNumber[@type='default']"/>
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber"
                sourceAttrName="providerTrackingNumber[@type='default']" method="configuredExisting"/>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="providerTrackingNumber[@type='default']"/>
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber" sourceAttrName="providerTrackingNumber"
                method="configuredExisting"/>
        </TransformationTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="providerTrackingNumberReconfiguration">
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="providerTrackingNumber[@type='change']"/>
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber"
                sourceAttrName="providerTrackingNumber[@type='change']" method="configuredExisting"/>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="providerTrackingNumber[@type='change']"/>
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumber" sourceAttrName="providerTrackingNumber"
                method="configuredExisting"/>
        </TransformationTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="masterdataParameters">
        <base:DataBufferWriter keyValue="payerNode"
            sourceAttrName="count(/*/*/payerAllCharges/targetBillingAccountNodeRefID) > 0"
            decoding="'true', 'targetBillingAccountNodeRefID', 'billingAccountNodeRefID'" />

        <base:DataBufferWriter keyValue="beneficiaryNode"
            sourceAttrName="count(/*/*/beneficiary/targetCustomerNodeRefID) > 0"
            decoding="'true', 'targetCustomerNodeRefID', 'customerNodeRefID'" />

        <base:DataBufferWriter keyValue="targetCustomerNumberElement"
            sourceAttrName="count(/*/*/customer[@ID = '${/*/*/beneficiary/${#:beneficiaryNode}}']/ccbId[@type='C']/configured) > 0"
            decoding="'true', 'configured', 'existing'"/>            
        <base:DataBufferWriter keyValue="targetCustomerNumber"
            sourceAttrName="/*/*/customer[@ID = '${/*/*/beneficiary/${#:beneficiaryNode}}']/ccbId[@type='C']/${#:targetCustomerNumberElement}" />

        <base:DataBufferWriter keyValue="targetAccountNumberElement"
            sourceAttrName="count(/*/*/billingAccount[@ID = '${/*/*/payerAllCharges/${#:payerNode}}']/ccbId[@type='A']/configured) > 0"
            decoding="'true', 'configured', 'existing'"/>            
        <base:DataBufferWriter keyValue="targetAccountNumber"
            sourceAttrName="/*/*/billingAccount[@ID = '${/*/*/payerAllCharges/${#:payerNode}}']/ccbId[@type='A']/${#:targetAccountNumberElement}" />

        <base:DataBufferWriter keyValue="customerNumberElement"
            sourceAttrName="count(/*/*/customer[@ID = '${/*/*/beneficiary/customerNodeRefID}']/ccbId[@type='C']/configured) > 0"
            decoding="'true', 'configured', 'existing'"/>            
        <base:DataBufferWriter keyValue="customerNumber"
            sourceAttrName="/*/*/customer[@ID = '${/*/*/beneficiary/customerNodeRefID}']/ccbId[@type='C']/${#:customerNumberElement}" />

        <base:DataBufferWriter keyValue="accountNumberElement"
            sourceAttrName="count(/*/*/billingAccount[@ID = '${/*/*/payerAllCharges/billingAccountNodeRefID}']/ccbId[@type='A']/configured) > 0"
            decoding="'true', 'configured', 'existing'"/>            
        <base:DataBufferWriter keyValue="accountNumber"
            sourceAttrName="/*/*/billingAccount[@ID = '${/*/*/payerAllCharges/billingAccountNodeRefID}']/ccbId[@type='A']/${#:accountNumberElement}" />

        <base:DataBufferWriter keyValue="currentCustomerNumber"
            sourceAttrName="#:customerNumber" />

        <base:DataBufferWriter keyValue="currentAccountNumber"
            sourceAttrName="#:accountNumber" />
    </baseInclusion:Part>

    <baseInclusion:Part id="productChangeAdditionalProducts">
        <RPMapping targetName="contractNumber" sourceAttrName="contractNumber" />
        <RPMapping targetName="customerNumber" sourceAttrName="#:targetCustomerNumber" />
        <RPMapping targetName="accountNumber" sourceAttrName="#:targetAccountNumber" />
        <RPMapping targetName="activationDate" sourceAttrName="../../desiredDate" formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="functionID" sourceAttrName="@ID" />
        <RPMapping targetName="productCode" sourceAttrName="*/productCode" method="configuredExisting" />
        <RPMapping targetName="serviceSubscriptionId" sourceAttrName="ccbId[@type='S']/existing" />
        <RPMapping targetName="relocationVariant" sourceAttrName="../../relocationVariant" />

        <!-- contract parameters -->
        <RPMapping targetName="tariff"
            sourceAttrName="*/pricingStructureCode"
            method="configuredExisting" />
        <RPMapping targetName="primaryCustSignName"
            sourceAttrName="*/primaryCustSignName"
            method="configuredExisting" />
        <RPMapping targetName="minPeriodDurationValue"
            sourceAttrName="*/minimumDurationPeriod/value/configured" />
        <RPMapping targetName="minPeriodDurationUnit"
            sourceAttrName="*/minimumDurationPeriod/unit"
            method="configuredExisting" />
        <RPMapping targetName="termStartDate"
            sourceAttrName="*/minimumDurationPeriod/startDate"
            method="configuredExisting"
            formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="autoExtentPeriodValue"
            sourceAttrName="*/autoExtension/value"
            method="configuredExisting" />
        <RPMapping targetName="autoExtentPeriodUnit"
            sourceAttrName="*/autoExtension/unit"
            method="configuredExisting" />
        <RPMapping targetName="autoExtensionInd"
            sourceAttrName="*/autoExtension/autoExtensionIndicator"
            method="configuredExisting"
            decoding="'true', 'Y', 'N'" />

        <!-- address parameters -->
        <RPMapping targetName="streetName" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/street" />
        <RPMapping targetName="streetNumber" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/streetNumber" />
        <RPMapping targetName="postalCode" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/postalCode" />
        <RPMapping targetName="cityName" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/city" />
        <RPMapping targetName="citySuffix" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/citySuffix" />
        <RPMapping targetName="additionalText" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/additionalAddressDescription" />
        <RPMapping targetName="numberSuffix" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/streetNumberSuffix" />
        <RPMapping targetName="countryCode" sourceAttrName="/*/*/accesses/*[@ID='${#:targetMainAccessID}']/*/locationAddress/configured/country" />
    
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="tvCenter" sourceAttrName="name(.)"/>
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumberTVCenterDefault" 
                sourceAttrName="providerTrackingNumber[@type = 'default']/configured" />
            <RPMapping targetName="providerTrackingNumberTVCenterTarget" 
                sourceAttrName="providerTrackingNumber[@type = 'target']/configured" />
            <RPMapping targetName="providerTrackingNumberTVCenterChange" 
                sourceAttrName="providerTrackingNumber[@type = 'change']/configured" />    
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="voice" sourceAttrName="name(.)"/>
            </TemplateConditions>
            <RPMapping targetName="providerTrackingNumberVoiceDefault" 
                sourceAttrName="providerTrackingNumber[@type = 'default']/configured" />
            <RPMapping targetName="providerTrackingNumberVoiceTarget" 
                sourceAttrName="providerTrackingNumber[@type = 'target']/configured" />
            <RPMapping targetName="providerTrackingNumberVoiceChange" 
                sourceAttrName="providerTrackingNumber[@type = 'change']/configured" />   
            <RPMapping targetName="providerTrackingNumberDirectoryEntryTarget" 
                sourceAttrName="../directoryEntry[refFunctionID/existing = '${@ID}']/providerTrackingNumber[@type = 'target']/configured" />
        </TransformationTemplate>
        
    </baseInclusion:Part>

    <baseInclusion:Part id="instantAccessForReconfiguration">
        <RPListItemTemplate>
            <RPMapping targetName="parameterName" staticValue="instantAccessVariant" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="ADD" sourceAttrName="../instantAccess/processingType" />
                </TemplateConditions>
                <RPMapping targetName="configuredValue"
                    sourceAttrName="../instantAccess/*/instantAccessVariant"
                    method="configuredExisting" />
            </TransformationTemplate>
        </RPListItemTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="billingAccountNumberForconfiguration">
        <RPListItemTemplate>
            <RPMapping targetName="parameterName" staticValue="billingAccountNumber" />
            <TransformationTemplate>
                <TemplateConditions>
                	<base:IsMember value="true" 
            				sourceAttrName="count(//kiasReference/*) > 0"/>
                </TemplateConditions>
                <RPMapping targetName="configuredValue"
                    sourceAttrName="//accesses/*/*/kiasReference/billingAccountNumber"
                    method="configuredExisting" />
            </TransformationTemplate>
        </RPListItemTemplate>
    </baseInclusion:Part>
	
	<baseInclusion:Part id="LtefixedIPAddressConfig">
        <RPListItemTemplate>
            <TransformationTemplate>
            <TemplateConditions>
   			<base:IsMember value="LTE" sourceAttrName="#:targetTechnology"/>
   			<OrComposite>
        	<base:IsNotMember value='true' sourceAttrName="count(//fixedIPAddress/*)>0"/>
        	<base:IsMember value='' sourceAttrName="//fixedIPAddress/configured"/>
        	</OrComposite>
      		</TemplateConditions>
      			<RPMapping targetName="parameterName" staticValue="fixedIPAddress" />
                <RPMapping targetName="configuredValue"
                    staticValue="UNCONFIGURED"/>
            </TransformationTemplate>
        </RPListItemTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="tvCenterOrderForReconfiguration">
        <RPListItemTemplate>
            <RPMapping targetName="parameterName" staticValue="reconfigurationReason" />
            <RPMapping targetName="configuredValue" staticValue="MM-nderung" />
        </RPListItemTemplate>
        <RPListItemTemplate>
            <RPMapping targetName="parameterName" staticValue="multimediaPort" />
            <RPMapping targetName="configuredValue"
                sourceAttrName="../../accesses/*[@ID = '${@refAccessID}']/*/multimediaPort"
                method="configuredExisting"/>
        </RPListItemTemplate>
        <RPListItemTemplate>
            <RPMapping targetName="parameterName" staticValue="processingType" />
            <RPMapping targetName="configuredValue" staticValue="TAL" />
        </RPListItemTemplate>
    </baseInclusion:Part>

    <baseInclusion:Part id="acsForReconfiguration">
        <RPListItemTemplate>
            <RPMapping targetName="parameterName" staticValue="acsIndicator" />
            <RPMapping targetName="configuredValue"
                sourceAttrName="../../accesses/*[@ID = '${@refAccessID}']/*/acsIndicator"
                method="configuredExisting"/>
        </RPListItemTemplate>
    </baseInclusion:Part>

    <baseInclusion:Part id="contractFunctionParameters">

        <base:Include fileIDRef="functionParameters" partIDRef="serviceType"/>

        <RPMapping targetName="oldProductCommitmentNumber" sourceAttrName="productCommitmentNumber/existing" />
        <RPMapping targetName="billActivationIndicator" 
            sourceAttrName="billingEnabledIndicatorNewCcbId"
            method="configuredExisting"
            decoding="'false', 'Y', ''" />

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="targetServiceDeliveryContractNodeRefID" />
            </TemplateConditions>
            <RPMapping targetName="serviceDeliveryContractNumber"
                sourceAttrName="/*/*/serviceDeliveryContract[@ID='${targetServiceDeliveryContractNodeRefID}']/ccbId[@type='D']/*" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="targetServiceDeliveryContractNodeRefID" />
                <base:IsExisting sourceAttrName="serviceDeliveryContractNodeRefID" />
            </TemplateConditions>
            <RPMapping targetName="serviceDeliveryContractNumber"
                sourceAttrName="/*/*/serviceDeliveryContract[@ID='${serviceDeliveryContractNodeRefID}']/ccbId[@type='D']/*" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="targetServiceDeliveryContractNodeRefID" />
                <base:IsNotExisting sourceAttrName="serviceDeliveryContractNodeRefID" />
                <base:IsExisting sourceAttrName="serviceDeliveryContractCcbId/configured" />
            </TemplateConditions>
            <RPMapping targetName="serviceDeliveryContractNumber" sourceAttrName="serviceDeliveryContractCcbId/configured" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="targetServiceDeliveryContractNodeRefID" />
                <base:IsNotExisting sourceAttrName="serviceDeliveryContractNodeRefID" />
                <base:IsNotExisting sourceAttrName="serviceDeliveryContractCcbId/configured" />
            </TemplateConditions>
            <RPMapping targetName="serviceDeliveryContractNumber" sourceAttrName="serviceDeliveryContractCcbId/existing" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="targetSkeletonContractNodeRefID" />
            </TemplateConditions>
            <RPMapping targetName="assocSkeletonContNum" sourceAttrName="/*/customerData/skeletonContract[@ID='${targetSkeletonContractNodeRefID}']/ccbId[@type='K']/*" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="targetSkeletonContractNodeRefID" />
                <base:IsExisting sourceAttrName="skeletonContractNodeRefID" />
            </TemplateConditions>
            <RPMapping targetName="assocSkeletonContNum" sourceAttrName="/*/customerData/skeletonContract[@ID='${skeletonContractNodeRefID}']/ccbId[@type='K']/*" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="targetSkeletonContractNodeRefID" />
                <base:IsNotExisting sourceAttrName="skeletonContractNodeRefID" />
                <base:IsExisting sourceAttrName="skeletonContractCcbId/configured" />
            </TemplateConditions>
            <RPMapping targetName="assocSkeletonContNum" sourceAttrName="skeletonContractCcbId/configured" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="targetSkeletonContractNodeRefID" />
                <base:IsNotExisting sourceAttrName="skeletonContractNodeRefID" />
                <base:IsNotExisting sourceAttrName="skeletonContractCcbId/configured" />
            </TemplateConditions>
            <RPMapping targetName="assocSkeletonContNum" sourceAttrName="skeletonContractCcbId/existing" />
        </TransformationTemplate>

        <RPMapping targetName="productCommitmentNumber"
            sourceAttrName="productCommitmentNumber/configured"/>
        
        <RPMapping targetName="refAccessID" sourceAttrName="@refAccessID" />
        <RPMapping targetName="targetAccessID" sourceAttrName="@targetAccessID" />

        <RPMapping targetName="tariff"
            sourceAttrName="*/pricingStructureCode"
            method="configuredExisting"/>
        <RPMapping targetName="boardSignName"
            sourceAttrName="*/boardSignName"
            method="configuredExisting" />
        <RPMapping targetName="boardSignDate"
            sourceAttrName="*/boardSignDate"
            method="configuredExisting"
            formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="primaryCustSignName"
            sourceAttrName="*/primaryCustSignName"
            method="configuredExisting" />
        <RPMapping targetName="primaryCustSignDate"
            sourceAttrName="*/primaryCustSignDate"
            method="configuredExisting"
            formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="minPeriodDurationValue"
            sourceAttrName="*/minimumDurationPeriod/value"
            method="configuredExisting" />
        <RPMapping targetName="minPeriodDurationUnit"
            sourceAttrName="*/minimumDurationPeriod/unit"
            method="configuredExisting" />
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/minimumDurationPeriod/startDate/configured" />                
            </TemplateConditions>
            <RPMapping targetName="termStartDate"
                sourceAttrName="*/minimumDurationPeriod/startDate/configured"
                formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>
        
        <RPMapping targetName="autoExtentPeriodValue"
            sourceAttrName="*/autoExtension/value"
            method="configuredExisting" />
        <RPMapping targetName="autoExtentPeriodUnit"
            sourceAttrName="*/autoExtension/unit"
            method="configuredExisting" />
        <RPMapping targetName="autoExtensionInd"
            sourceAttrName="*/autoExtension/autoExtensionIndicator"
            method="configuredExisting"
            decoding="'true', 'Y','false','N'" />
        <RPMapping targetName="specialTerminationRight"
            sourceAttrName="*/specialTerminationRight"
            method="configuredExisting"
            decoding="'true', 'Y', 'N'" />
        <RPMapping targetName="terminationRestriction"
            sourceAttrName="*/noticePeriod/noticeRestriction"
            method="configuredExisting" />
        <RPMapping targetName="VISTrackingPosition"
            sourceAttrName="*/visTrackingPosition"
            method="configuredExisting" />
    </baseInclusion:Part>

    <baseInclusion:Part id="contractParametersBandwidthChange">
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="true" sourceAttrName="*/pricingStructureCode/existing != */pricingStructureCode/configured
                    and */pricingStructureCode/configured != ''" />
                <base:IsNotMember value="true" sourceAttrName="*/specialTerminationRight/existing != */specialTerminationRight/configured
                    and */specialTerminationRight/configured != ''" />
                <base:IsNotMember value="true" sourceAttrName="
                    */minimumDurationPeriod/value/existing != */minimumDurationPeriod/value/configured and */minimumDurationPeriod/value/configured != ''
                    or */minimumDurationPeriod/unit/existing != */minimumDurationPeriod/unit/configured and */minimumDurationPeriod/unit/configured != ''
                    or */minimumDurationPeriod/startDate/existing != */minimumDurationPeriod/startDate/configured and */minimumDurationPeriod/startDate/configured != ''
                    or */resetContractStartDateIndicator/configured = 'true'" />
                <base:IsNotMember value="true" sourceAttrName="
                    */autoExtension/value/existing != */autoExtension/value/configured and */autoExtension/value/configured != ''
                    or */autoExtension/unit/existing != */autoExtension/unit/configured and */autoExtension/unit/configured != ''
                    or */autoExtension/autoExtensionIndicator/existing != */autoExtension/autoExtensionIndicator/configured and */autoExtension/autoExtensionIndicator/configured != ''" />
            </TemplateConditions>
            <RPMapping targetName="changeDSLBandwidthAndTariff" staticValue="N" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="*/pricingStructureCode/existing != */pricingStructureCode/configured
                    and */pricingStructureCode/configured != ''" />
            </TemplateConditions>
            <RPMapping targetName="changeTariff" staticValue="Y" />
            <RPMapping targetName="newPricingStructureCode" sourceAttrName="*/pricingStructureCode/configured" />
            <RPMapping targetName="pricingStructureBillingName" sourceAttrName="*/pricingStructureBillingName/configured" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="
                    */minimumDurationPeriod/value/existing != */minimumDurationPeriod/value/configured and */minimumDurationPeriod/value/configured != ''
                    or */minimumDurationPeriod/unit/existing != */minimumDurationPeriod/unit/configured and */minimumDurationPeriod/unit/configured != ''
                    or */minimumDurationPeriod/startDate/existing != */minimumDurationPeriod/startDate/configured and */minimumDurationPeriod/startDate/configured != ''
                    or */resetContractStartDateIndicator/configured = 'true'" />
            </TemplateConditions>
            <RPMapping targetName="changeMinimumDuration" staticValue="Y" />
            <RPMapping targetName="newMinPeriodDurationValue" sourceAttrName="*/minimumDurationPeriod/value/configured" />
            <RPMapping targetName="newMinPeriodDurationUnit" sourceAttrName="*/minimumDurationPeriod/unit/configured" />
        </TransformationTemplate>
        <RPMapping targetName="newAutoExtentPeriodValue" sourceAttrName="*/autoExtension/value/configured" />
        <RPMapping targetName="newAutoExtentPeriodUnit" sourceAttrName="*/autoExtension/unit/configured" />
        <RPMapping targetName="newAutoExtensionInd" sourceAttrName="*/autoExtension/autoExtensionIndicator/configured" decoding="'true', 'Y', 'false', 'N'" />
        <RPMapping targetName="specialTerminationRight" sourceAttrName="*/specialTerminationRight/configured" />
    </baseInclusion:Part>

    <baseInclusion:Part id="featuresTemplates">
        <AbstractTransformationTemplate ID="modifyFeaturesFeatures_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/featuresList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/featuresList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/featuresList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="featuresList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/featuresList/@action" />
            <RPMapping targetName="ignoreDuplicates" staticValue="Y" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/featuresList/existing/featureServiceCode">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
                <RPListItemTemplate sourceWorkingPath="*/featuresList/existing/featureService">
                    <RPMapping sourceAttrName="featureServiceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/featuresList/configured/featureServiceCode">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
                <RPListItemTemplate sourceWorkingPath="*/featuresList/configured/featureService">
                    <RPMapping sourceAttrName="featureServiceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>            
        </AbstractTransformationTemplate>
        
        <AbstractTransformationTemplate ID="modifyFeaturesVolumeCap_template" extends="modifyFeatures_template">
		<TemplateConditions>
			<base:IsExisting sourceAttrName="*/volumeCap/*/*" />
			<base:IsMember value="true" sourceAttrName="#:isWF12" />
			<base:IsMember value="execute" sourceAttrName="/order/*/transactionType" />
			<base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
			<base:IsMember value="LTE" sourceAttrName="#:targetTechnology" />
			<OrComposite>
                    <base:IsExisting sourceAttrName="*/volumeCap/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/volumeCap/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>
			</OrComposite>
			<OrComposite>
			<AndComposite>
			<base:IsMember value="true" sourceAttrName="count(*/pricingStructureCode/configured) > 0" />
				<base:IsNotMember value="I1112" sourceAttrName="*/pricingStructureCode/configured"/>
				<base:IsNotMember value="I1113" sourceAttrName="*/pricingStructureCode/configured"/>
			</AndComposite>
			<AndComposite>
			<base:IsMember value="true" sourceAttrName="count(*/pricingStructureCode/existing) > 0 and count(*/pricingStructureCode/configured)= 0" />
				<base:IsNotMember value="I1112" sourceAttrName="*/pricingStructureCode/existing"/>
				<base:IsNotMember value="I1113" sourceAttrName="*/pricingStructureCode/existing"/>
			</AndComposite>
			</OrComposite>
		</TemplateConditions>
		
			<base:DataBufferWriter keyValue="listType" staticValue="volumeCap" />
			<RPMapping targetName="listType" sourceAttrName="#:listType" />
			<RPMapping targetName="action" sourceAttrName="*/volumeCap/@action" />
            <RPMapping targetName="ignoreDuplicates" staticValue="Y" />
			 <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/volumeCap/existing">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode"/>
                    <RPMapping sourceAttrName="serviceBillingName" targetName="serviceBillingName"/>
                </RPListItemTemplate>
            </RPListTemplate>
            
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/volumeCap/configured">
                    <RPMapping targetName="serviceCode" sourceAttrName="serviceCode"/>
                    <RPMapping sourceAttrName="serviceBillingName" targetName="serviceBillingName"/>
                </RPListItemTemplate>
             </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
		</AbstractTransformationTemplate>
		
		<AbstractTransformationTemplate ID="modifyFeaturesVolumeCapWithBandwidth_template" extends="modifyFeatures_template">
		<TemplateConditions>
			<base:IsMember value="true" sourceAttrName="#:isWF12" />
			<base:IsMember value="execute" sourceAttrName="/order/*/transactionType" />
			<base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
			<base:IsMember value="LTE" sourceAttrName="#:targetTechnology" />
			<base:IsMember value="true" sourceAttrName="#:internetReadyForFeatures"/>
			 <OrComposite>
			 		<base:IsMember value="LTE" sourceAttrName="#:targetTechnology" />
                    <base:IsMember value="remove" sourceAttrName="*/volumeCap/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>
			</OrComposite>
			<OrComposite>
					<base:IsMember value="true" sourceAttrName="#:newInternetMainAccess" />
					<base:IsMember value="true" sourceAttrName="#:isBandwidthChange" />
			</OrComposite>
			<OrComposite>
			<AndComposite>
			<base:IsMember value="true" sourceAttrName="count(*/pricingStructureCode/configured) > 0" />
			<OrComposite>
				<base:IsMember value="I1112" sourceAttrName="*/pricingStructureCode/configured"/>
				<base:IsMember value="I1113" sourceAttrName="*/pricingStructureCode/configured"/>
			</OrComposite>
			</AndComposite>
			<AndComposite>
			<base:IsMember value="true" sourceAttrName="count(*/pricingStructureCode/existing) > 0 and count(*/pricingStructureCode/configured)= 0" />
			<OrComposite>
				<base:IsMember value="I1112" sourceAttrName="*/pricingStructureCode/existing"/>
				<base:IsMember value="I1113" sourceAttrName="*/pricingStructureCode/existing"/>
			</OrComposite>
			</AndComposite>
			</OrComposite>
		</TemplateConditions>
		
			<base:DataBufferWriter keyValue="listType" staticValue="volumeCap" />
			<RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="ignoreDuplicates" staticValue="Y" />
			 <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/volumeCap/existing">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode"/>
                    <RPMapping sourceAttrName="serviceBillingName" targetName="serviceBillingName"/>
                </RPListItemTemplate>
            </RPListTemplate>
            
            <RPListTemplate listName="configuredServiceList">
                 <RPListItemTemplate sourceWorkingPath="../internet/*/DSLBandwidth">
                    <RPMapping targetName="serviceCode"  sourceAttrName="." method="configuredExisting"
                    	decoding="'V017J', 'DV001', 'V017E', 'DV001', 'V017K', 'DV002', 'V017L', 'DV003', 'V017M', 'DV004', 'V018J', 'DV001', 'V018O' , 'DV001', 'V018P', 'DV002', 'V018Q', 'DV003','V018R', 'DV004'"/>
               </RPListItemTemplate>
             </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
		</AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesServiceLevel_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/serviceLevel" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/serviceLevel/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/serviceLevel/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>         
            <base:DataBufferWriter keyValue="listType" staticValue="serviceLevel" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/serviceLevel/@action" />
            <RPMapping targetName="ignoreDuplicates" staticValue="Y" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/serviceLevel/existing">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/serviceLevel/configured">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>            
        </AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesServiceLevelLegal_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/serviceLevelLegalList" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/serviceLevelLegalList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/serviceLevelLegalList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>         
            <base:DataBufferWriter keyValue="listType" staticValue="serviceLevelLegalList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/serviceLevelLegalList/@action" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/serviceLevelLegalList/existing/serviceLevel">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/serviceLevelLegalList/configured/serviceLevel">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>
                
         <AbstractTransformationTemplate ID="modifyFeaturesIPV6_template" extends="modifyFeatures_template">
                   
            <TemplateConditions>
                <base:IsExisting sourceAttrName="../internet/*/ipV6Variant" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="../internet/processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="../internet/processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>   
                <AndComposite>
                    <base:IsMember value="internet" sourceAttrName="name(.)" />
                    <OrComposite>
                        <base:IsMember value="true" sourceAttrName="#:newInternetMainAccess" />
                        <base:IsExisting sourceAttrName="../internet/*/ipV6Variant/configured" />
                        <base:IsMember value="remove" sourceAttrName="../internet/*/ipV6Variant/@action" />
                    </OrComposite>                        
                </AndComposite>
            </TemplateConditions>     	        
            <base:DataBufferWriter keyValue="listType" staticValue="ipV6Variant" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="../internet/*/ipV6Variant/@action" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="../internet/*/ipV6Variant/existing">
                    <RPMapping sourceAttrName="." 
                    	targetName="serviceCode" 
                    	decoding="'IpV4Public', 'I128R', 'IpV4Private', 'I128Q'"/>
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="../internet/*/ipV6Variant/configured">
                    <RPMapping sourceAttrName="." 
                    	targetName="serviceCode" 
                    	decoding="'IpV4Public', 'I128R', 'IpV4Private', 'I128Q'"/>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>
                
        <AbstractTransformationTemplate ID="modifyFeaturesChargesAndCredits_template" extends="modifyFeaturesWithAlternatives_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/chargesAndCreditsList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/chargesAndCreditsList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/chargesAndCreditsList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="chargesAndCreditsList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/chargesAndCreditsList/@action" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/chargesAndCreditsList/existing/featureServiceCode[. != 'VI034']">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
                <RPListItemTemplate sourceWorkingPath="*/chargesAndCreditsList/existing/featureService[featureServiceCode != 'VI034']">
                    <RPMapping sourceAttrName="featureServiceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                        </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/chargesAndCreditsList/configured/featureServiceCode[. != 'VI034']">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                      <RPListItemTemplate>
	                      <TemplateConditions>
	                        <base:IsMember value="VI234" sourceAttrName="." />
	                      </TemplateConditions>
                          <RPMapping staticValue="VI085" targetName="serviceCharCode" />
                          <RPMapping staticValue="INTEGER" targetName="dataType" />
                          <RPMapping sourceAttrName="../../../../../../accesses/*[@ID = '${../../../../@refAccessID}']/*/sipTrunkVoiceChannels/existing - ../../../../../../accesses/*[@ID = '${../../../../@refAccessID}']/*/sipTrunkVoiceChannels/configured" targetName="value" />
                      </RPListItemTemplate>                        
                      <RPListItemTemplate>
	                      <TemplateConditions>
	                        <base:IsMember value="VI039" sourceAttrName="." />
	                        <base:IsExisting sourceAttrName="/*/*/*/oneNetBusiness/*/numberOfVoiceChannels/configured" />
	                        <base:IsMember value="true" sourceAttrName="/*/*/*/oneNetBusiness/*/numberOfVoiceChannels/existing > /*/*/*/oneNetBusiness/*/numberOfVoiceChannels/configured" />
	                      </TemplateConditions>
                          <RPMapping staticValue="VI085" targetName="serviceCharCode" />
                          <RPMapping staticValue="INTEGER" targetName="dataType" />
                          <RPMapping sourceAttrName="/*/*/*/oneNetBusiness/*/numberOfVoiceChannels/existing - /*/*/*/oneNetBusiness/*/numberOfVoiceChannels/configured" targetName="value" />
                      </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
                <RPListItemTemplate sourceWorkingPath="*/chargesAndCreditsList/configured/featureService[featureServiceCode != 'VI034']">
                    <RPMapping sourceAttrName="featureServiceCode" targetName="serviceCode" />
                    <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate sourceWorkingPath="additionalInfo">
                            <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                            <RPMapping sourceAttrName="value" targetName="value" />
                            <RPMapping sourceAttrName="key" targetName="dataType"
                                decoding="'V0228','INTEGER', 'VI085', 'INTEGER', 'STRING'"/>
                        </RPListItemTemplate>
	                    <RPListItemTemplate>
		                    <TemplateConditions>
		                      <base:IsMember value="VI234" sourceAttrName="featureServiceCode" />
		                      <base:IsMember value="true" sourceAttrName="count(additionalInfo[key = 'VI085']) = 0" />
		                    </TemplateConditions>
	                        <RPMapping staticValue="VI085" targetName="serviceCharCode" />
	                        <RPMapping staticValue="INTEGER" targetName="dataType" />
	                        <RPMapping sourceAttrName="../../../../../../accesses/*[@ID = '${../../../../@refAccessID}']/*/sipTrunkVoiceChannels/existing - ../../../../../../accesses/*[@ID = '${../../../../@refAccessID}']/*/sipTrunkVoiceChannels/configured" targetName="value" />
	                    </RPListItemTemplate>                        
	                      <RPListItemTemplate>
		                      <TemplateConditions>		                        
		                        <base:IsMember value="VI039" sourceAttrName="featureServiceCode" />
		                        <base:IsMember value="true" sourceAttrName="count(additionalInfo[key = 'VI085']) = 0" />
		                        <base:IsExisting sourceAttrName="/*/*/*/oneNetBusiness/*/numberOfVoiceChannels/configured" />
		                        <base:IsMember value="true" sourceAttrName="/*/*/*/oneNetBusiness/*/numberOfVoiceChannels/existing > /*/*/*/oneNetBusiness/*/numberOfVoiceChannels/configured" />
		                      </TemplateConditions>
	                          <RPMapping staticValue="VI085" targetName="serviceCharCode" />
	                          <RPMapping staticValue="INTEGER" targetName="dataType" />
	                          <RPMapping sourceAttrName="/*/*/*/oneNetBusiness/*/numberOfVoiceChannels/existing - /*/*/*/oneNetBusiness/*/numberOfVoiceChannels/configured" targetName="value" />
	                      </RPListItemTemplate>                        
                    </RPListTemplate>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesCountries_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/desiredCountriesList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/desiredCountriesList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/desiredCountriesList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="desiredCountriesList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/desiredCountriesList/@action" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/desiredCountriesList/existing/*">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                    <RPMapping staticValue="Y" targetName="handleContributingItem" />
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/desiredCountriesList/configured/*">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                    <RPMapping staticValue="Y" targetName="handleContributingItem" />
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesTariffOptions_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/tariffOptionsList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/tariffOptionsList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/tariffOptionsList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="tariffOptionsList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/tariffOptionsList/@action" />
            <RPMapping targetName="handleAsynchronousTermination" staticValue="Y"/>
            
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/tariffOptionsList/configured/tariffOption/serviceCode[. != 'V0306' and . != 'V0992' and . != 'V0991']">
                  <RPMapping sourceAttrName="." targetName="serviceCode" />
                  <RPMapping sourceAttrName="../minimumDurationPeriod/startDate" targetName="startDate" formatter="SOMToCCBDateFormatter" />
                  <RPMapping sourceAttrName="../minimumDurationPeriod/value" targetName="minimumDuration" />
                  <RPMapping sourceAttrName="../terminationDate" targetName="terminationDate" formatter="SOMToCCBDateFormatter" />
                  <TransformationTemplate>
                    <TemplateConditions>
                      <base:IsMember value="true" sourceAttrName="
                        (. = 'V1091' or . = 'V1092') and
                        count(../../../../../../../accesses/*[@ID = '${../../../../../@refAccessID}']/*/sipTrunkVoiceChannels) > 0" />
                    </TemplateConditions>
                    <RPListTemplate listName="additionalInfo">
                      <RPListItemTemplate>
                          <RPMapping staticValue="VI064" targetName="serviceCharCode" />
                          <RPMapping staticValue="INTEGER" targetName="dataType" />
                          <RPMapping sourceAttrName="../../../../../../../accesses/*[@ID = '${../../../../../@refAccessID}']/*/sipTrunkVoiceChannels" 
                              targetName="value" 
                              method="configuredExisting"/>
                      </RPListItemTemplate>                        
                    </RPListTemplate>
                  </TransformationTemplate>
                  <RPMapping sourceAttrName="name(../../../../..) = 'tvCenter'" 
                      targetName="handleContributingItem" 
                      decoding="'true', 'N', 'Y'"/>
	              <base:DataBufferWriter keyValue="hasConfiguredServiceList" staticValue="true" />           
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/tariffOptionsList/existing/tariffOption/serviceCode[. != 'V0306' and . != 'V0992' and . != 'V0991']">
                    <RPMapping sourceAttrName="." targetName="serviceCode" /> 
                    <RPMapping sourceAttrName="../minimumDurationPeriod/startDate" targetName="startDate" formatter="SOMToCCBDateFormatter" />
                  	<RPMapping sourceAttrName="../minimumDurationPeriod/value" targetName="minimumDuration" />
                 	<RPMapping sourceAttrName="../terminationDate" targetName="terminationDate" formatter="SOMToCCBDateFormatter" />                   
                    <TransformationTemplate>
                      <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="
                          (. = 'V1091' or . = 'V1092') and
                          count(../../../../../../../accesses/*[@ID = '${../../../../../@refAccessID}']/*/sipTrunkVoiceChannels) > 0" />
                      </TemplateConditions>
                      <RPListTemplate listName="additionalInfo">
                        <RPListItemTemplate>
                        	<TemplateConditions>
                        		<OrComposite>
	                        		<base:IsMember value="true" sourceAttrName="#:hasConfiguredServiceList"/>
	                        		<base:IsMember value="remove" sourceAttrName="../../../../../*/tariffOptionsList/@action"/>
                        		</OrComposite>
                        	</TemplateConditions>
                            <RPMapping staticValue="VI064" targetName="serviceCharCode" />
                            <RPMapping staticValue="INTEGER" targetName="dataType" />
                            <RPMapping sourceAttrName="../../../../../../../accesses/*[@ID = '${../../../../../@refAccessID}']/*/sipTrunkVoiceChannels/existing" 
                                targetName="value" />
                        </RPListItemTemplate>        
                        <RPListItemTemplate>
                        	<TemplateConditions>
                        		<AndComposite>
                        			<base:IsNotMember value="true" sourceAttrName="#:hasConfiguredServiceList"/>
                        			<base:IsNotMember value="remove" sourceAttrName="../../../../../*/tariffOptionsList/@action"/>
                        		</AndComposite>
                        	</TemplateConditions>
                            <RPMapping staticValue="VI064" targetName="serviceCharCode" />
                            <RPMapping staticValue="INTEGER" targetName="dataType" />
                            <RPMapping sourceAttrName="../../../../../../../accesses/*[@ID = '${../../../../../@refAccessID}']/*/sipTrunkVoiceChannels" 
                                targetName="value" 
                                method="configuredExisting"/>
                        </RPListItemTemplate>        
                      </RPListTemplate>
                    </TransformationTemplate>
                    <RPMapping sourceAttrName="name(../../../../..) = 'tvCenter'" 
                        targetName="handleContributingItem" 
                        decoding="'true', 'N', 'Y'"/>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>
        
        <AbstractTransformationTemplate ID="modifyFeaturesTVCenterTariffOptions_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/tariffOptionsList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/tariffOptionsList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/tariffOptionsList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="tariffOptionsList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/tariffOptionsList/@action" />
            <RPMapping targetName="desiredDate" staticValue="today" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/tariffOptionsList/existing/tariffOption/serviceCode">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/tariffOptionsList/configured/tariffOption/serviceCode">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>
        
        <AbstractTransformationTemplate ID="modifyFeaturesTVCenterOptions_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/tvCenterOptionsList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/tvCenterOptionsList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/tvCenterOptionsList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="tvCenterOptionsList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            
            <!-- PPM-196371 
           		tvCenterOptions are not fully supported by TO terminations. OPM will deactivate them, if termination
           		date is set, FIF wouldn't. Therefore if a configured TV option has a set termination date, it's treated
           		as it wouldn't exist in configured -->
			<TransformationTemplate>
				<TemplateConditions>
					<OrComposite>
						<AndComposite>
							<base:IsNotMember value="remove" sourceAttrName="*/tvCenterOptionsList/@action" />
							<base:IsExisting sourceAttrName="*/tvCenterOptionsList/existing/tvCenterOption" />
							<base:IsExisting sourceAttrName="*/tvCenterOptionsList/configured/tvCenterOption" />
							<base:IsMember value="true" 
								sourceAttrName="count(*/tvCenterOptionsList/configured/tvCenterOption[count(terminationDate) = 0]) = 0" />						
						</AndComposite>
						<base:IsMember value="remove" sourceAttrName="*/tvCenterOptionsList/@action" />
					</OrComposite>
				</TemplateConditions>                    
				<RPMapping targetName="action" staticValue="remove" />
			</TransformationTemplate>
            
            <RPMapping targetName="desiredDate" staticValue="today" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/tvCenterOptionsList/existing/tvCenterOption">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode" />
                    <RPMapping sourceAttrName="hotSubscriptionIndicator" targetName="hotSubscriptionIndicator" decoding="'true','ja','false','nein'" />
                    <RPMapping sourceAttrName="minimumDurationPeriod/startDate" targetName="startDate" formatter="SOMToCCBDateFormatter" />
                  	<RPMapping sourceAttrName="minimumDurationPeriod/value" targetName="minimumDuration" />
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/tvCenterOptionsList/configured/tvCenterOption[count(terminationDate) = 0]">
                    <RPMapping sourceAttrName="serviceCode" targetName="serviceCode" />
                    <RPMapping sourceAttrName="hotSubscriptionIndicator" targetName="hotSubscriptionIndicator" decoding="'true','ja','false','nein'" />
                    <RPMapping sourceAttrName="minimumDurationPeriod/startDate" targetName="startDate" formatter="SOMToCCBDateFormatter" />
                  	<RPMapping sourceAttrName="minimumDurationPeriod/value" targetName="minimumDuration" />
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesConditions_template"
            extends="modifyFeaturesWithAlternatives_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/conditionsList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                    <base:IsMember value="hardware" sourceAttrName="name(.)"/>                    
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/quantityOfPartiallyExchangedHardware" />
                    <base:IsMember value="true" sourceAttrName="*/articleNumber/existing != */articleNumber/configured" />
                    <base:IsExisting sourceAttrName="*/conditionsList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/conditionsList/@action" />
                    <AndComposite>
                        <OrComposite>
                            <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>
                        </OrComposite>
                        <OrComposite>
                            <base:IsExisting sourceAttrName="*/conditionsList/existing/*/conditionServiceStartDate" />
                            <base:IsExisting sourceAttrName="*/conditionsList/existing/*[conditionServiceType = 'DL']" />
                            <AndComposite>
                                <base:IsMember value="portingFinished" sourceAttrName="*/conditionsList/existing/*/conditionServiceEndEvent" />
                                <base:IsMember value="1001" sourceAttrName="../../@orderPositionNumber" />
                            </AndComposite>
                        </OrComposite>
                    </AndComposite>                  
                </OrComposite>                
                <OrComposite>
                    <base:IsNotMember value="0" sourceAttrName="*/quantity/configured"/>
                    <base:IsNotMember value="hardware" sourceAttrName="name(.)"/>                    
                </OrComposite>
		        <OrComposite>
		        	<base:IsNotMember value="hardware" sourceAttrName="name(.)"/>
		        	<base:IsMember value="enterprise" sourceAttrName="#:trxBuilder"/>		        	
		        	<AndComposite>
		   				<base:IsMember value="true" sourceAttrName="
							'${name(/*/*/functions/*[@ID = '${refFunctionID/configured}'])}' = 'voice' or 
							'${name(/*/*/functions/*[@ID = '${refFunctionID/existing}'])}' = 'voice'"/>
						<OrComposite>							
							<base:IsMember value="true" sourceAttrName="#:voiceBillingChangesReady"/>
							<base:IsMember value="false" sourceAttrName="#:voiceHasTariffChange"/>
						</OrComposite>
		        	</AndComposite>
		        	<AndComposite>
		   				<base:IsMember value="true" sourceAttrName="
							'${name(/*/*/functions/*[@ID = '${refFunctionID/configured}'])}' = 'internet' or 
							'${name(/*/*/functions/*[@ID = '${refFunctionID/existing}'])}' = 'internet'"/>
						<OrComposite>
							<base:IsMember value="true" sourceAttrName="#:internetBillingChangesReady"/>
							<base:IsMember value="false" sourceAttrName="#:internetHasTariffChange"/>
						</OrComposite>
		        	</AndComposite>
		        </OrComposite>
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="conditionsList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/conditionsList/@action" />
            <RPMapping targetName="ignoreWrongServiceCode" 
            	sourceAttrName="name(.)"
            	decoding="'hardware', 'N', 'Y'" />
            
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/conditionsList/existing/*">
                    <TemplateConditions>
                        <OrComposite>
                            <base:IsExisting sourceAttrName="conditionServiceStartDate" />
                            <base:IsMember value="DL" sourceAttrName="conditionServiceType" />
                            <AndComposite>
                                <base:IsMember value="portingFinished" sourceAttrName="conditionServiceEndEvent" />
                                <base:IsMember value="1001" sourceAttrName="../../../../../../@orderPositionNumber" />
                            </AndComposite>
                        </OrComposite>
                    </TemplateConditions>                    
                    
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsNotMember value="HW" sourceAttrName="conditionServiceType" />
                        </TemplateConditions>                    
	                    <RPMapping targetName="serviceCode"
	                        sourceAttrName="conditionServiceType"
	                        decoding="
	                        'CO', 'V0045',
	                        'CM', 'V0046',
	                        'MO', 'V0317',
	                        'MM', 'V0318',
	                        'SB', 'V004A',
	                        'DL', 'V0303'" />
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="HW" sourceAttrName="conditionServiceType" />
                        </TemplateConditions>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsExisting sourceAttrName="conditionServiceCode" />
	                        </TemplateConditions>
	                        <RPMapping targetName="serviceCode" sourceAttrName="conditionServiceCode" />
                        </TransformationTemplate>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsNotExisting sourceAttrName="conditionServiceCode" />
	                        </TemplateConditions>
	                        <RPMapping targetName="serviceCode" staticValue="V0850" />
                        </TransformationTemplate>
                    </TransformationTemplate>
                        
                    <RPMapping targetName="conditionName" sourceAttrName="conditionServiceName" />
                    <RPMapping targetName="conditionId" sourceAttrName="conditionServiceID" />
                    <RPMapping targetName="specialBonusCode" sourceAttrName="conditionServiceSpecialBonusCode" />
                    <RPMapping targetName="startDate" sourceAttrName="conditionServiceStartDate" formatter="SOMToCCBDateFormatter"/>
                    <RPMapping targetName="endDate" sourceAttrName="conditionServiceEndDate" formatter="SOMToCCBDateFormatter"/>

                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="HW" sourceAttrName="conditionServiceType" />
                        </TemplateConditions>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsExisting sourceAttrName="../../../articleNumber/existing" />
	                            <base:IsExisting sourceAttrName="../../../articleNumber/configured" />
	                        </TemplateConditions>
	                        <RPMapping targetName="articleNumber"
	                        	sourceAttrName="../../../articleNumber/existing" />
                        </TransformationTemplate>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                        	<OrComposite>
		                            <base:IsNotExisting sourceAttrName="../../../articleNumber/existing" />
		                            <base:IsNotExisting sourceAttrName="../../../articleNumber/configured" />
	                            </OrComposite>
	                        </TemplateConditions>
	                        <RPMapping targetName="articleNumber"
	                        	sourceAttrName="../../../articleNumber"
								method="configuredExisting" />
                        </TransformationTemplate>
                        
                        <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsExisting sourceAttrName="../../../quantityOfPartiallyExchangedHardware" />
	                        </TemplateConditions>
							<RPMapping targetName="quantity"
								sourceAttrName="../../../quantityOfPartiallyExchangedHardware" />
						</TransformationTemplate>						                        
                        <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsNotExisting sourceAttrName="../../../quantityOfPartiallyExchangedHardware" />
	                        </TemplateConditions>
							<RPMapping targetName="quantity"
								sourceAttrName="../../../quantity"
								method="configuredExisting" />
						</TransformationTemplate>
						
                    </TransformationTemplate>

                </RPListItemTemplate>
            </RPListTemplate>
            
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/conditionsList/configured/*">
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsNotMember value="HW" sourceAttrName="conditionServiceType" />
                        </TemplateConditions>                    
	                    <RPMapping targetName="serviceCode"
	                        sourceAttrName="conditionServiceType"
	                        decoding="
	                        'CO', 'V0045',
	                        'CM', 'V0046',
	                        'MO', 'V0317',
	                        'MM', 'V0318',
	                        'SB', 'V004A',
	                        'DL', 'V0303'" />
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="HW" sourceAttrName="conditionServiceType" />
                        </TemplateConditions>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsExisting sourceAttrName="conditionServiceCode" />
	                        </TemplateConditions>
	                        <RPMapping targetName="serviceCode" sourceAttrName="conditionServiceCode" />
                        </TransformationTemplate>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsNotExisting sourceAttrName="conditionServiceCode" />
	                        </TemplateConditions>
	                        <RPMapping targetName="serviceCode" staticValue="V0850" />
                        </TransformationTemplate>
	                    <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsExisting sourceAttrName="conditionServiceStartDate" />
	                        </TemplateConditions>
	                        <RPMapping targetName="startDate" sourceAttrName="conditionServiceStartDate" formatter="SOMToCCBDateFormatter" />
                        </TransformationTemplate>
                                                
                    </TransformationTemplate>
                    <RPMapping targetName="conditionName" sourceAttrName="conditionServiceName" />
                    <RPMapping targetName="conditionId" sourceAttrName="conditionServiceID" />
                    <RPMapping targetName="specialBonusCode" sourceAttrName="conditionServiceSpecialBonusCode" />
                    <RPMapping targetName="endDate" sourceAttrName="conditionServiceEndDate" formatter="SOMToCCBDateFormatter"/>

                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="HW" sourceAttrName="conditionServiceType" />
                        </TemplateConditions>
                        <RPMapping targetName="articleNumber"
                        	sourceAttrName="../../../articleNumber"
							method="configuredExisting" />
                        
                        <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsExisting sourceAttrName="../../../quantityOfPartiallyExchangedHardware" />
	                        </TemplateConditions>
							<RPMapping targetName="quantity"
								sourceAttrName="../../../quantityOfPartiallyExchangedHardware" />
						</TransformationTemplate>						                        
                        <TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsNotExisting sourceAttrName="../../../quantityOfPartiallyExchangedHardware" />
	                        </TemplateConditions>
							<RPMapping targetName="quantity"
								sourceAttrName="../../../quantity"
								method="configuredExisting" />
						</TransformationTemplate>	
						<TransformationTemplate>
	                        <TemplateConditions>
	                            <base:IsNotExisting sourceAttrName="conditionServiceStartDate" />
	                            <base:IsMember value="1" sourceAttrName="count(../../existing/*/conditionServiceStartDate)" />
	                        </TemplateConditions>
	                    	<RPMapping targetName="startDate" sourceAttrName="../../existing/*/conditionServiceStartDate" formatter="SOMToCCBDateFormatter"/>
	                    </TransformationTemplate>
                    </TransformationTemplate>

                </RPListItemTemplate>
                <RPListItemTemplate sourceWorkingPath="*/conditionsList/existing/*">
                    <TemplateConditions>
                        <base:IsNotExisting sourceAttrName="../../configured" />
                        <base:IsMember value="true" sourceAttrName="../../../articleNumber/existing != ../../../articleNumber/configured" />
                    </TemplateConditions>                    
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsExisting sourceAttrName="conditionServiceCode" />
                        </TemplateConditions>
                        <RPMapping targetName="serviceCode" sourceAttrName="conditionServiceCode" />
                       </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsNotExisting sourceAttrName="conditionServiceCode" />
                        </TemplateConditions>
                        <RPMapping targetName="serviceCode" staticValue="V0850" />
                       </TransformationTemplate>
                    <RPMapping targetName="conditionName" sourceAttrName="conditionServiceName" />
                    <RPMapping targetName="conditionId" sourceAttrName="conditionServiceID" />
                    <RPMapping targetName="startDate" sourceAttrName="conditionServiceStartDate" formatter="SOMToCCBDateFormatter" />
                    <RPMapping targetName="endDate" sourceAttrName="conditionServiceEndDate" formatter="SOMToCCBDateFormatter"/>

                    <RPMapping targetName="articleNumber" sourceAttrName="../../../articleNumber/configured" />

                </RPListItemTemplate>

            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesBlockingServices_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/blockingList/*/*" />
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                </OrComposite>                
                <OrComposite>
                    <base:IsExisting sourceAttrName="*/blockingList/configured" />
                    <base:IsMember value="remove" sourceAttrName="*/blockingList/@action" />
                    <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>                  
                </OrComposite>                
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="blockingList" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <RPMapping targetName="action" sourceAttrName="*/blockingList/@action" />
            <RPListTemplate listName="existingServiceList">
                <RPListItemTemplate sourceWorkingPath="*/blockingList/existing/*">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="*/blockingList/configured/*">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <!-- template for feature lists which are functionally not for specific functions, but on
            access level. Therefore the features can be either put on voice or internet. FIF will then
            use the appropriate function to attach the services too -->
        <AbstractTransformationTemplate ID="modifyFeaturesWithAlternatives_template" extends="modifyFeatures_template">
            
            <!-- don't use this functionality for WF12 -->
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                </TemplateConditions>                    
                
                <!-- use the respective other main function for NGN and Bitstream -->            
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="@refAccessID = '${#:currentMainAccessID}'" />
                        <base:IsMember value="true" sourceAttrName="
                            '${#:targetTechnology}' != 'ISDN'
                            and '${#:targetTechnology}' != ''
                            or
                            '${#:targetTechnology}' = ''
                            and '${#:currentTechnology}' != 'ISDN'" />
                        <OrComposite>
                            <base:IsMember value="voice" sourceAttrName="name(.)" />
                            <base:IsMember value="internet" sourceAttrName="name(.)" />
                        </OrComposite>
                    </TemplateConditions>
                    <RPMapping targetName="useAlternativeFunction" staticValue="B" />
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="voice" sourceAttrName="name(.)" />
                        </TemplateConditions>
                        <RPMapping targetName="alternativeFunctionID"
                            sourceAttrName="../internet[@refAccessID = '${#:currentMainAccessID}']/@ID" />
                        <TransformationTemplate>
                            <TemplateConditions>
                                <base:IsNotMember value="true" sourceAttrName="#:isProductChangeScenario" />
                            </TemplateConditions>
                            <RPMapping targetName="alternativeServiceSubscriptionId"
                                sourceAttrName="../internet[@refAccessID = '${#:currentMainAccessID}']/ccbId[@type='S']/existing" />
                        </TransformationTemplate>
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="internet" sourceAttrName="name(.)" />
                        </TemplateConditions>
                        <RPMapping targetName="alternativeFunctionID"
                            sourceAttrName="../voice[@refAccessID = '${#:currentMainAccessID}']/@ID" />
                        <TransformationTemplate>
                            <TemplateConditions>
                                <base:IsNotMember value="true" sourceAttrName="#:isProductChangeScenario" />
                            </TemplateConditions>
                            <RPMapping targetName="alternativeServiceSubscriptionId"
                                sourceAttrName="../voice[@refAccessID = '${#:currentMainAccessID}']/ccbId[@type='S']/existing" />
                        </TransformationTemplate>
                    </TransformationTemplate>
                </TransformationTemplate>
                
                <!-- use voice in case of internet for ISDN -->
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="@refAccessID = '${#:currentMainAccessID}'" />
                        <base:IsMember value="true" sourceAttrName="
                            '${#:targetTechnology}' = 'ISDN'
                            or
                            '${#:targetTechnology}' = ''
                            and '${#:currentTechnology}' = 'ISDN'" />
                        <base:IsMember value="internet" sourceAttrName="name(.)" />
                    </TemplateConditions>
                    <RPMapping targetName="useAlternativeFunction" staticValue="Y" />
                    <RPMapping targetName="alternativeFunctionID"
                        sourceAttrName="../voice[@refAccessID = '${#:currentMainAccessID}']/@ID" />
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsNotMember value="true" sourceAttrName="#:isProductChangeScenario" />
                        </TemplateConditions>
                        <RPMapping targetName="alternativeServiceSubscriptionId"
                            sourceAttrName="../voice[@refAccessID = '${#:currentMainAccessID}']/ccbId[@type='S']/existing" />
                    </TransformationTemplate>
                </TransformationTemplate>
            </TransformationTemplate>
        </AbstractTransformationTemplate>

        <AbstractTransformationTemplate ID="modifyFeaturesDSLBandwidth_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                    <base:IsMember value="true" sourceAttrName="#:isDSLUpgrade" />
                    <base:IsMember value="true" sourceAttrName="#:isBandwidthChange" />
                </OrComposite>                
                <base:IsNotMember value="true" sourceAttrName="#:isDSLDowngrade" />
                <base:IsNotMember value="TERM" sourceAttrName="../internet/processingType" />
                <base:IsMember value="true" sourceAttrName="
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'businessDSL' or
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'businessDSLProfi' or
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'isdn' or
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'isdnP2P' or
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'ngn' or
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'ipBitstream' or
                    name(../../accesses/*[@ID = '${@refAccessID}']) = 'lte' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'businessDSL' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'businessDSLProfi' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'isdn' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'isdnP2P' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'ngn' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'ipBitstream' or
                    name(../../accesses/*[@ID = '${@targetAccessID}']) = 'lte'" />                
                <OrComposite>
                    <AndComposite>
                        <base:IsMember value="internet" sourceAttrName="name(.)" />
                        <base:IsNotMember value="ISDN" sourceAttrName="#:targetTechnology" />
                        <base:IsNotMember value="ISDNP2P" sourceAttrName="#:targetTechnology" />
                        <OrComposite>
                            <base:IsMember value="true" sourceAttrName="#:newInternetMainAccess" />
                            <base:IsMember value="true" sourceAttrName="#:isBandwidthChange" />                            
                        </OrComposite>                        
                    </AndComposite>
                    <AndComposite>
                        <base:IsMember value="voice" sourceAttrName="name(.)" />
                        <OrComposite>
                            <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology" />
                            <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology" />
                        </OrComposite>
                        <OrComposite>
                            <base:IsMember value="true" sourceAttrName="#:newVoiceMainAccess" />
                            <base:IsMember value="true" sourceAttrName="#:isBandwidthChange" />
                            <base:IsMember value="true" sourceAttrName="#:isDSLUpgrade" />
                        </OrComposite>                        
                    </AndComposite>
                </OrComposite>   
            </TemplateConditions>
            
            <base:DataBufferWriter keyValue="listType" staticValue="DSLBandwidth" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/existing" />
                </TemplateConditions>
                <RPListTemplate listName="existingServiceList">
                    <RPListItemTemplate sourceWorkingPath="../internet/*/DSLBandwidth/existing">
                        <RPMapping sourceAttrName="." targetName="serviceCode" />
                    </RPListItemTemplate>
                </RPListTemplate>
            </TransformationTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="../internet/*/DSLBandwidth/configured">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                    <RPMapping sourceAttrName="../../minimumDurationPeriod/value"
                        targetName="minPeriodDurationValue"
                        method="configuredExisting"/>
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <!-- upstream bandwidth for ISDN -->
        <AbstractTransformationTemplate ID="modifyFeaturesDSLUpstreamBandwidth_template" extends="modifyFeatures_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
                    <base:IsNotMember value="IGNORE" sourceAttrName="processingType"/>
                    <base:IsNotMember value="noactionCOM" sourceAttrName="processingStatus"/>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/configured"/>
                    <base:IsMember value="true" sourceAttrName="#:isDSLUpgrade" />
                    <base:IsMember value="true" sourceAttrName="#:isUpstreamBandwidthChange" />
                </OrComposite>
                <base:IsNotMember value="true" sourceAttrName="#:isDSLDowngrade" />
                <base:IsNotMember value="TERM" sourceAttrName="../internet/processingType" />                
                <OrComposite>
	                <base:IsMember value="true" sourceAttrName="name(.) = 'voice' and 
		                ('${#:targetTechnology}' = 'ISDN' or '${#:targetTechnology}' = 'ISDNP2P')" />
	                <base:IsMember value="true" sourceAttrName="name(.) = 'internet' and 
	                	'${#:targetTechnology}' = 'BitStream'" />
	                <base:IsMember value="true" sourceAttrName="name(.) = 'internet' and 
	                	'${#:targetInternetAccess}' = 'businessDSL'" />
	                <base:IsMember value="true" sourceAttrName="name(.) = 'internet' and 
	                	'${#:targetInternetAccess}' = 'ipBitstream'" />
                </OrComposite>
                <base:IsMember value="true" sourceAttrName="#:createUpstreamBandwidth" />
            </TemplateConditions>
            <base:DataBufferWriter keyValue="listType" staticValue="upstreamBandwidth" />
            <RPMapping targetName="listType" sourceAttrName="#:listType" />
            <!-- set the specific reason only in case of a pure bandwidth change (no clone scenario) -->
            <RPMapping targetName="parentServiceCode" 
                sourceAttrName="../internet/*/DSLBandwidth"
                method="configuredExisting" />            
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="ccbId[@type = 'S']/existing" />
                </TemplateConditions>
                <RPListTemplate listName="existingServiceList">
                    <RPListItemTemplate sourceWorkingPath="../internet/*/upstreamBandwidth/existing">
                        <RPMapping sourceAttrName="." targetName="serviceCode" />
                    </RPListItemTemplate>
                </RPListTemplate>
            </TransformationTemplate>
            <RPListTemplate listName="configuredServiceList">
                <RPListItemTemplate sourceWorkingPath="../internet/*/upstreamBandwidth/configured">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
            <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
        </AbstractTransformationTemplate>

        <!-- fibre fee -->
        <AbstractTransformationTemplate ID="modifyFeaturesFibreFee_template"
          extends="modifyFeatures_template">
          <TemplateConditions>
            <base:IsMember value="internet" sourceAttrName="name(.)"/>
            <base:IsExisting sourceAttrName="fibreInternetConfiguration"/>
            <base:IsMember value="true" sourceAttrName="count(*/fibreFee/*/featureServiceCode) > 0"/>
            <OrComposite>
               <base:IsNotExisting sourceAttrName="@targetAccessID"/>
               <AndComposite>
                  <base:IsExisting sourceAttrName="@targetAccessID"/>
                  <OrComposite>
                     <base:IsMember value="FTTH" sourceAttrName="#:targetTechnology"/>
                     <base:IsMember value="businessDSL" sourceAttrName="#:targetTechnology"/>
                  </OrComposite>
               </AndComposite>
            </OrComposite>
          </TemplateConditions>
          <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="*/fibreFee/existing/featureServiceCode != ''"/>
            </TemplateConditions>
            <RPListTemplate listName="existingServiceList">
              <RPListItemTemplate sourceWorkingPath="*/fibreFee/existing">
                  <RPMapping sourceAttrName="featureServiceCode" targetName="serviceCode" />
                  <RPListTemplate listName="additionalInfo">
                      <RPListItemTemplate sourceWorkingPath="additionalInfo">
                          <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                          <RPMapping sourceAttrName="value" targetName="value" />
                      </RPListItemTemplate>                        
                  </RPListTemplate>
              </RPListItemTemplate>
            </RPListTemplate>
          </TransformationTemplate>
          <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="*/fibreFee/configured/featureServiceCode != ''"/>
            </TemplateConditions>
            <RPListTemplate listName="configuredServiceList">
              <RPListItemTemplate sourceWorkingPath="*/fibreFee/configured">
                  <RPMapping sourceAttrName="featureServiceCode" targetName="serviceCode" />
                  <RPListTemplate listName="additionalInfo">
                      <RPListItemTemplate sourceWorkingPath="additionalInfo">
                          <RPMapping sourceAttrName="key" targetName="serviceCharCode" />
                          <RPMapping sourceAttrName="value" targetName="value" />
                      </RPListItemTemplate>                        
                  </RPListTemplate>
              </RPListItemTemplate>
            </RPListTemplate>
          </TransformationTemplate>
          <base:DataBufferWriter keyValue="listType" staticValue="FibreFee" />
          <RPMapping targetName="listType" sourceAttrName="#:listType" />
          <base:Include fileIDRef="functionParameters" partIDRef="reasonPTNProcessingStatusForFeatures"/>
          <RPMapping targetName="ignoreDuplicates" staticValue="Y" />
        </AbstractTransformationTemplate>    
        
    </baseInclusion:Part>

    <baseInclusion:Part id="entityParameters">
        <!-- parameters for organizations -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="ACCESS_USER" sourceAttrName="contactRoleTypeRd/configured"/>
                <base:IsExisting sourceAttrName="organization" />
            </TemplateConditions>
            <RPMapping targetName="entityType" staticValue="O" />
            <RPMapping targetName="salutationDescription" sourceAttrName="organization/salutation" method="configuredExisting" />
            <RPMapping targetName="name" sourceAttrName="organization/name" method="configuredExisting" />
            <RPMapping targetName="organizationSuffixName" sourceAttrName="organization/organizationSuffixName" method="configuredExisting" />
            <RPMapping targetName="incorporationNumber" sourceAttrName="organization/incorporationNumber" method="configuredExisting" />
            <RPMapping targetName="incorporationType" sourceAttrName="organization/incorporationType" method="configuredExisting" />
            <RPMapping targetName="incorporationCityName" sourceAttrName="organization/incorporationCityName" method="configuredExisting" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="organization/organizationType/configured" />
                    <base:IsNotExisting sourceAttrName="organization/organizationType/existing" />
                </TemplateConditions>
                <RPMapping staticValue="BLANK" targetName="organizationType" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <OrComposite>
                        <base:IsExisting sourceAttrName="organization/organizationType/configured" />
                        <base:IsExisting sourceAttrName="organization/organizationType/existing" />
                    </OrComposite>
                </TemplateConditions>
                <RPMapping targetName="organizationType" sourceAttrName="organization/organizationType" method="configuredExisting" />
            </TransformationTemplate>
        </TransformationTemplate>

        <!-- parameters for individuals -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="ACCESS_USER" sourceAttrName="contactRoleTypeRd/configured"/>
                <base:IsExisting sourceAttrName="individual" />
            </TemplateConditions>
            <RPMapping targetName="entityType" staticValue="I" />
            <RPMapping targetName="salutationDescription" sourceAttrName="individual/salutation" method="configuredExisting" />
            <RPMapping targetName="name" sourceAttrName="individual/name" method="configuredExisting" />
            <RPMapping targetName="forename" sourceAttrName="individual/forename" method="configuredExisting" />
            <RPMapping targetName="titleDescription" sourceAttrName="individual/titleDescription" method="configuredExisting" />
            <RPMapping targetName="nobilityPrefixDescription" sourceAttrName="individual/nobilityPrefixDescription" method="configuredExisting" />
            <RPMapping targetName="surnamePrefix" sourceAttrName="individual/surnamePrefix" method="configuredExisting" />
            <RPMapping targetName="birthDate" sourceAttrName="individual/birthDate" method="configuredExisting" formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>

        <!-- parameters for organizations -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="ACCESS_USER" sourceAttrName="contactRoleTypeRd/configured"/>
                <base:IsExisting sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization" />
            </TemplateConditions>
            <RPMapping targetName="entityType" staticValue="O" />
            <RPMapping targetName="salutationDescription" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/salutation" method="configuredExisting" />
            <RPMapping targetName="name" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/name" method="configuredExisting" />
            <RPMapping targetName="organizationSuffixName" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/organizationSuffixName" method="configuredExisting" />
            <RPMapping targetName="incorporationNumber" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/incorporationNumber" method="configuredExisting" />
            <RPMapping targetName="incorporationType" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/incorporationType" method="configuredExisting" />
            <RPMapping targetName="incorporationCityName" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/incorporationCityName" method="configuredExisting" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/organizationType/configured" />
                    <base:IsNotExisting sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/organizationType/existing" />
                </TemplateConditions>
                <RPMapping staticValue="BLANK" targetName="organizationType" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <OrComposite>
                        <base:IsExisting sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/organizationType/configured" />
                        <base:IsExisting sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/organizationType/existing" />
                    </OrComposite>
                </TemplateConditions>
                <RPMapping targetName="organizationType" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/organization/organizationType" method="configuredExisting" />
            </TransformationTemplate>
        </TransformationTemplate>

        <!-- parameters for individuals -->
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="ACCESS_USER" sourceAttrName="contactRoleTypeRd/configured"/>
                <base:IsExisting sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual" />
            </TemplateConditions>
            <RPMapping targetName="entityType" staticValue="I" />
            <RPMapping targetName="salutationDescription" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/salutation" method="configuredExisting" />
            <RPMapping targetName="name" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/name" method="configuredExisting" />
            <RPMapping targetName="forename" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/forename" method="configuredExisting" />
            <RPMapping targetName="titleDescription" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/titleDescription" method="configuredExisting" />
            <RPMapping targetName="nobilityPrefixDescription" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/nobilityPrefixDescription" method="configuredExisting" />
            <RPMapping targetName="surnamePrefix" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/surnamePrefix" method="configuredExisting" />
            <RPMapping targetName="birthDate" sourceAttrName="../customer[@ID = '${@ownerNodeRefID}']/individual/birthDate" method="configuredExisting" formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/accessInformation/configured" />
            </TemplateConditions>
            <RPMapping targetName="phoneNumber" sourceAttrName="*/accessInformation/configured/phoneNumber" />
            <RPMapping targetName="contactName" sourceAttrName="*/accessInformation/configured/contactName" />
            <RPMapping targetName="mobileNumber" sourceAttrName="*/accessInformation/configured/mobileNumber" />
            <RPMapping targetName="vodafoneMobileNumber" sourceAttrName="*/accessInformation/configured/vodafoneMobileNumber" />
            <RPMapping targetName="faxNumber" sourceAttrName="*/accessInformation/configured/faxNumber" />
            <RPMapping targetName="emailAddress" sourceAttrName="*/accessInformation/configured/emailAddress" />
	        
	        <!-- IT-k-33034: retrigger open email validations, if order is initiated by KSC -->
	        <TransformationTemplate>
	            <TemplateConditions>
	                <base:IsMember value="true" sourceAttrName="count(/order/customerChange) > 0" />
	                <OrComposite>
	                	<base:IsMember value="KSC" sourceAttrName="/order/entrySystem" />
	                	<base:IsMember value="MyVF" sourceAttrName="/order/entrySystem" />
	                </OrComposite>
	                <base:IsNotExisting sourceAttrName="*/accessInformation/configured/emailValidationResult/validationResult" />
	            </TemplateConditions>
	            <RPMapping targetName="emailValidationIndicator" 
	            	sourceAttrName="*/accessInformation/existing/emailValidationResult/validationResult"
	            	decoding="'IN_VALIDATION', 'FORCE', ''" />
			</TransformationTemplate>
			            
	        <TransformationTemplate>
	            <TemplateConditions>
	            	<OrComposite>
		                <base:IsNotMember value="true" sourceAttrName="count(/order/customerChange) > 0" />
		                <AndComposite>
		                	<base:IsNotMember value="KSC" sourceAttrName="/order/entrySystem" />
		                	<base:IsNotMember value="MyVF" sourceAttrName="/order/entrySystem" />
		                </AndComposite>
		                <base:IsExisting sourceAttrName="*/accessInformation/configured/emailValidationResult/validationResult" />
	                </OrComposite>
	            </TemplateConditions>
	            <RPMapping targetName="emailValidationIndicator" 
	            	sourceAttrName="*/accessInformation/configured/emailValidationResult/validationResult"
	            	decoding="'VALIDATED', 'SUPPRESS', 'FORCE', 'FORCE'" />
			</TransformationTemplate>
			            
            <RPMapping targetName="electronicContactIndicator" sourceAttrName="*/accessInformation/configured/electronicContactIndicator" decoding="'true','Y','N'" />
            <RPMapping targetName="accessInformationTyp" sourceAttrName="*/accessInformation/configured/accessInformationType" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/accessInformation/configured" />
            </TemplateConditions>
            <RPMapping targetName="phoneNumber" sourceAttrName="*/accessInformation/existing/phoneNumber" />
            <RPMapping targetName="contactName" sourceAttrName="*/accessInformation/existing/contactName" />
            <RPMapping targetName="mobileNumber" sourceAttrName="*/accessInformation/existing/mobileNumber" />
            <RPMapping targetName="vodafoneMobileNumber" sourceAttrName="*/accessInformation/existing/vodafoneMobileNumber" />
            <RPMapping targetName="faxNumber" sourceAttrName="*/accessInformation/existing/faxNumber" />
            <RPMapping targetName="emailAddress" sourceAttrName="*/accessInformation/existing/emailAddress" />
            <RPMapping targetName="electronicContactIndicator" sourceAttrName="*/accessInformation/existing/electronicContactIndicator" decoding="'true','Y','N'" />
            <RPMapping targetName="accessInformationTyp" sourceAttrName="*/accessInformation/existing/accessInformationType" />
        </TransformationTemplate>

        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="*/address/configured" />
            </TemplateConditions>
            <RPMapping targetName="streetName" sourceAttrName="*/address/configured/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="*/address/configured/streetNumber" />
            <RPMapping targetName="postalCode" sourceAttrName="*/address/configured/postalCode" />
            <RPMapping targetName="cityName" sourceAttrName="*/address/configured/city" />
            <RPMapping targetName="citySuffix" sourceAttrName="*/address/configured/citySuffix" />
            <RPMapping targetName="additionalText" sourceAttrName="*/address/configured/additionalAddressDescription" />
            <RPMapping targetName="numberSuffix" sourceAttrName="*/address/configured/streetNumberSuffix" />
            <RPMapping targetName="postOfficeBox" sourceAttrName="*/address/configured/postOfficeBox" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="/order/customerCreation" />
                </TemplateConditions>
                <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="/order/customerCreation" />
                </TemplateConditions>
                <RPMapping targetName="validationTypeRd" staticValue="FUZZY_POST" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="*/address/configured/country" />
                </TemplateConditions>
                <RPMapping targetName="countryCode" sourceAttrName="*/address/configured/country" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="*/address/configured/country" />
                </TemplateConditions>
                <RPMapping targetName="countryCode" staticValue="DE" />
            </TransformationTemplate>
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="*/address/configured" />
            </TemplateConditions>
            <RPMapping targetName="streetName" sourceAttrName="*/address/existing/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="*/address/existing/streetNumber" />
            <RPMapping targetName="postalCode" sourceAttrName="*/address/existing/postalCode" />
            <RPMapping targetName="cityName" sourceAttrName="*/address/existing/city" />
            <RPMapping targetName="citySuffix" sourceAttrName="*/address/existing/citySuffix" />
            <RPMapping targetName="additionalText" sourceAttrName="*/address/existing/additionalAddressDescription" />
            <RPMapping targetName="numberSuffix" sourceAttrName="*/address/existing/streetNumberSuffix" />
            <RPMapping targetName="postOfficeBox" sourceAttrName="*/address/existing/postOfficeBox" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="/order/customerCreation" />
                </TemplateConditions>
                <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="/order/customerCreation" />
                </TemplateConditions>
                <RPMapping targetName="validationTypeRd" staticValue="FUZZY_POST" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="*/address/existing/country" />
                </TemplateConditions>
                <RPMapping targetName="countryCode" sourceAttrName="*/address/existing/country" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="*/address/existing/country" />
                </TemplateConditions>
                <RPMapping targetName="countryCode" staticValue="DE" />
            </TransformationTemplate>
        </TransformationTemplate>
    </baseInclusion:Part>

    <baseInclusion:Part id="parameterList">
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="configured" sourceAttrName="name(.)" />
                <base:IsNotMember value="existing" sourceAttrName="name(.)" />
                <base:IsNotMember value="pricingStructureBillingName" sourceAttrName="name(.)" />
                <base:IsNotMember value="productCode" sourceAttrName="name(.)" />
                <base:IsNotMember value="productBillingName" sourceAttrName="name(.)" />
                <base:IsNotMember value="productVersionCode" sourceAttrName="name(.)" />
                <base:IsNotMember value="mainAccessServiceCode" sourceAttrName="name(.)" />
                <base:IsNotMember value="boardSignName" sourceAttrName="name(.)" />
                <base:IsNotMember value="boardSignDate" sourceAttrName="name(.)" />
                <base:IsNotMember value="primaryCustSignName" sourceAttrName="name(.)" />
                <base:IsNotMember value="pricingStructureCode" sourceAttrName="name(.)" />
                <base:IsNotMember value="minimumDurationPeriod" sourceAttrName="name(.)" />
                <base:IsNotMember value="autoExtension" sourceAttrName="name(.)" />
                <base:IsNotMember value="noticePeriod" sourceAttrName="name(.)" />
                <base:IsNotMember value="specialTerminationRight" sourceAttrName="name(.)" />
                <base:IsNotMember value="conditionsList" sourceAttrName="name(.)" />
                <base:IsNotMember value="featuresList" sourceAttrName="name(.)" />
                <base:IsNotMember value="tariffOptionsList" sourceAttrName="name(.)" />
                <base:IsNotMember value="desiredCountriesList" sourceAttrName="name(.)" />
                <base:IsNotMember value="chargesAndCreditsList" sourceAttrName="name(.)" />
                <base:IsNotMember value="blockingList" sourceAttrName="name(.)" />
                <base:IsNotMember value="licencesList" sourceAttrName="name(.)" />
                <base:IsNotMember value="licenceOptionsList" sourceAttrName="name(.)" />
                <base:IsNotMember value="portingAccessNumbers" sourceAttrName="name(.)" />
                <base:IsNotMember value="portingAccessNumberRanges" sourceAttrName="name(.)" />
                <base:IsNotMember value="iadPinChange" sourceAttrName="name(.)" />
                <base:IsNotMember value="previousCompletionStatusNewCcbId" sourceAttrName="name(.)" />
                <base:IsNotMember value="previousCompletionStatusOldCcbId" sourceAttrName="name(.)" />
                <base:IsNotMember value="setTopBoxPinChange" sourceAttrName="name(.)" />
                <base:IsNotMember value="tvPinChange" sourceAttrName="name(.)" />
                <base:IsNotMember value="adultPinChange" sourceAttrName="name(.)" />
                <base:IsNotMember value="numberOfNewAccessNumbers" sourceAttrName="name(.)" />   
                <base:IsNotMember value="listedAddress" sourceAttrName="name(.)" />   
                <base:IsNotMember value="directoryEntryText" sourceAttrName="name(.)" />   
                <base:IsNotMember value="titleDescription" sourceAttrName="name(.)" />   
                <base:IsNotMember value="surnamePrefix" sourceAttrName="name(.)" />   
                <base:IsNotMember value="forename" sourceAttrName="name(.)" />   
                <base:IsNotMember value="callForwarding" sourceAttrName="name(.)" />
                <base:IsNotMember value="kiasReference" sourceAttrName="name(.)" />
				<base:IsNotMember value="volumeCap" sourceAttrName="name(.)" />
                
                <OrComposite>
                    <!-- no existing and configured at all, e.g. DTAGContractNumber -->
                    <AndComposite>
                        <base:IsNotExisting sourceAttrName="configured" />
                        <base:IsNotExisting sourceAttrName="existing" />
                        <base:IsNotExisting sourceAttrName="@action" />
                        <OrComposite>
                            <!-- if the referencing function doesn't contain a targetAccess, there's only one element like this, just use it -->
                            <base:IsNotMember value="true" sourceAttrName="
                                count(/*/*/functions/voice[@refAccessID = '${../../@ID}' or @targetAccessID = '${../../@ID}']/@targetAccessID) > 0" />
                            <AndComposite>
                                <!-- if the referencing function contains a targetAccess, it gets tricky-->
                                <base:IsMember value="true" sourceAttrName="
                                    count(/*/*/functions/voice[@refAccessID = '${../../@ID}' or @targetAccessID = '${../../@ID}']/@targetAccessID) > 0" />
                                <OrComposite>
                                    <!-- if the current element is in the refAccess, use this, if there's no respective element in the target -->
                                    <AndComposite>                                    
                                        <base:IsMember value="true" sourceAttrName="
                                            count(/*/*/functions/voice[@refAccessID = '${../../@ID}']) > 0" />
                                        <base:IsMember value="true" sourceAttrName="
                                            count(../../../*[@ID = 
                                            '${/*/*/functions/voice[@refAccessID = '${../../@ID}' or @targetAccessID = '${../../@ID}']/@targetAccessID}'
                                            ]/*/${name(.)}) = 0" />                                        
                                    </AndComposite>                                    
                                    <!-- if the current element is in the targetAccess, use this -->                                    
                                    <base:IsMember value="true" sourceAttrName="
                                        count(/*/*/functions/voice[@targetAccessID = '${../../@ID}']) > 0" />
                                </OrComposite>
                                
                            </AndComposite>
                        </OrComposite>                        
                    </AndComposite>
                    <!-- action attribute exists, independent of existing or configured values -->
                    <base:IsExisting sourceAttrName="@action" />                    
                    <!-- configured exists, independent of existing values -->
                    <base:IsExisting sourceAttrName="configured" />
                    <!-- existing, but no configured value -->
                    <AndComposite>
                        <base:IsExisting sourceAttrName="existing" />
                        <base:IsNotExisting sourceAttrName="configured" />
                        <OrComposite>
                            <AndComposite>
                                <!-- function parameter (initialContractStartDate) -->
                                <base:IsMember value="functions" sourceAttrName="name(../..)" />
                            </AndComposite>
                            <AndComposite>
                                <!-- no function configuration parameter -->
                                <base:IsMember value="functions" sourceAttrName="name(../../..)" />
                                <base:IsNotExisting sourceAttrName="../../*/${name(.)}/configured" />
                                <base:IsNotExisting sourceAttrName="../../*/${name(.)}/@action" />
                            </AndComposite>
                            <AndComposite>
                                <!-- no portingAccessNumber parameter -->
                                <base:IsMember value="functions" sourceAttrName="name(../../../..)" />
                                <base:IsNotExisting sourceAttrName="../../../*/*/${name(.)}/configured" />
                                <base:IsNotExisting sourceAttrName="../../../*/*/${name(.)}/@action" />
                            </AndComposite>
                            <AndComposite>
                                <!-- no access configuration parameter -->
                                <base:IsMember value="true" sourceAttrName="#:isTechnologyChange" />
                                <base:IsMember value="accesses" sourceAttrName="name(../../..)" />
                                <base:IsNotExisting sourceAttrName="../../../*/*/${name(.)}/configured" />
                                <base:IsNotExisting sourceAttrName="../../../*/*/${name(.)}/@action" />
                            </AndComposite>
                            <AndComposite>
                                <!-- no access configuration parameter -->
                                <base:IsNotMember value="true" sourceAttrName="#:isTechnologyChange" />
                                <base:IsMember value="accesses" sourceAttrName="name(../../..)" />
                                <base:IsNotExisting sourceAttrName="../${name(.)}/configured" />
                                <base:IsNotExisting sourceAttrName="../${name(.)}/@action" />
                            </AndComposite>
                        </OrComposite>
                    </AndComposite>
                </OrComposite>                
            </TemplateConditions>

            <base:DataBufferWriter keyValue="isPortingAccessNumbersParameter"
                sourceAttrName="name(..) = 'portingAccessNumbers' or name(..) = 'portingAccessNumberRanges'" />           
            <base:DataBufferWriter keyValue="isSimpleParameter"
                sourceAttrName="count(existing | configured) > 0 and count(existing/* | configured/*) = 0 and name(.)!='salutationDescription'" /> 
            <base:DataBufferWriter keyValue="isAccessFunctionParameter"
                sourceAttrName="name(.) = 'remarks' or name(.) = 'customerCallBackNumber'" /> 
            <base:DataBufferWriter keyValue="isAccessParameter"
                sourceAttrName="name(../../..) = 'accesses'" />
            <base:DataBufferWriter keyValue="isAccessNumber"
                sourceAttrName="count(*/countryCode) > 0" />
            <base:DataBufferWriter keyValue="isAccessNumberRange"
                sourceAttrName="count(*/startNumber) > 0" />
            <base:DataBufferWriter keyValue="isAddress"
                sourceAttrName="count(*/street) > 0" />
            <base:DataBufferWriter keyValue="isServiceLocation"
                sourceAttrName="count(*/floor | */room | */jackLocation | */desk | */additionalInformation) > 0" />
            <base:DataBufferWriter keyValue="isLineOwner"
                sourceAttrName="count(*/firstName | */name) > 0 and name(.)!='hardwareRecipient'" />
            <base:DataBufferWriter keyValue="hasExisting"
                sourceAttrName="count(existing) > 0" />
            <base:DataBufferWriter keyValue="existingPath"
                sourceAttrName="concat('${#:hasExisting}', '${#:isAccessParameter}', '${#:isPortingAccessNumbersParameter}')"
                decoding="
                'falsetruefalse', '../../../*/*/', 'falsefalsefalse', '../../*/', 'falsefalsetrue', '../../../*/*/',
                'truetruefalse', '../', 'truefalsefalse', '../', 'truefalsetrue', '../'" />
            
            <base:DataBufferWriter keyValue="isHardwareRecipientConfigured"
                sourceAttrName="count(../hardwareRecipient/configured)>0" />
            
            <base:DataBufferWriter keyValue="isHardwareRecipientExisting"
                sourceAttrName="count(../hardwareRecipient/existing) > 0 and count(../hardwareRecipient/configured) = 0 " />
            
            <base:DataBufferWriter keyValue="isSalutationDescriptionConfigured"
                sourceAttrName="count(../salutationDescription/configured)>0" />
            
            <base:DataBufferWriter keyValue="isSalutationDescriptionExisting"
                sourceAttrName="count(../salutationDescription/existing) > 0 and count(../salutationDescription/configured) = 0 " />
            
            
            
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotMember value="salutationDescription" sourceAttrName="name(.)" />
                    <base:IsNotMember value="hardwareRecipient" sourceAttrName="name(.)" />
                </TemplateConditions>
                <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <OrComposite>                
                        <base:IsMember value="salutationDescription" sourceAttrName="name(.)" />
                        <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                    </OrComposite>                
                </TemplateConditions>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                        <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>            
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>                              
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="salutationDescription" sourceAttrName="name(.)" />
                        <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>                
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="salutationDescription" sourceAttrName="name(.)" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                        <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                        <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                        <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientExisting" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="name(.)" targetName="parameterName" />
                </TransformationTemplate>
                
            </TransformationTemplate>
            
                                            
            
          
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="@action" />
                </TemplateConditions>
                <RPMapping sourceAttrName="@action" targetName="action" />
            </TransformationTemplate>

            <!-- read from existing value -->
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="${#:existingPath}${name(.)}/existing" />
                    <base:IsNotMember value="listedPhoneNumber" sourceAttrName="name(.)" />
                </TemplateConditions>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isSimpleParameter" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing" targetName="existingValue" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAccessNumber" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/countryCode" targetName="existingCountryCode" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/localAreaCode" targetName="existingAreaCode" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/pilotNumber" targetName="existingLocalNumber" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAccessNumberRange" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/startNumber" targetName="existingStartNumber" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/endNumber" targetName="existingEndNumber" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isLineOwner" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/name" targetName="existingName" /> 
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/firstName" targetName="existingFirstName" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isServiceLocation" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/floor" targetName="existingFloor" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/room" targetName="existingRoomNumber" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/jackLocation" targetName="existingJackLocation" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/desk" targetName="existingDeskNumber" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/additionalInformation" targetName="existingAdditionalLocationInfo" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAddress" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/street" targetName="existingStreet" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/streetNumber" targetName="existingStreetNumber" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/streetNumberSuffix" targetName="existingStreetNumberSuffix" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/postalCode" targetName="existingPostalCode" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/city" targetName="existingCity" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/citySuffix" targetName="existingCitySuffix" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/additionalAddressDescription" targetName="existingAdditionalAddressDescription" />
                    <RPMapping sourceAttrName="${#:existingPath}${name(.)}/existing/country" targetName="existingCountry" />
                    <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
                </TransformationTemplate>
            </TransformationTemplate>

            <!-- read from configured value -->
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="configured" />
                    <base:IsNotMember value="listedPhoneNumber" sourceAttrName="name(.)" />
                </TemplateConditions>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isSimpleParameter" />   
                        <base:IsMember value="false" sourceAttrName="#:isAccessFunctionParameter" />   
                    </TemplateConditions>
                    <RPMapping sourceAttrName="configured" targetName="configuredValue" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isSimpleParameter" />   
                        <base:IsMember value="true" sourceAttrName="#:isAccessFunctionParameter" />   
                    </TemplateConditions>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsExisting sourceAttrName="../../@targetAccessID" />   
                        </TemplateConditions>
                        <RPMapping sourceAttrName="string(../../../../accesses/*[@ID = '${../../@targetAccessID}']/*/${name(.)}/configured | configured)" targetName="configuredValue" />
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsNotExisting sourceAttrName="../../@targetAccessID" />   
                        </TemplateConditions>
                        <RPMapping sourceAttrName="string(../../../../accesses/*[@ID = '${../../@refAccessID}']/*/${name(.)}/configured | configured)" targetName="configuredValue" />
                    </TransformationTemplate>
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAccessNumber" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="configured/countryCode" targetName="configuredCountryCode" />
                    <RPMapping sourceAttrName="configured/localAreaCode" targetName="configuredAreaCode" />
                    <RPMapping sourceAttrName="configured/pilotNumber" targetName="configuredLocalNumber" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAccessNumberRange" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="configured/startNumber" targetName="configuredStartNumber" />
                    <RPMapping sourceAttrName="configured/endNumber" targetName="configuredEndNumber" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isLineOwner" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="configured/name" targetName="configuredName" />
                    <RPMapping sourceAttrName="configured/firstName" targetName="configuredFirstName" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isServiceLocation" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="configured/floor" targetName="configuredFloor" />
                    <RPMapping sourceAttrName="configured/room" targetName="configuredRoomNumber" />
                    <RPMapping sourceAttrName="configured/jackLocation" targetName="configuredJackLocation" />
                    <RPMapping sourceAttrName="configured/desk" targetName="configuredDeskNumber" />
                    <RPMapping sourceAttrName="configured/additionalInformation" targetName="configuredAdditionalLocationInfo" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAddress" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="configured/street" targetName="configuredStreet" />
                    <RPMapping sourceAttrName="configured/streetNumber" targetName="configuredStreetNumber" />
                    <RPMapping sourceAttrName="configured/streetNumberSuffix" targetName="configuredStreetNumberSuffix" />
                    <RPMapping sourceAttrName="configured/postalCode" targetName="configuredPostalCode" />
                    <RPMapping sourceAttrName="configured/city" targetName="configuredCity" />
                    <RPMapping sourceAttrName="configured/citySuffix" targetName="configuredCitySuffix" />
                    <RPMapping sourceAttrName="configured/additionalAddressDescription" targetName="configuredAdditionalAddressDescription" />
                    <RPMapping sourceAttrName="configured/country" targetName="configuredCountry" />
                    <RPMapping targetName="validationTypeRd" staticValue="BYPASS" />
                </TransformationTemplate>
                <!-- parameters for salutation, name, first name -->
              
                <TransformationTemplate>
                    <TemplateConditions>
                        <OrComposite>                
                            <base:IsMember value="salutationDescription" sourceAttrName="name(.)" />
                            <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                        </OrComposite>                
                    </TemplateConditions>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                            <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="configured/salutationDescription" targetName="configuredSalutation" />
                        <RPMapping sourceAttrName="configured/forename" targetName="configuredFirstName" />
                        <RPMapping sourceAttrName="configured/name" targetName="configuredName" />
                    </TransformationTemplate>            
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="configured/salutationDescription" targetName="configuredSalutation" />
                        <RPMapping sourceAttrName="configured/forename" targetName="configuredFirstName" />
                        <RPMapping sourceAttrName="configured/name" targetName="configuredName" />
                    </TransformationTemplate>                              
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="salutationDescription" sourceAttrName="name(.)" />
                            <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="configured" targetName="configuredSalutation" />
                        <RPMapping sourceAttrName="../forename/configured" targetName="configuredFirstName" /> 
                        <RPMapping sourceAttrName="../name/configured" targetName="configuredName" /> 
                    </TransformationTemplate>                
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="existing/salutationDescription" targetName="existingSalutation" />
                        <RPMapping sourceAttrName="existing/forename" targetName="existingFirstName" />
                        <RPMapping sourceAttrName="existing/name" targetName="existingName" />
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="salutationDescription" sourceAttrName="name(.)" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="true" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="existing" targetName="existingSalutation" />
                        <RPMapping sourceAttrName="../forename/existing" targetName="existingFirstName" /> 
                        <RPMapping sourceAttrName="../name/existing" targetName="existingName" /> 
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="./configured/salutationDescription" targetName="configuredSalutation" />
                        <RPMapping sourceAttrName="./configured/forename" targetName="configuredFirstName" />
                        <RPMapping sourceAttrName="./configured/name" targetName="configuredName" />
                    </TransformationTemplate>
                    <TransformationTemplate>
                        <TemplateConditions>
                            <base:IsMember value="hardwareRecipient" sourceAttrName="name(.)" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionConfigured" />
                            <base:IsMember value="false" sourceAttrName="#:isSalutationDescriptionExisting" />
                            <base:IsMember value="false" sourceAttrName="#:isHardwareRecipientConfigured" />
                            <base:IsMember value="true" sourceAttrName="#:isHardwareRecipientExisting" />
                        </TemplateConditions>
                        <RPMapping sourceAttrName="./existing/salutationDescription" targetName="existingSalutation" />
                        <RPMapping sourceAttrName="./existing/forename" targetName="existingFirstName" />
                        <RPMapping sourceAttrName="./existing/name" targetName="existingName" />
                    </TransformationTemplate>
                    
                </TransformationTemplate>
               
            </TransformationTemplate>

            
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="listedPhoneNumber" sourceAttrName="name(.)" />
                </TemplateConditions>
                
                <RPMapping targetName="configuredDirectoryEntryText" sourceAttrName="../directoryEntryText/configured" />
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../name/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredName" sourceAttrName="../name" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../forename/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredFirstName" sourceAttrName="../forename" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../nobilityPrefixDescription/@action) = 0" />
                    </TemplateConditions>                        
                    <RPMapping targetName="configuredNobilityPrefixDescription" sourceAttrName="../nobilityPrefixDescription" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../titleDescription/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredTitleDescription" sourceAttrName="../titleDescription" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../surnamePrefix/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredSurnamePrefix" sourceAttrName="../surnamePrefix" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../profession/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredProfession" sourceAttrName="../profession" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="count(../name/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredIndustrialSector" sourceAttrName="../industrialSectorRd" method="configuredExisting" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsExisting sourceAttrName="../listedAddress/configured" />
                        <base:IsMember value="true" sourceAttrName="count(../listedAddress/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredAdditionalText" sourceAttrName="../listedAddress/configured/additionalAddressDescription" />
                    <RPMapping targetName="configuredStreet" sourceAttrName="../listedAddress/configured/street" />
                    <RPMapping targetName="configuredStreetNumber" sourceAttrName="../listedAddress/configured/streetNumber" />
                    <RPMapping targetName="configuredStreetNumberSuffix" sourceAttrName="../listedAddress/configured/streetNumberSuffix" />
                    <RPMapping targetName="configuredPostalCode" sourceAttrName="../listedAddress/configured/postalCode" />
                    <RPMapping targetName="configuredPostOfficeBox" sourceAttrName="../listedAddress/configured/postOfficeBox" />
                    <RPMapping targetName="configuredCity" sourceAttrName="../listedAddress/configured/city" />
                    <RPMapping targetName="configuredCitySuffix" sourceAttrName="../listedAddress/configured/citySuffix" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsNotExisting sourceAttrName="../listedAddress/configured" />
                        <base:IsMember value="true" sourceAttrName="count(../listedAddress/@action) = 0" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredAdditionalText" sourceAttrName="../listedAddress/existing/additionalAddressDescription" />
                    <RPMapping targetName="configuredStreet" sourceAttrName="../listedAddress/existing/street" />
                    <RPMapping targetName="configuredStreetNumber" sourceAttrName="../listedAddress/existing/streetNumber" />
                    <RPMapping targetName="configuredStreetNumberSuffix" sourceAttrName="../listedAddress/existing/streetNumberSuffix" />
                    <RPMapping targetName="configuredPostalCode" sourceAttrName="../listedAddress/existing/postalCode" />
                    <RPMapping targetName="configuredPostOfficeBox" sourceAttrName="../listedAddress/existing/postOfficeBox" />                    
                    <RPMapping targetName="configuredCity" sourceAttrName="../listedAddress/existing/city" />
                    <RPMapping targetName="configuredCitySuffix" sourceAttrName="../listedAddress/existing/citySuffix" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsExisting sourceAttrName="../listedPhoneNumber/configured" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredCountryCode" sourceAttrName="../listedPhoneNumber/configured/countryCode" />
                    <RPMapping targetName="configuredAreaCode" sourceAttrName="../listedPhoneNumber/configured/localAreaCode" />
                    <RPMapping targetName="configuredLocalNumber" sourceAttrName="../listedPhoneNumber/configured/pilotNumber" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsNotExisting sourceAttrName="../listedPhoneNumber/configured" />
                    </TemplateConditions>
                    <RPMapping targetName="configuredCountryCode" sourceAttrName="../listedPhoneNumber/existing/countryCode" />
                    <RPMapping targetName="configuredAreaCode" sourceAttrName="../listedPhoneNumber/existing/localAreaCode" />
                    <RPMapping targetName="configuredLocalNumber" sourceAttrName="../listedPhoneNumber/existing/pilotNumber" />
                </TransformationTemplate>
                
            </TransformationTemplate>
      
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="configured" />
                    <base:IsNotExisting sourceAttrName="existing" />                    
                </TemplateConditions>
                
                <base:DataBufferWriter keyValue="isAccessChange" 
                    sourceAttrName="count(/*/*/functions/voice[@refAccessID = '${../../@ID}' or @targetAccessID = '${../../@ID}']/@targetAccessID) > 0"/>                
                <base:DataBufferWriter keyValue="respectiveRefAccessID" 
                    sourceAttrName="/*/*/functions/voice[@refAccessID = '${../../@ID}' or @targetAccessID = '${../../@ID}']/@refAccessID"/>
                <base:DataBufferWriter keyValue="respectiveTargetAccessID" 
                    sourceAttrName="/*/*/functions/voice[@refAccessID = '${../../@ID}' or @targetAccessID = '${../../@ID}']/@targetAccessID"/>
                
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsNotMember value="true" sourceAttrName="#:isAccessChange" />
                    </TemplateConditions>
                    <RPMapping sourceAttrName="." targetName="configuredValue" />
                </TransformationTemplate>
                <TransformationTemplate>
                    <TemplateConditions>
                        <base:IsMember value="true" sourceAttrName="#:isAccessChange" />                        
                    </TemplateConditions>
                    <RPMapping sourceAttrName="../../../*[@ID = '${#:respectiveRefAccessID}']/*/${name(.)}" targetName="existingValue" />
                    <RPMapping sourceAttrName="../../../*[@ID = '${#:respectiveTargetAccessID}']/*/${name(.)}" targetName="configuredValue" />
                </TransformationTemplate>
            </TransformationTemplate>

        </TransformationTemplate>
    </baseInclusion:Part>
    <!-- End parameterList -->
    
    <baseInclusion:Part id="modifyContractParameters">
        <TemplateConditions>
            <base:IsNotExisting sourceAttrName="@targetAccessID" />
            <base:IsMember value="execute" sourceAttrName="/order/*/transactionType" />
            <base:IsMember value="CHANGE" sourceAttrName="processingType" />
            <OrComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/pricingStructureCode/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/pricingStructureCode/configured, */pricingStructureCode/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/pricingStructureCode/existing, */pricingStructureCode/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/minimumDurationPeriod/value/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/minimumDurationPeriod/value/configured, */minimumDurationPeriod/value/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/minimumDurationPeriod/value/existing, */minimumDurationPeriod/value/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/minimumDurationPeriod/unit/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/minimumDurationPeriod/unit/configured, */minimumDurationPeriod/unit/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/minimumDurationPeriod/unit/existing, */minimumDurationPeriod/unit/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/minimumDurationPeriod/startDate/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/minimumDurationPeriod/startDate/configured, */minimumDurationPeriod/startDate/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/minimumDurationPeriod/startDate/existing, */minimumDurationPeriod/startDate/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/autoExtension/value/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/autoExtension/value/configured, */autoExtension/value/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/autoExtension/value/existing, */autoExtension/value/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/autoExtension/unit/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/autoExtension/unit/configured, */autoExtension/unit/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/autoExtension/unit/existing, */autoExtension/unit/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/autoExtension/autoExtensionIndicator/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/autoExtension/autoExtensionIndicator/configured, */autoExtension/autoExtensionIndicator/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/autoExtension/autoExtensionIndicator/existing, */autoExtension/autoExtensionIndicator/configured)" />
                    </OrComposite>
                </AndComposite>
                <AndComposite>
                    <base:IsExisting sourceAttrName="*/specialTerminationRight/configured" />
                    <OrComposite>
                        <base:IsMember value="false" sourceAttrName="contains(*/specialTerminationRight/configured, */specialTerminationRight/existing)" />
                        <base:IsMember value="false" sourceAttrName="contains(*/specialTerminationRight/existing, */specialTerminationRight/configured)" />
                    </OrComposite>
                </AndComposite>
            </OrComposite>
        </TemplateConditions>

        <RPMapping sourceAttrName="*/productCode/existing" targetName="productCode" />
        <RPMapping sourceAttrName="*/pricingStructureCode/configured" targetName="newPricingStructureCode" />
        <RPMapping sourceAttrName="*/pricingStructureCode/existing" targetName="oldPricingStructureCode" />
        <RPMapping sourceAttrName="*/minimumDurationPeriod/value" 
            targetName="newMinPeriodDurationValue" 
            method="configuredExisting" />
        <RPMapping sourceAttrName="*/minimumDurationPeriod/unit" 
            targetName="newMinPeriodDurationUnit"
            method="configuredExisting" />        
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="true" sourceAttrName="#:isOPMOrder" />
                <base:IsExisting sourceAttrName="*/minimumDurationPeriod/startDate/configured" />
                <base:IsMember value="true" sourceAttrName="*/minimumDurationPeriod/startDate/configured = ../../desiredDate" />
            </TemplateConditions>            
            <RPMapping targetName="termStartDate" staticValue="today" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsNotMember value="true" sourceAttrName="#:isOPMOrder" />
                    <base:IsNotMember value="true" sourceAttrName="*/minimumDurationPeriod/startDate/configured = ../../desiredDate" />
                </OrComposite>
                <base:IsExisting sourceAttrName="*/minimumDurationPeriod/startDate/configured" />
            </TemplateConditions>            
            <RPMapping sourceAttrName="*/minimumDurationPeriod/startDate/configured" 
                targetName="termStartDate" 
                formatter="SOMToCCBDateFormatter" />
        </TransformationTemplate>
        
        <RPMapping sourceAttrName="*/autoExtension/value" 
            targetName="newAutoExtentPeriodValue" 
            method="configuredExisting"/>
        <RPMapping sourceAttrName="*/autoExtension/unit" 
            targetName="newAutoExtentPeriodUnit"  
            method="configuredExisting"/>
        <RPMapping sourceAttrName="*/autoExtension/autoExtensionIndicator" 
            targetName="newAutoExtensionInd"             
            method="configuredExisting"
            decoding="'true', 'Y', 'false', 'N'" />
        <RPMapping sourceAttrName="*/specialTerminationRight/configured" targetName="specialTerminationRight" />
        <RPMapping sourceAttrName="*/primaryCustSignDate/configured" targetName="primaryCustSignDate" formatter="SOMToCCBDateFormatter" />
        <RPMapping sourceAttrName="*/primaryCustSignName/configured" targetName="primaryCustSignName" />
        <RPMapping sourceAttrName="*/boardSignDate/configured" targetName="boardSignDate" formatter="SOMToCCBDateFormatter" />
        <RPMapping sourceAttrName="*/boardSignName/configured" targetName="boardSignName" />
        <RPMapping sourceAttrName="../../desiredDate" targetName="desiredDate" formatter="SOMToCCBDateFormatter" />

        <TransformationTemplate>
            <TemplateConditions>
                <!--<base:IsExisting sourceAttrName="*/specialTerminationRight/configured" />-->
                <base:IsMember value="true" sourceAttrName="*/specialTerminationRight/existing != */specialTerminationRight/configured
                    and */specialTerminationRight/configured != ''" />
                <base:IsNotMember value="true" sourceAttrName="*/pricingStructureCode/existing != */pricingStructureCode/configured
                    and */pricingStructureCode/configured != ''" />
                <base:IsNotMember value="true" sourceAttrName="
                    */minimumDurationPeriod/value/existing != */minimumDurationPeriod/value/configured and */minimumDurationPeriod/value/configured != ''
                    or */minimumDurationPeriod/unit/existing != */minimumDurationPeriod/unit/configured and */minimumDurationPeriod/unit/configured != ''
                    or */minimumDurationPeriod/startDate/existing != */minimumDurationPeriod/startDate/configured and */minimumDurationPeriod/startDate/configured != ''
                    or */resetContractStartDateIndicator/configured = 'true'" />
                <base:IsNotMember value="true" sourceAttrName="
                    */autoExtension/value/existing != */autoExtension/value/configured and */autoExtension/value/configured != ''
                    or */autoExtension/unit/existing != */autoExtension/unit/configured and */autoExtension/unit/configured != ''
                    or */autoExtension/autoExtensionIndicator/existing != */autoExtension/autoExtensionIndicator/configured and */autoExtension/autoExtensionIndicator/configured != ''" />
            </TemplateConditions>           
            <RPMapping targetName="isOnlySpecialTerminationRight" staticValue="Y" />
        </TransformationTemplate>
        
        <RPMapping sourceAttrName="@ID" targetName="functionID" />
        <RPMapping sourceAttrName="ccbId[@type='S']/existing" targetName="serviceSubscriptionId" />
    </baseInclusion:Part>

    <baseInclusion:Part id="uglyKBANotifications">
        <RequestTemplate fif-request-name="createKBANotification"
            sourceWorkingPath="/*/relocation/*/safetyPackage | /order/lineChange/*/safetyPackage"
            extends="notification_template">
            <RPMapping targetName="category" staticValue="createSafetyPackage" />
            <RPMapping targetName="notificationText"
                sourceAttrName="concat('Sicherheitspaket hinzugefgt ber COM. Auftragsnummer: ', /order/@orderID
                ,'. Pricing Structure Billing Name: ', */pricingStructureBillingName/configured)" />
        </RequestTemplate>

        <RequestTemplate fif-request-name="createKBANotification"
            sourceWorkingPath="/*/relocation/*/hardware | /order/lineChange/*/hardware"
            extends="notification_template">
            <RPMapping targetName="category" staticValue="addHardwareService" />
            <RPMapping targetName="notificationText"
                sourceAttrName="concat('Hardware hinzugefgt ber COM. Auftragsnummer: ', /order/@orderID
                ,'. Artikelname: ', */articleName/*
                ,'. Artikelnummer: ', */articleNumber/*
                ,'. Hardware Service Code: ', */hardwareServiceCode/*)" />
        </RequestTemplate>

        <RequestTemplate fif-request-name="createKBANotification"
            sourceWorkingPath="/*/relocation/*/installationSvc | /order/lineChange/*/installationSvc"
            extends="notification_template">
            <RPMapping targetName="category" staticValue="addInstallationService" />
            <RPMapping targetName="notificationText"
                sourceAttrName="concat('Installationsservice hinzugefgt ber COM, Auftragsnummer: ', /order/@orderID)" />
        </RequestTemplate>

        <RequestTemplate fif-request-name="createKBANotification"
            sourceWorkingPath="/*/relocation/*/directoryEntry | /order/lineChange/*/directoryEntry"
            extends="notification_template">
            <RPMapping targetName="category" staticValue="createDirectoryEntry" />
            <RPMapping targetName="notificationText"
                sourceAttrName="concat('Telefonbucheintrag hinzugefgt ber COM, Auftragsnummer: ', /order/@orderID)" />
        </RequestTemplate>

    </baseInclusion:Part>

    <baseInclusion:Part id="changeExternalOrder">
        
        <base:DataBufferWriter keyValue="isCompleted"
            sourceAttrName="
            count(functions/voice[
            	@refAccessID = '${accesses/isdnS2M/@ID}' and
	            processingStatus != 'completedCCM' and
    	        processingStatus != 'completedOPM']) = 0
            and
            count(functions/*[(name(.) = 'voice' or 
            name(.) = 'internet' or 
            name(.) = 'seat' or 
            name(.) = 'tvCenter' or 
            name(.) = 'safetyPackage' or 
            name(.) = 'extraNumbers' or 
            name(.) = 'extraLine' or 
            name(.) = 'hardware' or 
            name(.) = 'installationSvc' or
            name(.) = 'mobileUsage') 
            and 
            processingStatus != 'completedCCM' and
            processingStatus != 'completedOPM' and
            processingStatus != 'noactionCOM' and
            processingStatus != 'noactionOPM' and
            count(processingStatus) > 0]) = 0" />
        
        <base:DataBufferWriter keyValue="isPrecompleted"
            sourceAttrName="
            count(functions/voice[
            	@refAccessID = '${accesses/isdnS2M/@ID}' and
	            processingStatus != 'completedCCM' and
    	        processingStatus != 'completedOPM']) = 0            
            and
            count(functions/*[
            (name(.) = 'voice' or 
            name(.) = 'internet' or 
            name(.) = 'seat' or 
            name(.) = 'tvCenter' or 
            name(.) = 'safetyPackage' or 
            name(.) = 'extraNumbers' or 
            name(.) = 'extraLine' or 
            name(.) = 'hardware' or 
            name(.) = 'installationSvc' or
            name(.) = 'mobileUsage') 
            and 
            processingStatus != 'precompletedCCM' and
            processingStatus != 'precompletedOPM' and
            processingStatus != 'completedCCM' and
            processingStatus != 'completedOPM' and
            processingStatus != 'noactionCOM' and
            processingStatus != 'noactionOPM' and
            count(processingStatus) > 0]) = 0" />
            
        <base:DataBufferWriter keyValue="isPostponed"
            sourceAttrName="
            count(functions/voice[
            	@refAccessID = '${accesses/isdnS2M/@ID}' and
	            processingStatus != 'completedCCM' and
    	        processingStatus != 'completedOPM']) = 0            
            and
            count(functions/*[
            (name(.) = 'voice' or 
            name(.) = 'internet' or 
            name(.) = 'seat' or 
            name(.) = 'tvCenter' or 
            name(.) = 'safetyPackage' or 
            name(.) = 'extraNumbers' or 
            name(.) = 'extraLine' or 
            name(.) = 'hardware' or 
            name(.) = 'installationSvc' or
            name(.) = 'mobileUsage') 
            and (processingStatus = 'postponedOPM' or
            processingStatus = 'postponedCCM')and
            count(processingStatus) > 0]) > 0" />
        
        <base:DataBufferWriter keyValue="directoryEntryStatus"
            sourceAttrName="concat('status', */directoryEntry/processingStatus)"
            decoding="
            'statuscompletedOPM', 'COMPLETED', 
            'statuscompletedCCM', 'COMPLETED', 
            'statusnoactionOPM', 'COMPLETED', 
            'statusnoactionCOM', 'COMPLETED', 
            'statusprecompletedOPM', 'PRECOMPLETED', 
            'statusprecompletedCCM', 'PRECOMPLETED', 
            'status', 'COMPLETED',
            'ORDERED'"/>

        <RPMapping targetName="externalOrderStatus" 
            sourceAttrName="concat('${#:isCompleted}', '${#:isPrecompleted}', '${#:isPostponed}', '${#:directoryEntryStatus}')"
            decoding="'falsefalsetrueORDERED', 'POSTPONED',
                'falsefalsefalseORDERED', 'ORDERED',
                'falsefalsetruePRECOMPLETED', 'POSTPONED',
                'falsefalsefalsePRECOMPLETED', 'ORDERED',
                'falsefalsetrueCOMPLETED', 'POSTPONED',
                'falsefalsefalseCOMPLETED', 'ORDERED',            
               
				'falsetruetrueORDERED', 'IMPOSSIBLE', 
                'falsetruefalseORDERED', 'ORDERED',
                'falsetruetruePRECOMPLETED', 'IMPOSSIBLE',
                'falsetruefalsePRECOMPLETED', 'PRECOMPLETED',
                'falsetruetrueCOMPLETED', 'IMPOSSIBLE',
                'falsetruefalseCOMPLETED', 'PRECOMPLETED',
               
				'truefalsetrueORDERED', 'IMPOSSIBLE', 
                'truefalsefalseORDERED', 'IMPOSSIBLE', 
                'truefalsetruePRECOMPLETED', 'IMPOSSIBLE', 
                'truefalsefalsePRECOMPLETED', 'IMPOSSIBLE', 
                'truefalsetrueCOMPLETED', 'IMPOSSIBLE', 
                'truefalsefalseCOMPLETED', 'IMPOSSIBLE',
               
				'truetruetrueORDERED', 'IMPOSSIBLE',
                'truetruefalseORDERED', 'ORDERED',
                'truetruetruePRECOMPLETED', 'IMPOSSIBLE',
                'truetruefalsePRECOMPLETED', 'COMPLETED_NO_DE',
                'truetruetrueCOMPLETED', 'IMPOSSIBLE'
                'truetruefalseCOMPLETED', 'COMPLETED'"/>
        
    </baseInclusion:Part>
    
    <baseInclusion:Part id="isdnInternetParameters">
        <RPListItemTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology"/>
                    <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology"/>
                </OrComposite>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="DSLIndicator"/>
            <RPMapping targetName="configuredValue" sourceAttrName="
                count(../internet/adslInternetConfiguration/DSLBandwidth[@action = 'remove']) = 0
                and count(../internet/adslInternetConfiguration/DSLBandwidth) > 0
                and ../internet/processingType != 'TERM'"/>
        </RPListItemTemplate>
        <RPListItemTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology"/>
                    <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology"/>
                </OrComposite>
                <base:IsExisting sourceAttrName="../internet/adslInternetConfiguration/DSLBandwidth"/>
                <base:IsExisting sourceAttrName="../internet[processingType != 'TERM']"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="DSLBandwidth"/>
            <RPMapping targetName="action" 
                sourceAttrName="../internet/adslInternetConfiguration/DSLBandwidth/@action"/>
            <RPMapping targetName="configuredValue" 
                sourceAttrName="../internet/adslInternetConfiguration/DSLBandwidth"
                method="configuredExisting" />
        </RPListItemTemplate>
        <RPListItemTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology"/>
                    <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology"/>
                </OrComposite>
                <base:IsExisting sourceAttrName="../internet/adslInternetConfiguration/desiredBandwidth"/>
                <base:IsExisting sourceAttrName="../internet[processingType != 'TERM']"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="desiredBandwidth"/>
            <RPMapping targetName="action" 
                sourceAttrName="../internet/adslInternetConfiguration/desiredBandwidth/@action"/>
            <RPMapping targetName="configuredValue" 
                sourceAttrName="../internet/adslInternetConfiguration/desiredBandwidth"
                method="configuredExisting" />
        </RPListItemTemplate>
        <RPListItemTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology"/>
                    <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology"/>
                </OrComposite>
                <base:IsExisting sourceAttrName="../internet/adslInternetConfiguration/upstreamBandwidth"/>
                <base:IsExisting sourceAttrName="../internet[processingType != 'TERM']"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="upstreamBandwidth"/>
            <RPMapping targetName="action" 
                sourceAttrName="../internet/adslInternetConfiguration/upstreamBandwidth/@action"/>
            <RPMapping targetName="configuredValue" 
                sourceAttrName="../internet/adslInternetConfiguration/upstreamBandwidth"
                method="configuredExisting" />
        </RPListItemTemplate>
        <RPListItemTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology"/>
                    <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology"/>
                </OrComposite>
                <base:IsExisting sourceAttrName="../internet/adslInternetConfiguration/allowBandwidthDowngrade"/>
                <base:IsExisting sourceAttrName="../internet[processingType != 'TERM']"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="allowBandwidthDowngrade"/>
            <RPMapping targetName="action" 
                sourceAttrName="../internet/adslInternetConfiguration/allowBandwidthDowngrade/@action"/>
            <RPMapping targetName="configuredValue" 
                sourceAttrName="../internet/adslInternetConfiguration/allowBandwidthDowngrade"
                method="configuredExisting" />
        </RPListItemTemplate>        
    </baseInclusion:Part>
 
    <baseInclusion:Part id="lteProcessingType">
        <RPListItemTemplate>
            <TemplateConditions>
                <base:IsMember value="LTE" sourceAttrName="#:targetTechnology"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="processingType"/>
            <RPMapping targetName="configuredValue" staticValue="LTE"/>
        </RPListItemTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="sipTrunkStartDate">
        <RPListItemTemplate>
            <TemplateConditions>
                <base:IsMember value="voice" sourceAttrName="name(.)"/>
                <base:IsMember value="sipTrunk" sourceAttrName="#:technology"/>
                <base:IsNotExisting sourceAttrName="initialContractStartDate"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="initialContractStartDate"/>
            <RPMapping targetName="configuredValue" staticValue="today"/>
        </RPListItemTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="sipTrunkVoiceChannelsRange">
    	<base:DataBufferWriter keyValue="phoneSystemTypeConfiguredExisting"
                sourceAttrName="count(../../accesses/sipTrunk/*/phoneSystemType/configured) > 0"
                decoding="'true', 'configured', 'existing'" />
            <base:DataBufferWriter keyValue="phoneSystemType"
                sourceAttrName="../../accesses/sipTrunk/*/phoneSystemType/${#:phoneSystemTypeConfiguredExisting}" /> 
                
             <base:DataBufferWriter keyValue="sipTrunkVoiceChannelsRangeConfiguredExisting"
                sourceAttrName="count(../../accesses/sipTrunk/*/sipTrunkVoiceChannels/configured
                | ../../accesses/businessVoip/*/numberOfVoiceChannels/configured) > 0"
                decoding="'true', 'configured', 'existing'" />
            <base:DataBufferWriter keyValue="sipTrunkVoiceChannelsRange"
                sourceAttrName="../../accesses/sipTrunk/*/sipTrunkVoiceChannels/${#:sipTrunkVoiceChannelsRangeConfiguredExisting}
                | ../../accesses/businessVoip/*/numberOfVoiceChannels/${#:sipTrunkVoiceChannelsRangeConfiguredExisting}" />
        <RPListItemTemplate>
            <TemplateConditions>
                <base:IsMember value="voice" sourceAttrName="name(.)"/>
                <base:IsMember value="sipTrunk" sourceAttrName="#:technology"/>
                <base:IsMember value="S0-A" sourceAttrName="#:phoneSystemType"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="sipTrunkVoiceChannelsRange"/>
            <RPMapping targetName="configuredValue" 
            	sourceAttrName="${#:sipTrunkVoiceChannelsRange}"
            	decoding="
            	'2', '2 bis 4 Sprachkanle', 
            	'3', '2 bis 4 Sprachkanle', 
            	'4', '2 bis 4 Sprachkanle', 
            	'grer 4 Sprachkanle'" />
        </RPListItemTemplate>
        <RPListItemTemplate>
            <TemplateConditions>
            	<base:IsMember value="voice" sourceAttrName="name(.)"/>
                <base:IsMember value="sipTrunk" sourceAttrName="#:technology"/>
                <base:IsMember value="S2M" sourceAttrName="#:phoneSystemType"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="sipTrunkVoiceChannelsRange"/>
            <RPMapping targetName="configuredValue" 
            	sourceAttrName="${#:sipTrunkVoiceChannelsRange} &lt; 30"
            	decoding="
            	'true', 'weniger 30 Sprachkanle', 
            	'grer gleich 30 Sprachkanle'" />
        </RPListItemTemplate>
        <RPListItemTemplate>
            <TemplateConditions>
                <base:IsMember value="voice" sourceAttrName="name(.)"/>
                <base:IsMember value="businessVoip" sourceAttrName="#:technology"/>
            </TemplateConditions>
            <RPMapping targetName="parameterName" staticValue="sipTrunkVoiceChannelsRange"/>
            <RPMapping targetName="configuredValue" 
            	sourceAttrName="${#:sipTrunkVoiceChannelsRange}"
            	decoding="
            	'2', '2 bis 4 Sprachkanle', 
            	'3', '2 bis 4 Sprachkanle', 
            	'4', '2 bis 4 Sprachkanle', 
            	'grer 4 Sprachkanle'" />
        </RPListItemTemplate>
    </baseInclusion:Part>
    
    <baseInclusion:Part id="debugOutputParameters">
        <RPMapping targetName="isOPMOrder" sourceAttrName="#:isOPMOrder"/>
        <RPMapping targetName="isOpenOPMOrder" sourceAttrName="#:isOpenOPMOrder"/>
        <RPMapping targetName="isOpenOPMOrderIgnoreDE" sourceAttrName="#:isOpenOPMOrderIgnoreDE"/>
        <RPMapping targetName="isOrderCancelled" sourceAttrName="#:isOrderCancelled"/>
        <RPMapping targetName="currentMainAccessID" sourceAttrName="#:currentMainAccessID"/>
        <RPMapping targetName="targetAccessID" sourceAttrName="#:targetAccessID"/>
        <RPMapping targetName="existingMainAccessID" sourceAttrName="#:existingMainAccessID"/>
        <RPMapping targetName="configuredMainAccessID" sourceAttrName="#:configuredMainAccessID"/>
        <RPMapping targetName="targetInternetAccess" sourceAttrName="#:targetInternetAccess"/>
        <RPMapping targetName="mainVoiceFunctionID" sourceAttrName="#:mainVoiceFunctionID"/>
        <RPMapping targetName="mainInternetFunctionID" sourceAttrName="#:mainInternetFunctionID"/>        
        <RPMapping targetName="scenarioType" sourceAttrName="#:scenarioType"/>
        <RPMapping targetName="newInternetMainAccess" sourceAttrName="#:newInternetMainAccess"/>
        <RPMapping targetName="newVoiceMainAccess" sourceAttrName="#:newVoiceMainAccess"/>
        <RPMapping targetName="newTVCenterMainAccess" sourceAttrName="#:newTVCenterMainAccess"/>
        <RPMapping targetName="targetInternetExists" sourceAttrName="#:targetInternetExists"/>
        <RPMapping targetName="noInternet" sourceAttrName="#:noInternet"/>
        <RPMapping targetName="createInternet" sourceAttrName="#:createInternet"/>
        <RPMapping targetName="createInternetHelper" sourceAttrName="#:createInternetHelper"/>
        <RPMapping targetName="terminateInternet" sourceAttrName="#:terminateInternet"/>
        <RPMapping targetName="existingInternetTerminated" sourceAttrName="#:existingInternetTerminated"/>
        <RPMapping targetName="reconfigureInternet" sourceAttrName="#:reconfigureInternet"/>
        <RPMapping targetName="internetReadyForFeatures" sourceAttrName="#:internetReadyForFeatures"/>
        <RPMapping targetName="internetReadyForDependentFunctions" sourceAttrName="#:internetReadyForDependentFunctions"/>
        <RPMapping targetName="internetBillingChangesReady" sourceAttrName="#:internetBillingChangesReady"/>        
        <RPMapping targetName="internetHasTariffChange" sourceAttrName="#:internetHasTariffChange"/>        
        <RPMapping targetName="isOpenISDNBandwidthChange" sourceAttrName="#:isOpenISDNBandwidthChange"/>
        <RPMapping targetName="targetVoiceExists" sourceAttrName="#:targetVoiceExists"/>
        <RPMapping targetName="noVoice" sourceAttrName="#:noVoice"/>
        <RPMapping targetName="createVoice" sourceAttrName="#:createVoice"/>
        <RPMapping targetName="createVoiceHelper" sourceAttrName="#:createVoiceHelper"/>
        <RPMapping targetName="terminateVoice" sourceAttrName="#:terminateVoice"/>
        <RPMapping targetName="existingVoiceTerminated" sourceAttrName="#:existingVoiceTerminated"/>
        <RPMapping targetName="reconfigureVoice" sourceAttrName="#:reconfigureVoice"/>
        <RPMapping targetName="voiceReadyForFeatures" sourceAttrName="#:voiceReadyForFeatures"/>
        <RPMapping targetName="voiceReadyForDependentFunctions" sourceAttrName="#:voiceReadyForDependentFunctions"/>
        <RPMapping targetName="voiceBillingChangesReady" sourceAttrName="#:voiceBillingChangesReady"/>
        <RPMapping targetName="voiceHasTariffChange" sourceAttrName="#:voiceHasTariffChange"/>
        <RPMapping targetName="createTVCenter" sourceAttrName="#:createTVCenter"/>
        <RPMapping targetName="terminateTVCenter" sourceAttrName="#:terminateTVCenter"/>
        <RPMapping targetName="reconfigureTVCenter" sourceAttrName="#:reconfigureTVCenter"/>
        <RPMapping targetName="tvCenterReadyForFeatures" sourceAttrName="#:tvCenterReadyForFeatures"/>
        <RPMapping targetName="tvCenterReadyForDependentFunctions" sourceAttrName="#:tvCenterReadyForDependentFunctions"/>
        <RPMapping targetName="currentProductType" sourceAttrName="#:currentProductType"/>
        <RPMapping targetName="targetProductType" sourceAttrName="#:targetProductType"/>
        <RPMapping targetName="currentTechnology" sourceAttrName="#:currentTechnology"/>
        <RPMapping targetName="targetTechnology" sourceAttrName="#:targetTechnology"/>
        <RPMapping targetName="isProductTypeChange" sourceAttrName="#:isProductTypeChange"/>
        <RPMapping targetName="isTechnologyChange" sourceAttrName="#:isTechnologyChange"/>
        <RPMapping targetName="isBandwidthChange" sourceAttrName="#:isBandwidthChange"/>
        <RPMapping targetName="isUpstreamBandwidthChange" sourceAttrName="#:isUpstreamBandwidthChange"/>
        <RPMapping targetName="isDSLUpgrade" sourceAttrName="#:isDSLUpgrade"/>
        <RPMapping targetName="isDSLDowngrade" sourceAttrName="#:isDSLDowngrade"/>
        <RPMapping targetName="currentBandwidth" sourceAttrName="#:currentBandwidth"/>
        <RPMapping targetName="targetBandwidth" sourceAttrName="#:targetBandwidth"/>
        <RPMapping targetName="upstreamBandwidth" sourceAttrName="#:upstreamBandwidth"/>
        <RPMapping targetName="targetUpstreamBandwidth" sourceAttrName="#:targetUpstreamBandwidth"/>
        <RPMapping targetName="createUpstreamBandwidth" sourceAttrName="#:createUpstreamBandwidth"/>
    </baseInclusion:Part>
        
    <baseInclusion:Part id="reason">
        <TransformationTemplate>
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="relocation" sourceAttrName="#:scenarioType"/>
                    <base:IsMember value="contractPartnerChange" sourceAttrName="#:scenarioType"/>
                    <base:IsMember value="technologyChange" sourceAttrName="#:scenarioType"/>
                    <base:IsMember value="productTypeChangeToBasis" sourceAttrName="#:scenarioType"/>
                    <base:IsMember value="productTypeChangeToPremium" sourceAttrName="#:scenarioType"/>
                </OrComposite>
            </TemplateConditions>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="ADD" sourceAttrName="processingType"/>
                </TemplateConditions>
                <base:DataBufferWriter keyValue="reasonHelper"
                    sourceAttrName="concat(name(.), ';', '${#:targetTechnology}')"
                    decoding="
                    'internet;LTE', 'CREATE_LTEDSL', 
                    'internet;ISDN', 'CREATE_ONL', 
                    'internet;ISDNP2P', 'CREATE_ONL', 
                    'internet;NGN', 'CREATE_NGN_DSL', 
                    'internet;BitStream', 'CREATE_BIT_DSL', 
                    'internet;FTTx', 'CREATE_NGN_DSL', 
                    'tvCenter;LTE', 'ADD_TV_CENTER', 
                    'tvCenter;ISDN', 'ADD_TV_CENTER', 
                    'tvCenter;ISDNP2P', 'ADD_TV_CENTER', 
                    'tvCenter;NGN', 'ADD_TV_CENTER', 
                    'tvCenter;BitStream', 'ADD_TV_CENTER', 
                    'tvCenter;FTTx', 'ADD_TV_CENTER', 
                    'safetyPackage;LTE', 'CREATE_SECURITY', 
                    'safetyPackage;ISDN', 'CREATE_SECURITY', 
                    'safetyPackage;ISDNP2P', 'CREATE_SECURITY', 
                    'safetyPackage;NGN', 'CREATE_SECURITY', 
                    'safetyPackage;BitStream', 'CREATE_SECURITY', 
                    'safetyPackage;FTTx', 'CREATE_SECURITY',
                    ''"/>                
            </TransformationTemplate>   
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="TERM" sourceAttrName="processingType"/>
                </TemplateConditions>
                <base:DataBufferWriter keyValue="reasonHelper"
                    sourceAttrName="'TERMINATION'" />
            </TransformationTemplate>   
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                </TemplateConditions>
                <base:DataBufferWriter keyValue="reasonHelper"
                    sourceAttrName="#:scenarioType"
                    decoding="
                    'relocation', 'RELOCATION', 
                    'contractPartnerChange', 'TAKEOVERCONTRACT',
                    'technologyChange', 'PRODUCT_CHANGE',
                    'productTypeChangeToBasis', 'PRODCHANGE_BAS',
                    'productTypeChangeToPremium', 'PRODCHANGE_PREM',
                    ''" />
            </TransformationTemplate>   
        </TransformationTemplate>   
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="lineCreation" sourceAttrName="#:scenarioType"/>
            </TemplateConditions>
            <base:DataBufferWriter keyValue="reasonHelper"
                sourceAttrName="concat(name(.), ';', '${#:targetTechnology}')"
                decoding="
                'internet;LTE', 'CREATE_LTEDSL', 
                'internet;ISDN', 'CREATE_ONL', 
                'internet;ISDNP2P', 'CREATE_ONL', 
                'internet;NGN', 'CREATE_NGN_DSL', 
                'internet;BitStream', 'CREATE_BIT_DSL', 
                'internet;FTTx', 'CREATE_NGN_DSL', 
                'voice;LTE', 'CREATE_LTEVOICE', 
                'voice;ISDN', 'CREATE_ISDN', 
                'voice;ISDNP2P', 'CREATE_ISDN', 
                'voice;NGN', 'CREATE_NGN_VOIP', 
                'voice;BitStream', 'CREATE_BIT_VOIP', 
                'voice;FTTx', 'CREATE_NGN_VOIP', 
                'tvCenter;LTE', 'ADD_TV_CENTER', 
                'tvCenter;ISDN', 'ADD_TV_CENTER', 
                'tvCenter;ISDNP2P', 'ADD_TV_CENTER', 
                'tvCenter;NGN', 'ADD_TV_CENTER', 
                'tvCenter;BitStream', 'ADD_TV_CENTER', 
                'tvCenter;FTTx', 'ADD_TV_CENTER', 
                'safetyPackage;LTE', 'CREATE_SECURITY', 
                'safetyPackage;ISDN', 'CREATE_SECURITY', 
                'safetyPackage;ISDNP2P', 'CREATE_SECURITY', 
                'safetyPackage;NGN', 'CREATE_SECURITY', 
                'safetyPackage;BitStream', 'CREATE_SECURITY', 
                'safetyPackage;FTTx', 'CREATE_SECURITY',
                ''"/>
        </TransformationTemplate>   
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsMember value="simple" sourceAttrName="#:scenarioType"/>
            </TemplateConditions>
            <base:DataBufferWriter keyValue="reasonHelper"
            sourceAttrName="concat(name(.), ';', '${#:targetTechnology}', ';', processingType)"
            decoding="
            'tvCenter;LTE;ADD', 'ADD_TV_CENTER', 
            'tvCenter;ISDN;ADD', 'ADD_TV_CENTER', 
            'tvCenter;ISDNP2P;ADD', 'ADD_TV_CENTER', 
            'tvCenter;NGN;ADD', 'ADD_TV_CENTER', 
            'tvCenter;BitStream;ADD', 'ADD_TV_CENTER', 
            'tvCenter;FTTx;ADD', 'ADD_TV_CENTER', 
            'safetyPackage;LTE;ADD', 'CREATE_SECURITY', 
            'safetyPackage;ISDN;ADD', 'CREATE_SECURITY',
            'safetyPackage;ISDNP2P;ADD', 'CREATE_SECURITY',
            'safetyPackage;NGN;ADD', 'CREATE_SECURITY',
            'safetyPackage;BitStream;ADD', 'CREATE_SECURITY',
            'safetyPackage;FTTx;ADD', 'CREATE_SECURITY',
            'tvCenter;LTE;TERM', 'TERM_TVC', 
            'tvCenter;ISDN;TERM', 'TERM_TVC', 
            'tvCenter;ISDNP2P;TERM', 'TERM_TVC', 
            'tvCenter;NGN;TERM', 'TERM_TVC', 
            'tvCenter;BitStream;TERM', 'TERM_TVC', 
            'tvCenter;FTTx;TERM', 'TERM_TVC', 
            'safetyPackage;LTE;TERM', 'TERMINATION', 
            'safetyPackage;ISDN;TERM', 'TERMINATION',
            'safetyPackage;ISDNP2P;TERM', 'TERMINATION',
            'safetyPackage;NGN;TERM', 'TERMINATION',
            'safetyPackage;BitStream;TERM', 'TERMINATION',
            'safetyPackage;FTTx;TERM', 'TERMINATION',
            ''" />        
        </TransformationTemplate>
        
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotMember value="" sourceAttrName="#:reasonHelper" />
            </TemplateConditions>
            <RPMapping targetName="reason" sourceAttrName="#:reasonHelper" />
        </TransformationTemplate>
    </baseInclusion:Part>

    <baseInclusion:Part id="featureServicesProcessingStatus">

      <base:DataBufferWriter keyValue="isProductSubscriptionCreationScenario" staticValue="false"/>
      <TransformationTemplate>
        <TemplateConditions>
          <OrComposite>
            <base:Include fileIDRef="functionParameters" partIDRef="isMovedService"/>
            <AndComposite>
            	<base:IsNotExisting sourceAttrName="refFunctionID" />
            	<base:IsMember value="ADD" sourceAttrName="processingType" />
            </AndComposite>
            <AndComposite>
            	<base:IsExisting sourceAttrName="refFunctionID" />
            	<base:IsMember value="ADD" sourceAttrName="../*[@ID = '${refFunctionID/configured}']/processingType" />
            </AndComposite>
          </OrComposite>
        </TemplateConditions>
        <base:DataBufferWriter keyValue="isProductSubscriptionCreationScenario" staticValue="true"/>
      </TransformationTemplate>

      <!-- 	an empty processing status allows feature services to be created future-dated via OP
			in case of clone scenarios, services are always created without OP, i.e. not future-dated -->
		<base:DataBufferWriter keyValue="featureServicesProcessingStatus"
			sourceAttrName="concat('${#:isProductSubscriptionCreationScenario}', ';', '${#:listType}')" 
			decoding="
				'false;featuresList', 'completedOPM', 
				'false;volumeCap', 'completedOPM',	
				'false;serviceLevel', 'completedOPM', 
				'false;serviceLevelLegalList', 'completedOPM', 
				'false;ipV6Variant', 'completedOPM', 
				'false;chargesAndCreditsList', '', 
				'false;desiredCountriesList', '', 
				'false;tariffOptionsList', '', 
				'false;tvCenterOptionsList', 'completedOPM', 
				'false;conditionsList', '', 
				'false;blockingList', 'completedOPM', 
				'false;DSLBandwidth', 'completedOPM', 
				'false;upstreamBandwidth', 'completedOPM',             
				'false;fixedIPAddress', 'completedOPM',             
				'false;installationFees', 'completedOPM',             
				'false;VDSLSetupFee', 'completedOPM',             
				'false;callForwarding', 'completedOPM',
				'false;mobileUsage', 'completedOPM',             
				'false;voicePrio', 'completedOPM',             
				'completedOPM'"/>
        
        <RPMapping targetName="processingStatus" sourceAttrName="#:featureServicesProcessingStatus" />
    </baseInclusion:Part>
    
    <baseInclusion:Part id="serviceType">
        <RPMapping targetName="functionType" sourceAttrName="name(.)" />
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsExisting sourceAttrName="@targetAccessID" />
            </TemplateConditions>
            <RPMapping targetName="accessType" sourceAttrName="name(../../accesses/*[@ID = '${@targetAccessID}'])" />
            <RPMapping targetName="accessConfigurationType" 
            	sourceAttrName="substring-before(name(../../accesses/*[@ID = '${@targetAccessID}']/*[contains(name(.), 'Configuration')]), 'Configuration') " />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="@targetAccessID" />
                <base:IsExisting sourceAttrName="@refAccessID" />
            </TemplateConditions>
            <RPMapping targetName="accessType" sourceAttrName="name(../../accesses/*[@ID = '${@refAccessID}'])" />
            <RPMapping targetName="accessConfigurationType" 
            	sourceAttrName="substring-before(name(../../accesses/*[@ID = '${@refAccessID}']/*[contains(name(.), 'Configuration')]), 'Configuration')" />
        </TransformationTemplate>
        <TransformationTemplate>
            <TemplateConditions>
                <base:IsNotExisting sourceAttrName="@targetAccessID" />
                <base:IsNotExisting sourceAttrName="@refAccessID" />
            </TemplateConditions>
            <RPMapping targetName="accessType" 
                sourceAttrName="name(../../accesses/*[@ID = '${/*/*/functions/*[@ID = '${refFunctionID/*}']/@refAccessID}'])" />
            <RPMapping targetName="accessConfigurationType" 
                sourceAttrName="substring-before(name(../../accesses/*[@ID = '${/*/*/functions/*[@ID = '${refFunctionID/*}']/@refAccessID}']/*[contains(name(.), 'Configuration')]), 'Configuration')" />
        </TransformationTemplate>
        
        <RPMapping targetName="serviceType"
            sourceAttrName="substring-before(
            name(*[contains(name(.), 'Configuration')
            and (count(*/existing | */*/existing) = 0
            or count(*/existing | */*/existing) > 0 and count(*/configured | */*/configured) > 0
            or count(*/existing | */*/existing) > 0 and count(../*/*/configured | ../*/*/*/configured) = 0)
            ]), 'Configuration')" />
    </baseInclusion:Part>
    
    <baseInclusion:Part id="adjustmentParameters">
      <TransformationTemplate>
        <TemplateConditions>
          <OrComposite>
            <base:IsMember value="ADD" sourceAttrName="processingType" />
            <AndComposite>
              <base:IsMember value="TERM" sourceAttrName="processingType" />
              <base:IsMember value="PROCESSED" sourceAttrName="status/existing" />
              <base:IsMember value="true" sourceAttrName="recurringReclaimIndicator/configured" />
            </AndComposite>
          </OrComposite>
        </TemplateConditions>
        <RPMapping targetName="accountNumber" sourceAttrName="#:targetAccountNumber" />
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember value="ADD" sourceAttrName="processingType" />
          </TemplateConditions>
          <RPMapping targetName="adjustmentAmount"
            sourceAttrName="adjustmentAmount"
            method="configuredExisting" />
          <RPMapping targetName="reasonCode"
            sourceAttrName="reasonCode"
            method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember value="TERM" sourceAttrName="processingType" />
          </TemplateConditions>
          <RPMapping targetName="adjustmentAmount"
            sourceAttrName="adjustmentAmount/existing * (totalRecurringDuration/existing - remainingRecurringDuration/existing)" />
          <RPMapping targetName="reasonCode"
            sourceAttrName="../terminationReasonCode"/>
        </TransformationTemplate>
        <RPMapping targetName="resolutionUserId"
          sourceAttrName="resolutionUserId"
          method="configuredExisting" />
        <RPMapping targetName="resolutionDate"
          sourceAttrName="resolutionDate"
          method="configuredExisting"
          formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="descriptionText"
          sourceAttrName="descriptionText"
          method="configuredExisting" />
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember value="ADD" sourceAttrName="processingType" />
            <OrComposite>
              <base:IsNotMember value="1" sourceAttrName="totalRecurringDuration/configured" />
              <AndComposite>
                <base:IsNotExisting sourceAttrName="totalRecurringDuration/configured" />
                <base:IsNotMember value="1" sourceAttrName="totalRecurringDuration/existing" />
              </AndComposite>
            </OrComposite>
          </TemplateConditions>
          <RPMapping targetName="recurringValue"
            sourceAttrName="totalRecurringDuration"
            method="configuredExisting" />
        </TransformationTemplate>
        <RPMapping targetName="userName"
          sourceAttrName="creationUserId"
          method="configuredExisting" />
        <RPMapping targetName="createDate"
          sourceAttrName="creationDate"
          method="configuredExisting"
          formatter="SOMToCCBDateFormatter" />
        <RPMapping targetName="print"
          sourceAttrName="sendConfirmationIndicator"
          method="configuredExisting"
          decoding="'true', 'Y', 'N'" />
        <RPMapping targetName="KBATransactionNr"
          sourceAttrName="kbaTransactionNumber"
          method="configuredExisting" />
        <RPMapping targetName="paymentMode"
          sourceAttrName="paymentMode"
          method="configuredExisting" />
        <RPMapping targetName="taxCode"
          sourceAttrName="taxCode"
          method="configuredExisting" />
        <RPMapping targetName="internalReasonText"
          sourceAttrName="internalReasonText"
          method="configuredExisting" />
        <RPMapping targetName="productCode"
          sourceAttrName="productCode"
          method="configuredExisting" />
        <RPMapping targetName="internalReasonText"
          sourceAttrName="internalReasonText"
          method="configuredExisting" />
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember value="ADD" sourceAttrName="processingType" />
            <base:IsExisting sourceAttrName="serviceSubscriptionId" />
          </TemplateConditions>
          <RPMapping targetName="serviceSubscriptionId"
            sourceAttrName="serviceSubscriptionId"
            method="configuredExisting" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember value="ADD" sourceAttrName="processingType" />
            <base:IsNotExisting sourceAttrName="serviceSubscriptionId" />
          </TemplateConditions>
          <RPMapping targetName="serviceSubscriptionId"
            sourceAttrName="../functions/*[@ID = '${refFunctionID/*}']/ccbId[@type='S']"
            method="configuredExisting" />
        </TransformationTemplate>
      </TransformationTemplate>
    </baseInclusion:Part>

    <baseInclusion:Part id="hardwareServiceByTechnology">
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <OrComposite>
                <base:IsMember value="ISDN" sourceAttrName="#:targetTechnology"/>
                <base:IsMember value="ISDNP2P" sourceAttrName="#:targetTechnology"/>
            </OrComposite>
            <OrComposite>
                <base:IsMember value="V0048" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0107" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0108" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0109" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0110" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0114" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V011A" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="I1359" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0328" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0330" sourceAttrName="*/hardwareServiceCode/existing"/>
            </OrComposite>
        </AndComposite>
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <base:IsMember value="NGN" sourceAttrName="#:targetTechnology"/>
            <OrComposite>
                <base:IsMember value="V011C" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0114" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V011A" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="I1359" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0328" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0330" sourceAttrName="*/hardwareServiceCode/existing"/>
            </OrComposite>
        </AndComposite>
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <base:IsMember value="FTTx" sourceAttrName="#:targetTechnology"/>
            <OrComposite>
                <base:IsMember value="V011C" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0114" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V011A" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="I1359" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0328" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0330" sourceAttrName="*/hardwareServiceCode/existing"/>
            </OrComposite>
        </AndComposite>
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <base:IsMember value="BitStream" sourceAttrName="#:targetTechnology"/>
            <OrComposite>
                <base:IsMember value="V011C" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0114" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V011A" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="I1359" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0328" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0330" sourceAttrName="*/hardwareServiceCode/existing"/>
            </OrComposite>
        </AndComposite>
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <base:IsMember value="LTE" sourceAttrName="#:targetTechnology"/>
            <OrComposite>
                <base:IsMember value="V0328" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0330" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="I1291" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="I1295" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0114" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V011A" sourceAttrName="*/hardwareServiceCode/existing"/>
            </OrComposite>
        </AndComposite>
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <base:IsMember value="FTTH" sourceAttrName="#:targetTechnology"/>
            <OrComposite>
                <base:IsMember value="V011A" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0328" sourceAttrName="*/hardwareServiceCode/existing"/>
                <base:IsMember value="V0330" sourceAttrName="*/hardwareServiceCode/existing"/>
            </OrComposite>
        </AndComposite>
        <AndComposite>
            <OrComposite>
                <base:IsMember value="CHANGE" sourceAttrName="processingType"/>
                <base:IsMember value="IGNORE" sourceAttrName="processingType"/>
            </OrComposite>
            <OrComposite>
                <base:IsMember value="" sourceAttrName="#:targetTechnology"/>
                <base:IsNotMember value="true" sourceAttrName="#:isTechnologyChange"/>
            </OrComposite>
        </AndComposite>
    </baseInclusion:Part>

    <baseInclusion:Part id="isMovedService">
        <AndComposite>
            <base:IsMember value="true" sourceAttrName="#:isWF12" />
            <OrComposite>
                <!-- contract function -->
                <AndComposite>
                    <base:IsExisting sourceAttrName="ccbId[@type='S']/configured"/>
                    <base:IsExisting sourceAttrName="ccbId[@type='S']/existing"/>
                </AndComposite>
                <!-- dependent function -->
                <AndComposite>
                    <base:IsExisting sourceAttrName="ccbId[@type='S']/existing"/>
                    <base:IsExisting sourceAttrName="refFunctionID/existing"/>
                    <base:IsExisting sourceAttrName="../*[@ID = '${refFunctionID/existing}']/ccbId[@type='S']/existing"/>
                    <base:IsExisting sourceAttrName="../*[@ID = '${refFunctionID/existing}']/ccbId[@type='S']/configured"/>
                </AndComposite>
                <!-- partial hardware exchange -->
                <AndComposite>
                    <base:IsMember value="hardware" sourceAttrName="name(.)" />
                    <base:IsExisting sourceAttrName="*/quantityOfPartiallyExchangedHardware"/>
                    <base:IsExisting sourceAttrName="ccbId[@type='S']/configured"/>
                    <base:IsExisting sourceAttrName="ccbId[@type='S']/existing"/>
                </AndComposite>                
            </OrComposite>           
        </AndComposite>
        <AndComposite>
            <base:IsNotMember value="true" sourceAttrName="#:isWF12" />
            <OrComposite>
                <base:IsMember value="contractPartnerChange" sourceAttrName="name(../..)" />
                <AndComposite>
                    <base:IsNotMember value="tvCenter" sourceAttrName="name(.)" />
                    <base:IsMember value="true" sourceAttrName="#:isProductChangeScenario" />
                </AndComposite>
                <AndComposite>
                    <base:IsMember value="tvCenter" sourceAttrName="name(.)" />
                    <base:IsMember value="CHANGE" sourceAttrName="processingType" />
                    <OrComposite>
                        <base:IsMember value="true" sourceAttrName="#:isRelocation" />
                        <base:IsMember value="true" sourceAttrName="#:isTechnologyChange" />
                    </OrComposite>
                </AndComposite>
            </OrComposite>            
        </AndComposite>
    </baseInclusion:Part>
            
    <baseInclusion:Part id="parentFunctionIsInternet">        
      <OrComposite>
        <AndComposite>
          <base:IsExisting sourceAttrName="refFunctionID/configured" />            
          <base:IsMember value="internet" sourceAttrName="name(/*/*/functions/*[@ID='${refFunctionID/configured}'])" />          
        </AndComposite>                              
        <AndComposite>
          <base:IsNotExisting sourceAttrName="refFunctionID/configured" />            
          <base:IsMember value="internet" sourceAttrName="name(/*/*/functions/*[@ID='${refFunctionID/existing}'])" />          
        </AndComposite>
      </OrComposite>
    </baseInclusion:Part>       
            
    <baseInclusion:Part id="parentFunctionIsVoice">        
      <OrComposite>
        <AndComposite>
          <base:IsExisting sourceAttrName="refFunctionID/configured" />            
          <base:IsMember value="voice" sourceAttrName="name(/*/*/functions/*[@ID='${refFunctionID/configured}'])" />          
        </AndComposite>                              
        <AndComposite>
          <base:IsNotExisting sourceAttrName="refFunctionID/configured" />            
          <base:IsMember value="voice" sourceAttrName="name(/*/*/functions/*[@ID='${refFunctionID/existing}'])" />          
        </AndComposite>
      </OrComposite>
    </baseInclusion:Part>       
    
	<baseInclusion:Part id="reasonPTNProcessingStatusForFeatures">        
		<TransformationTemplate>
			<TemplateConditions>
				<base:IsMember value="true" sourceAttrName="#:isWF12" />
			</TemplateConditions>
			<base:Include fileIDRef="functionParameters" partIDRef="featureServicesProcessingStatus"/>

			<TransformationTemplate>
			    <TemplateConditions>
			        <base:IsMember value="completedOPM" sourceAttrName="#:featureServicesProcessingStatus" />
			        <base:IsNotMember value="true" sourceAttrName="#:isProductSubscriptionCreationScenario" />                        
			    </TemplateConditions>            
			    <RPMapping targetName="reason" staticValue="COM_BW_CHANGE" />
			</TransformationTemplate>                
			<TransformationTemplate>
			    <TemplateConditions>
			        <OrComposite>
			            <base:IsNotMember value="completedOPM" sourceAttrName="#:featureServicesProcessingStatus" />
			            <base:IsMember value="true" sourceAttrName="#:isProductSubscriptionCreationScenario" />
			        </OrComposite>
			    </TemplateConditions>            
			    <base:Include fileIDRef="functionParameters" partIDRef="reason"/>
			    <TransformationTemplate>
			        <TemplateConditions>
			            <base:IsMember value="" sourceAttrName="#:reasonHelper" />
			        </TemplateConditions>
			        <RPMapping targetName="reason" staticValue="MODIFY_FEATURES" />
			    </TransformationTemplate>
			</TransformationTemplate>                

			<TransformationTemplate>
				<TemplateConditions>
					<base:IsExisting sourceAttrName="ccbId[@type='S']/configured"/>
				</TemplateConditions>
				<base:Include fileIDRef="functionParameters" partIDRef="providerTrackingNumberCreation"/>
			</TransformationTemplate>
			<TransformationTemplate>
				<TemplateConditions>
					<base:IsNotExisting sourceAttrName="ccbId[@type='S']/configured"/>
				</TemplateConditions>
				<base:Include fileIDRef="functionParameters" partIDRef="providerTrackingNumberTermination"/>
			</TransformationTemplate>      
		</TransformationTemplate>                
	</baseInclusion:Part>
            
</baseInclusion:TransformationIncludeRepository>
