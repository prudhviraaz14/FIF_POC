<?xml version="1.0" encoding="UTF-8"?>
<TransformationRepository xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.arcor.de/transformer/SOMToFIFTransformationSchema" xmlns:base="http://www.arcor.de/transformer/BaseTransformationSchema" xsi:schemaLocation="http://www.arcor.de/transformer/SOMToFIFTransformationSchema SOMToFIFTransformationSchema.xsd" docTypeQualifiedName="request-list" docTypeSystemId="request-list.dtd">
  <RootTemplate>
    <RequestListTemplate orderIdPath="//order[@orderID]">

      <!-- global request list parameters -->
      <RLPMapping targetName="sourceSystem" sourceAttrName="/order/customerContactPoint" />
      <RLPMapping targetName="userName" sourceAttrName="/order/entryUser" />
      <RLPMapping targetName="rollenBezeichnung" sourceAttrName="/order/entryRole" />
      <RLPMapping targetName="manualRollback" sourceAttrName="/order/*/transactionType" decoding="'validate','Y','N'" />
      <RLPMapping targetName="somDate" sourceAttrName="/order/entryDateTime" formatter="SOMToCCBDateFormatter" />
      <RLPMapping targetName="orderId" sourceAttrName="/order/@orderID" />
      <RLPMapping targetName="OMTSOrderID" sourceAttrName="/order/@orderID" />
      <RLPMapping targetName="salesOrganisationNumber" sourceAttrName="/order/salesOrganisation/salesOrganisationNumber[@type='A']" />
      <RLPMapping targetName="salesOrganisationNumberVF" sourceAttrName="/order/salesOrganisation/salesOrganisationNumber[@type='V']" />
      <RLPMapping targetName="desiredDate" sourceAttrName="/order/*/desiredDate" formatter="SOMToCCBDateFormatter" />
      <RLPMapping targetName="orderPositionNumber" sourceAttrName="/order/*/@orderPositionNumber" />
      <RLPMapping targetName="scanDate" sourceAttrName="/order/scanDate" formatter="SOMToCCBDateFormatter" />
      <RLPMapping targetName="superCustomerTrackingId" sourceAttrName="/order/superCustomerTrackingId" />
      <RLPMapping targetName="reason" sourceAttrName="/order/*/reason" />

      <!-- allocateCustomer, needed by COM to create initial notifications -->
      <RequestTemplate fif-request-name="allocateCustomerNumber" sourceWorkingPath="/order/providerChange | /order/contractPartnerChange">
        <TemplateConditions>
          <base:IsMember value="allocate" sourceAttrName="/order/*/transactionType" />
        </TemplateConditions>

        <RPMapping targetName="name" sourceAttrName="additionalData/name" />
        <RPMapping targetName="forename" sourceAttrName="additionalData/forename" />
        <RPMapping targetName="systemID" sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
        <RPMapping targetName="systemType" staticValue="COM" />
      </RequestTemplate>

      <!-- ***************************************************************************************** -->

      <!-- Provider Change -->

      <!-- TODO providerChange mit customerData nach BKS-Anreicherung -->

        <!-- cloneCustomer, first step in provider change -->
        <RequestTemplate fif-request-name="cloneCustomer" 
          sourceWorkingPath="/order/providerChange" 
          extends="base_executevalidate_template">
            
            <RPMapping targetName="newServiceProvider" sourceAttrName="providerCode/configured" decoding="'VFAI','VODAFONE','ARCOR'" />
            <RPMapping targetName="customerCategory" sourceAttrName="beneficiary[@role='target']/classification/configured" decoding="'VC','BUSINESS','RESIDENTIAL'" />
            <RPMapping targetName="sourceCustomerNumber" sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
            <RPMapping targetName="targetCustomerNumber" sourceAttrName="beneficiary[@role='target']/ccbId[@type='C']" />
        </RequestTemplate>
        
        <!-- TODO einschraenken auf ProvChange
           modifyMethodOfPayment, needed for WEBBILL and manual payment -->
        <RequestTemplate fif-request-name="modifyMethodOfPayment" 
          sourceWorkingPath="/order/customerData/billingAccount/methodOfPayment" 
          extends="base_executevalidate_template">
            <RPMapping targetName="paymentTermRd" sourceAttrName="paymentTerm/configured" />
            <RPMapping targetName="paymentMethod" sourceAttrName="paymentMethod/configured" />
            <RPMapping targetName="bankCode" sourceAttrName="bankCode/configured" />
            <RPMapping targetName="bankAccountNumber" sourceAttrName="bankAccountNumber/configured" />
            <RPMapping targetName="owner" sourceAttrName="owner/configured" />
            <RPMapping targetName="directDebitAuthorizDate" sourceAttrName="directDebitAuthorizationDate/configured" formatter="SOMToCCBDateFormatter" />
        </RequestTemplate>        
        
        <!-- setInvoiceDeliveryType, WEBBILL trx -->
        <RequestTemplate fif-request-name="setInvoiceDeliveryType" sourceWorkingPath="/order/providerChange/billingAccount/invoiceDelivery" extends="base_executevalidate_template">
            <RPMapping targetName="deliveryType" sourceAttrName="invoiceDeliveryType/configured" />
            <RPMapping targetName="invoiceTemplateName" sourceAttrName="specialInvoiceTemplateName/configured" />
            <RPMapping targetName="enableEgn" sourceAttrName="enableItemizedBill/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="enableStorage" sourceAttrName="enableStorage/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="maskingDigits" sourceAttrName="maskingDigits/configured" />
            <RPMapping targetName="storageMaskingDigits" sourceAttrName="storageDigits/configured" />
        </RequestTemplate>
        
        <!-- changeProvider, most is done in the abstract template -->
        <RequestTemplate fif-request-name="changeProvider" extends="base_productChange_template" sourceWorkingPath="/order/providerChange">
            <TemplateConditions>
              <base:IsExisting sourceAttrName="/order/providerChange" />
              <base:IsNotExisting sourceAttrName="/order/providerChange/accesses/ipBitstream" />
            </TemplateConditions>
            
            <RPMapping targetName="sourceCustomerNumber" sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
            <RPMapping targetName="targetCustomerNumber" sourceAttrName="beneficiary[@role='target']/ccbId[@type='C']" />
            
            <RPMapping targetName="targetOMTSOrderID" sourceAttrName="parentBarcode" />
            <RPMapping targetName="sourceOMTSOrderID" sourceAttrName="/order/@orderID" />
            
            <RPMapping targetName="voiceFunctionID" sourceAttrName="*/voice[processingType != 'TERM']/@ID" />
            <RPMapping targetName="internetFunctionID" sourceAttrName="*/internet/@ID" />
        </RequestTemplate>
        
        <!-- createCustomer -->
        <RequestTemplate fif-request-name="createCustomer" sourceWorkingPath="/order/customerData/customer" extends="entityCreation_template">
            <RPMapping targetName="parentCustomerNumber" sourceAttrName="ownerCcbId/*" />
            <RPMapping targetName="riskCategory" sourceAttrName="riskCategory/configured" />
            <RPMapping targetName="userPassword" sourceAttrName="userPassword/configured" />
            <RPMapping targetName="matchCodeId" sourceAttrName="matchCodeId/configured" />
            <RPMapping targetName="customerGroup" sourceAttrName="customerGroup/configured" />
            <RPMapping targetName="customerCategory" sourceAttrName="customerCategory/configured" />
            <RPMapping targetName="customerClassification" sourceAttrName="classification/configured" />
            <RPMapping targetName="customerInternalRefNumber" sourceAttrName="customerInternalRefNumber/configured" />
            <RPMapping targetName="marketingPhoneIndicator" sourceAttrName="marketingPhoneIndicator/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="marketingMailIndicator" sourceAttrName="marketingMailIndicator/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="marketingFaxIndicator" sourceAttrName="marketingFaxIndicator/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="marketingUseDataIndicator" sourceAttrName="marketingUseDataIndicator/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="postIdentIndicator" sourceAttrName="postIdentIndicator/configured" decoding="'true','Y','N'" />
            <RPMapping targetName="billingAccountNumber" sourceAttrName="billingAccountNumber/configured" />
            <RPMapping targetName="cdrEgnFormat" sourceAttrName="cdrEgnFormat/configured" />
          <RPMapping targetName="allocatedCustomerNumber" sourceAttrName="/*/*/beneficiary[@role='target']/ccbId[@type='C']" />
            <RPMapping targetName="marketingAuthorizationDate" sourceAttrName="marketingAuthorizationDate/configured" formatter="SOMToCCBDateFormatter" />
            <RPListTemplate listName="affinityGroupList">
                <RPListItemTemplate sourceWorkingPath="affinityGroupList/configured/affinityGroup">
                    <RPMapping sourceAttrName="." targetName="affinityGroup" />
                </RPListItemTemplate>
            </RPListTemplate>
        </RequestTemplate>
        
        <RequestTemplate fif-request-name="createBillingAccount" sourceWorkingPath="/order/customerData/billingAccount" extends="entityCreation_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsExisting sourceAttrName="../customer[@ID='${@ownerNodeRefID}']" />
                    <base:IsExisting sourceAttrName="../customer/ccbId[@type='C'][existing='${ownerCcbId/configured}']" />
                </OrComposite>
            </TemplateConditions>
            
            <!-- customer number either from ownerCcbId -->
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="ownerCcbId/configured" />
                </TemplateConditions>
                <RPMapping targetName="customerNumber" sourceAttrName="ownerCcbId/configured" />
            </TransformationTemplate>
            <!-- or from ownerNodeRefID -->
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="ownerCcbId/configured" />
                </TemplateConditions>
                <RPMapping targetName="customerNumber" sourceAttrName="../customer[@ID='${@ownerNodeRefID}']/ccbId[@type='C']/existing" />
            </TransformationTemplate>
            
            <RPMapping targetName="bankAccountNumber" sourceAttrName="methodOfPayment/bankAccountNumber/configured" />
            <RPMapping targetName="ownerFullName" sourceAttrName="methodOfPayment/owner/configured" />
            <RPMapping targetName="bankClearingCode" sourceAttrName="methodOfPayment/bankCode/configured" />
            <RPMapping targetName="directDebitAuthorizDate" sourceAttrName="methodOfPayment/directDebitAuthorizationDate/configured" formatter="SOMToCCBDateFormatter" />
            <RPMapping targetName="paymentMethod" sourceAttrName="methodOfPayment/paymentMethod/configured" />
            <RPMapping targetName="paymentTerm" sourceAttrName="methodOfPayment/paymentTerm/configured" />
            
            <RPMapping targetName="mailingPrinterDestination" sourceAttrName="mailing/mailingPrinterDestination/configured" />
            <RPMapping targetName="mailingName" sourceAttrName="mailing/mailingName/configured" />
            <RPMapping targetName="mailingDocumentType" sourceAttrName="mailing/mailingDocumentType/configured" />
            <RPMapping targetName="docTemplateName" sourceAttrName="/order/customerData/customer/classification/configured" decoding="'VE', 'Vodafone PK-Rechnung', 'VC', 'VF Rechnung', 
                'D', 'Privatkunden Rechnung', 'E', 'Privatkunden Rechnung', 'Rechnung'" />
        </RequestTemplate>
                
        <RequestTemplate fif-request-name="setInvoiceDeliveryType" sourceWorkingPath="/order/customerData/billingAccount" extends="masterdata_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsExisting sourceAttrName="../customer[@ID='${@ownerNodeRefID}']" />
                    <base:IsExisting sourceAttrName="../customer/ccbId[@type='C'][existing='${ownerCcbId/configured}']" />
                </OrComposite>
            </TemplateConditions>
            <RPMapping targetName="deliveryType" sourceAttrName="invoiceDelivery/invoiceDeliveryType/configured" />
            <RPMapping targetName="maskingDigits" sourceAttrName="invoiceDelivery/maskingDigits/configured" />
            <RPMapping targetName="enableEgn" sourceAttrName="invoiceDelivery/enableItemizedBill/configured" />
        </RequestTemplate>
        
        <!-- contractPartnerChange, most is done in the abstract template -->
        <RequestTemplate fif-request-name="changeContractPartner" extends="base_productChange_template" sourceWorkingPath="/order/contractPartnerChange">
            <TemplateConditions>
                <base:IsExisting sourceAttrName="/order/contractPartnerChange" />
            </TemplateConditions>
            
            <RPMapping targetName="sourceCustomerNumber" sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
            <RPMapping targetName="targetCustomerNumber" sourceAttrName="beneficiary[@role='target']/ccbId[@type='C']" />
            
            <RPMapping targetName="targetOMTSOrderID" sourceAttrName="parentBarcode" />
            <RPMapping targetName="sourceOMTSOrderID" sourceAttrName="/order/@orderID" />
            
            <RPMapping targetName="voiceFunctionID" sourceAttrName="*/voice[processingType != 'TERM']/@ID" />
            <RPMapping targetName="internetFunctionID" sourceAttrName="*/internet/@ID" />
        </RequestTemplate>
        
        <!-- hardware service for voice function -->
        <RequestTemplate fif-request-name="addHardwareService" 
            sourceWorkingPath="/*/providerChange/*/hardware | /*/contractPartnerChange/*/hardware" 
            extends="base_executevalidate_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="ADD" sourceAttrName="processingType" />
                    <base:IsMember value="CHANGE" sourceAttrName="processingType" />
                </OrComposite>
            </TemplateConditions>
            
            <RPMapping sourceAttrName="refFunctionID/*" targetName="type" />
            <RPMapping targetName="hardwareServiceCode" sourceAttrName="hardwareConfiguration/hardwareServiceCode/*" />
            <RPMapping targetName="shippingCosts" sourceAttrName="*/shippingCosts/*" />
            <RPMapping targetName="orderReason" sourceAttrName="*/orderReason/*" />
            <RPMapping targetName="articleNumber" sourceAttrName="*/articleNumber/*" />
            <RPMapping targetName="articleName" sourceAttrName="*/articleName/*" />
            <RPMapping targetName="subventionIndicator" sourceAttrName="*/subventionIndicator/*" />
            <RPMapping targetName="hardwareDeliverySalutation" sourceAttrName="*/salutationDescription/*" />
            <RPMapping targetName="hardwareDeliveryForename" sourceAttrName="*/forename/*" />
            <RPMapping targetName="hardwareDeliverySurname" sourceAttrName="*/name/*" />
            <RPMapping targetName="hardwareDeliveryCity" sourceAttrName="*/hardwareMailingAddress/*/city" />
            <RPMapping targetName="hardwareDeliveryPostalCode" sourceAttrName="*/hardwareMailingAddress/*/postalCode" />
            <RPMapping targetName="hardwareDeliveryStreet" sourceAttrName="*/hardwareMailingAddress/*/street" />
            <RPMapping targetName="hardwareDeliveryNumber" sourceAttrName="*/hardwareMailingAddress/*/streetNumber" />
            <RPMapping targetName="hardwareDeliveryNumberSuffix" sourceAttrName="*/hardwareMailingAddress/*/streetNumberSuffix" />
        </RequestTemplate>

        <!-- tariff options -->
        <RequestTemplate fif-request-name="setDesiredTariffOption" 
            sourceWorkingPath="/*/providerChange/*/*/*/tariffOptionsList/* | /*/changeContractPartner/*/*/*/tariffOptionsList/*" 
            extends="base_executevalidate_template">
            <RPMapping sourceAttrName="../../../@ID" targetName="type" />
            <RPListTemplate listName="newTariffOptionServiceCodeList">
                <RPListItemTemplate sourceWorkingPath="serviceCode">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
        </RequestTemplate>
        
        <!-- country services -->
        <RequestTemplate fif-request-name="setDesiredCountries" 
            sourceWorkingPath="/*/providerChange/*/*/*/desiredCountriesList/* | /*/changeContractPartner/*/*/*/desiredCountriesList/*" 
            extends="base_executevalidate_template">
            <RPMapping sourceAttrName="../../../@ID" targetName="type" />
            <RPListTemplate listName="newCountriesServiceCodeList">
                <RPListItemTemplate sourceWorkingPath="*">
                    <RPMapping sourceAttrName="." targetName="serviceCode" />
                </RPListItemTemplate>
            </RPListTemplate>
        </RequestTemplate>
        
        <RequestTemplate fif-request-name="addFeatureService" sourceWorkingPath="
            /*/providerChange/*/*/*/chargesAndCreditsList/*/* | /*/providerChange/*/*/*/featuresList/*/* | 
            /*/changeContractPartner/*/*/*/chargesAndCreditsList/*/* | /*/changeContractPartner/*/*/*/featuresList/*/*" 
            extends="base_executevalidate_template">
            <RPMapping sourceAttrName="../../../../@ID" targetName="type" />
            <RPMapping targetName="featureServiceCode" sourceAttrName="." />
        </RequestTemplate>
        
        <RequestTemplate fif-request-name="addConditionService" 
            sourceWorkingPath="/*/providerChange/*/*/*/conditionsList/*/* | /*/changeContractPartner/*/*/*/conditionsList/*/*" 
            extends="base_executevalidate_template">
            <RPMapping sourceAttrName="../../../../@ID" targetName="type" />
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="CO" sourceAttrName="conditionServiceType" />
                </TemplateConditions>
                <RPMapping targetName="oneTimeCondition" sourceAttrName="conditionServiceName" />
                <RPMapping targetName="oneTimeConditionId" sourceAttrName="conditionServiceID" />
            </TransformationTemplate>
            
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsMember value="CM" sourceAttrName="conditionServiceType" />
                </TemplateConditions>
                <RPMapping targetName="monthlyCondition" sourceAttrName="conditionServiceName" />
                <RPMapping targetName="monthlyConditionId" sourceAttrName="conditionServiceID" />
            </TransformationTemplate>
        </RequestTemplate>

        <RequestTemplate fif-request-name="createSafetyPackage" 
            sourceWorkingPath="/*/providerChange/*/safetyPackage | /*/changeContractPartner/*/safetyPackage" 
            extends="base_executevalidate_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="CHANGE" sourceAttrName="processingType" />
                    <base:IsMember value="ADD" sourceAttrName="processingType" />
                </OrComposite>
            </TemplateConditions>
            
            <RPMapping sourceAttrName="/*/*/*/voice[processingType != 'TERM']/@ID" targetName="type" />
            <RPMapping targetName="OMTSOrderID" sourceAttrName="/*/*/parentBarcode" />
            <RPMapping targetName="tariff" sourceAttrName="*/pricingStructureCode/configured" />
        </RequestTemplate>
        
        <RequestTemplate fif-request-name="createDirectoryEntry" 
            sourceWorkingPath="/*/providerChange/*/directoryEntry | /*/changeContractPartner/*/directoryEntry" 
            extends="base_executevalidate_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember value="CHANGE" sourceAttrName="processingType" />
                    <base:IsMember value="ADD" sourceAttrName="processingType" />
                </OrComposite>
            </TemplateConditions>
            
            <RPMapping sourceAttrName="/*/*/*/voice[processingType != 'TERM']/@ID" targetName="type" />
            <RPMapping targetName="OMTSOrderID" sourceAttrName="/*/*/parentBarcode" />
            <RPMapping targetName="providerTrackingNumber" staticValue="003t" />
            
            <RPMapping targetName="name" sourceAttrName="*/directoryEntryListedData/*/name" />
            <RPMapping targetName="forename" sourceAttrName="*/directoryEntryListedData/*/forename" />
            <RPMapping targetName="nobilityPrefixDescription" sourceAttrName="*/directoryEntryListedData/*/nobilityPrefixDescription" />
            <RPMapping targetName="titleDescription" sourceAttrName="*/directoryEntryListedData/*/titleDescription" />
            <RPMapping targetName="surnamePrefix" sourceAttrName="*/directoryEntryListedData/*/surnamePrefix" />
            <RPMapping targetName="profession" sourceAttrName="*/directoryEntryListedData/*/profession" />
            <RPMapping targetName="industrialSectorRd" sourceAttrName="*/directoryEntryListedData/*/industrialSectorRd" />
            <RPMapping targetName="additionalText" sourceAttrName="*/directoryEntryListedData/*/listedAddress/additionalAddressDescription" />
            <RPMapping targetName="streetName" sourceAttrName="*/directoryEntryListedData/*/listedAddress/street" />
            <RPMapping targetName="streetNumber" sourceAttrName="*/directoryEntryListedData/*/listedAddress/streetNumber" />
            <RPMapping targetName="numberSuffix" sourceAttrName="*/directoryEntryListedData/*/listedAddress/streetNumberSuffix" />
            <RPMapping targetName="postalCode" sourceAttrName="*/directoryEntryListedData/*/listedAddress/postalCode" />
            <RPMapping targetName="city" sourceAttrName="*/directoryEntryListedData/*/listedAddress/city" />
            <RPMapping targetName="directoryEntryType" sourceAttrName="*/directoryEntryType/*" />
            <RPMapping targetName="inverseSearchIndicator" sourceAttrName="*/inverseSearchIndicator/*" decoding="'true','J','N'" />
            
            <RPMapping sourceAttrName="*/directoryEntryListedData/*/listedPhoneNumber/*/countryCode" targetName="countryCode" />
            <RPMapping sourceAttrName="*/directoryEntryListedData/*/listedPhoneNumber/*/localAreaCode" targetName="areaCode" />
            <RPMapping sourceAttrName="*/directoryEntryListedData/*/listedPhoneNumber/*/pilotNumber" targetName="localNumber" />
        </RequestTemplate>
        
        <RequestTemplate fif-request-name="createOnlineContract" 
            sourceWorkingPath="/*/providerChange/*/internet | /*/changeContractPartner/*/internet" 
            extends="base_executevalidate_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsExisting sourceAttrName="/order/*/functions/internet[@targetAccessID=../../accesses/isdn/@ID]" />
                    <AndComposite>
                        <base:IsNotExisting sourceAttrName="/order/*/functions/internet[@targetAccessID=../../accesses/*/@ID]" />
                        <base:IsExisting sourceAttrName="/order/*/functions/internet[@refAccessID=../../accesses/isdn/@ID]" />
                    </AndComposite>
                </OrComposite>
                <OrComposite>
                    <base:IsMember value="CHANGE" sourceAttrName="processingType" />
                    <base:IsMember value="ADD" sourceAttrName="processingType" />
                </OrComposite>
            </TemplateConditions>
            
            <RPMapping targetName="OMTSOrderID" sourceAttrName="../../parentBarcode" />
            <RPMapping targetName="tariffOnline" sourceAttrName="internetConfiguration/pricingStructureCode/configured" />
            <RPMapping staticValue="PROVIDER_CHANGE" targetName="reasonRd" />
            <RPMapping targetName="dueDate" sourceAttrName="/order/changeContractPartner/desiredDate" formatter="SOMToCCBDateFormatter" />
            <RPMapping targetName="salesOrganisationNumber" sourceAttrName="/order/salesOrganisation/salesOrganisationNumber[@type='V']" />
            <RPMapping targetName="salesOrganisationNumberVF" staticValue="" />
            
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsExisting sourceAttrName="/*/*/*/voice/@targetAccessID" />
                </TemplateConditions>
                <RPMapping targetName="voiceFunctionID" sourceAttrName="/*/*/*/voice[@targetAccessID='${/*/*/*/isdn/@ID}']/@ID" />
            </TransformationTemplate>
            <TransformationTemplate>
                <TemplateConditions>
                    <base:IsNotExisting sourceAttrName="/*/*/*/voice/@targetAccessID" />
                </TemplateConditions>
                <RPMapping targetName="voiceFunctionID" sourceAttrName="/*/*/*/voice[@refAccessID='${/*/*/*/isdn/@ID}']/@ID" />
            </TransformationTemplate>
        </RequestTemplate>
      
      <!-- TODO creation of TVCenter-->
        
        <RequestTemplate fif-request-name="terminateService" 
            sourceWorkingPath="/*/providerChange/*/internet | /*/changeContractPartner/*/internet" 
            extends="base_productChangeTermination_template">
            <TemplateConditions>
                <OrComposite>
                    <base:IsExisting sourceAttrName="/order/*/functions/internet[@refAccessID=../../accesses/isdn/@ID]" />
                    <base:IsExisting sourceAttrName="/order/*/functions/internet[@refAccessID=../../accesses/preselection/@ID]" />
                </OrComposite>
            </TemplateConditions>
            <RPMapping staticValue="Simple" targetName="terminationType" />
        </RequestTemplate>
        
        <!-- terminate iptv and VOD -->
        <RequestTemplate fif-request-name="terminateService" 
            sourceWorkingPath="/*/providerChange/*/iptv | /*/providerChange/*/vod |
                /*/changeContractPartner/*/iptv | /*/changeContractPartner/*/vod" 
            extends="base_productChangeTermination_template">
            <RPMapping staticValue="Complex" targetName="terminationType" />
            <!-- TODO wird das gebraucht? -->
            <RPMapping staticValue="Y" targetName="terminateNGNIndicator" />
        </RequestTemplate>
        
        <!-- termination of Mobile contracts for provider change -->
        <RequestTemplate fif-request-name="terminateService" 
            extends="base_productChangeTermination_template" 
            sourceWorkingPath="/*/providerChange/*/voice | /*/changeContractPartner/*/voice">
            <TemplateConditions>
                <OrComposite>
                    <base:IsMember sourceAttrName="productCode/existing" value="V8000" />
                    <base:IsMember sourceAttrName="productCode/existing" value="VI201" />
                </OrComposite>
            </TemplateConditions>
            <RPMapping staticValue="Complex" targetName="terminationType" />
        </RequestTemplate>
        
        <!-- simple terminations: safetyPackage, Discounts -->
        <RequestTemplate fif-request-name="terminateService" 
            extends="base_productChangeTermination_template" 
            sourceWorkingPath="/*/providerChange/*/safetyPackage | /*/providerChange/discount | 
                /*/changeContractPartner/*/safetyPackage | /*/changeContractPartner/discount">
            <RPMapping staticValue="Simple" targetName="terminationType" />
        </RequestTemplate>
        
        <!-- complex terminations: PC Backup, MS Online Suite -->
        <RequestTemplate fif-request-name="terminateService" 
            extends="base_productChangeTermination_template" 
            sourceWorkingPath="/*/providerChange/*/msOnlineSuite | /*/providerChange/*/pcBackup | 
                /*/changeContractPartner/*/msOnlineSuite | /*/changeContractPartner/*/pcBackup">
            <RPMapping staticValue="Complex" targetName="terminationType" />
        </RequestTemplate>
        
        <!-- TODO termination of TVCenter--> 

      <!-- ***************************************************************************************** -->

      <!-- terminations -->

      <!-- termination of non-preselect voice function, i.e. ISDN, NGN, Bitstream or Mobile -->
      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/voice">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
          <base:IsNotExisting sourceAttrName="/order/termination/functions/voice[@refAccessID=../../accesses/preselection/@ID]" />
        </TemplateConditions>
        <RPMapping staticValue="Complex" targetName="terminationType" />
        <TransformationTemplate>
          <TemplateConditions>
            <OrComposite>
              <base:IsExisting sourceAttrName="portingPhoneNumbers/phoneNumber/configured" />
              <base:IsMember sourceAttrName="/order/termination/terminationReasonCode" value="ABWR" />
            </OrComposite>
          </TemplateConditions>
          <RPListTemplate listName="portAccessNumberList">
            <RPListItemTemplate sourceWorkingPath="portingPhoneNumbers/phoneNumber/configured">
              <RPMapping sourceAttrName="countryCode" targetName="countryCode" />
              <RPMapping sourceAttrName="localAreaCode" targetName="areaCode" />
              <RPMapping sourceAttrName="pilotNumber" targetName="localNumber" />
            </RPListItemTemplate>
          </RPListTemplate>
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsNotExisting sourceAttrName="portingPhoneNumbers/phoneNumber/configured" />
            <base:IsNotMember sourceAttrName="/order/termination/terminationReasonCode" value="ABWR" />
          </TemplateConditions>
        </TransformationTemplate>
        <!-- IT-k-26159: different orderVariant for IP Bitstream -->
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember sourceAttrName="productCode/existing" value="VI203" />
            <base:IsExisting sourceAttrName="/order/termination/newCarrier/configured" />
          </TemplateConditions>
          <RPMapping staticValue="Kündigung Providerwechsel" targetName="orderVariant" />
        </TransformationTemplate>
      </RequestTemplate>

      <!-- voice termination for preselect (simple termination) -->
      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/voice">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
          <base:IsExisting sourceAttrName="/order/termination/functions/voice[@refAccessID=../../accesses/preselection/@ID]" />
        </TemplateConditions>
        <RPMapping staticValue="Simple" targetName="terminationType" />
      </RequestTemplate>

      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/internet">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
          <base:IsExisting sourceAttrName="/order/termination/accesses/*" />
          <base:IsNotExisting sourceAttrName="/order/termination/functions/internet[@refAccessID=../../accesses/isdn/@ID]" />
          <base:IsNotExisting sourceAttrName="/order/termination/functions/internet[@refAccessID=../../accesses/preselection/@ID]" />
        </TemplateConditions>
        <RPMapping staticValue="Complex" targetName="terminationType" />
        <!-- IT-k-26159: different orderVariant for IP Bitstream -->
        <TransformationTemplate>
          <TemplateConditions>
            <OrComposite>
              <base:IsMember sourceAttrName="productCode/existing" value="I1203" />
              <base:IsMember sourceAttrName="productCode/existing" value="I1201" />
            </OrComposite>
            <base:IsExisting sourceAttrName="/order/termination/newCarrier/configured" />
          </TemplateConditions>
          <RPMapping staticValue="Kündigung Providerwechsel" targetName="orderVariant" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember sourceAttrName="productCode/existing" value="I1201" />
            <OrComposite>
              <base:IsMember sourceAttrName="/order/termination/terminationReasonCode" value="UMZN" />
              <base:IsMember sourceAttrName="/order/termination/terminationReasonCode" value="ZTCOM" />
            </OrComposite>
            <base:IsNotExisting sourceAttrName="/order/termination/newCarrier/configured" />
          </TemplateConditions>
          <RPMapping staticValue="Kündigung T-Com" targetName="orderVariant" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember sourceAttrName="productCode/existing" value="I1201" />
            <AndComposite>
              <base:IsNotMember sourceAttrName="/order/termination/terminationReasonCode" value="ZTCOM" />
              <base:IsNotMember sourceAttrName="/order/termination/terminationReasonCode" value="UMZN" />
            </AndComposite>
            <base:IsNotExisting sourceAttrName="/order/termination/newCarrier/configured" />
          </TemplateConditions>
          <RPMapping staticValue="Kündigung Arcor" targetName="orderVariant" />
        </TransformationTemplate>
      </RequestTemplate>

      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/internet">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
          <OrComposite>
            <base:IsNotExisting sourceAttrName="/order/termination/accesses/*" />
            <base:IsExisting sourceAttrName="/order/termination/functions/internet[@refAccessID=../../accesses/isdn/@ID]" />
            <base:IsExisting sourceAttrName="/order/termination/functions/internet[@refAccessID=../../accesses/preselection/@ID]" />
          </OrComposite>
        </TemplateConditions>
        <RPMapping staticValue="Simple" targetName="terminationType" />
      </RequestTemplate>

      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/iptv|/order/termination/functions/vod">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
        </TemplateConditions>
        <RPMapping staticValue="Complex" targetName="terminationType" />
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsMember sourceAttrName="/order/termination/functions/internet/processingType" value="TERM" />
          </TemplateConditions>
          <RPMapping staticValue="Y" targetName="terminateNGNIndicator" />
        </TransformationTemplate>
      </RequestTemplate>

      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/safetyPackage|/order/termination/discount">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
        </TemplateConditions>
        <RPMapping staticValue="Simple" targetName="terminationType" />
      </RequestTemplate>

      <RequestTemplate fif-request-name="terminateService" extends="base_terminateService_template" sourceWorkingPath="/order/termination/functions/msOnlineSuite|/order/termination/pcBackup">
        <TemplateConditions>
          <base:IsMember sourceAttrName="processingType" value="TERM" />
        </TemplateConditions>
        <RPMapping staticValue="Complex" targetName="terminationType" />
      </RequestTemplate>

      <RequestTemplate fif-request-name="createExternalOrder" sourceWorkingPath="/order/*">
        <TemplateConditions>
          <base:IsMember value="create" sourceAttrName="transactionType" />
        </TemplateConditions>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsExisting sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
          </TemplateConditions>
          <RPMapping targetName="customerNumber" sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsNotExisting sourceAttrName="beneficiary[@role='default']/ccbId[@type='C']" />
          </TemplateConditions>
          <RPMapping targetName="customerNumber" sourceAttrName="beneficiary/ccbId[@type='C']" />
        </TransformationTemplate>
        <RPMapping targetName="customerIntention" sourceAttrName="customerIntention" />

        <RPListTemplate listName="serviceSubscriptionIdList">
          <RPListItemTemplate sourceWorkingPath="functions/*/ccbId[@type='S']">
            <TransformationTemplate>
              <TemplateConditions>
                <base:IsNotMember value="IGNORE" sourceAttrName="../processingType" />
                <base:IsExisting sourceAttrName="configured" />
              </TemplateConditions>
              <RPMapping sourceAttrName="configured" targetName="serviceSubscriptionId" />
            </TransformationTemplate>
            <TransformationTemplate>
              <TemplateConditions>
                <base:IsNotMember value="IGNORE" sourceAttrName="../processingType" />
                <base:IsNotExisting sourceAttrName="configured" />
              </TemplateConditions>
              <RPMapping sourceAttrName="existing" targetName="serviceSubscriptionId" />
            </TransformationTemplate>
          </RPListItemTemplate>
        </RPListTemplate>
      </RequestTemplate>
      <RequestTemplate fif-request-name="closeExternalOrder" sourceWorkingPath="/order/*">
        <TemplateConditions>
          <OrComposite>
            <base:IsMember value="close-cancel" sourceAttrName="transactionType" />
            <base:IsMember value="close-final" sourceAttrName="transactionType" />
            <base:IsMember value="close-abort" sourceAttrName="transactionType" />
          </OrComposite>
        </TemplateConditions>
        <RPMapping targetName="closeReason" sourceAttrName="transactionType" />
      </RequestTemplate>

      <RequestTemplate fif-request-name="terminateServiceCancellation" extends="base_terminateServiceCancellation_template" sourceWorkingPath="/order/termination/functions/voice">
        <TemplateConditions>
          <base:IsMember value="V0001" sourceAttrName="productCode/existing" />
        </TemplateConditions>
      </RequestTemplate>
      <RequestTemplate fif-request-name="terminateServiceCancellation" extends="base_terminateServiceCancellation_template" sourceWorkingPath="/order/termination/functions/internet">
        <TemplateConditions>
          <base:IsMember value="I1100" sourceAttrName="productCode/existing" />
        </TemplateConditions>
      </RequestTemplate>
      <RequestTemplate fif-request-name="terminateServiceCancellation" extends="base_terminateServiceCancellation_template" sourceWorkingPath="/order/termination/functions/safetyPackage|/order/termination/discount">
      </RequestTemplate>

    </RequestListTemplate>
  </RootTemplate>

  <BaseTemplates>
    <AbstractTransformationTemplate ID="base_executevalidate_template">
      <TemplateConditions>
        <OrComposite>
          <base:IsMember value="validate" sourceAttrName="/order/*/transactionType" />
          <base:IsMember value="execute" sourceAttrName="/order/*/transactionType" />
        </OrComposite>
      </TemplateConditions>
    </AbstractTransformationTemplate>

    <AbstractTransformationTemplate ID="base_terminateService_template" extends="base_executevalidate_template">
      <TemplateConditions>
        <OrComposite>
          <base:IsMember sourceAttrName="/order/termination/customerIntention" value="Termination" />
          <base:IsMember sourceAttrName="/order/termination/customerIntention" value="Relocation" />
        </OrComposite>
      </TemplateConditions>

      <RPMapping targetName="threePartyProcess" sourceAttrName="/order/termination/threePartyProcess" decoding="'true','Ja','Nein'" />

      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="portingPhoneNumbers/portingCarrier/configured" />
        </TemplateConditions>
        <RPMapping targetName="carrier" sourceAttrName="portingPhoneNumbers/portingCarrier/configured" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsNotExisting sourceAttrName="portingPhoneNumbers/portingCarrier/configured" />
        </TemplateConditions>
        <RPMapping targetName="carrier" sourceAttrName="/order/termination/newCarrier/configured" />
      </TransformationTemplate>

      <RPMapping targetName="productCode" sourceAttrName="productCode/existing" />
      <RPMapping targetName="serviceSubscriptionId" sourceAttrName="ccbId[@type='S']/existing" />
      <RPMapping targetName="contractNumber" sourceAttrName="contractNumber/existing" />
      <RPMapping targetName="terminationFeeServiceCode" sourceAttrName="fee/configured" />

      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="portingPhoneNumbers/phoneNumber/configured" />
        </TemplateConditions>
        <RPMapping staticValue="ABWR" targetName="terminationReason" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsNotExisting sourceAttrName="portingPhoneNumbers/phoneNumber/configured" />
        </TemplateConditions>
        <RPMapping targetName="terminationReason" sourceAttrName="/order/termination/terminationReasonCode" />
      </TransformationTemplate>

      <RPMapping targetName="customerNumber" sourceAttrName="/order/termination/beneficiary/ccbId[@type='C']" />
      <RPMapping targetName="noticePeriodStartDate" sourceAttrName="/order/termination/orderReceivedDate" formatter="SOMToCCBDateFormatter" />
      <RPMapping targetName="terminationDate" sourceAttrName="/order/termination/desiredDate" formatter="SOMToCCBDateFormatter" />
    </AbstractTransformationTemplate>

      <AbstractTransformationTemplate ID="base_productChangeTermination_template" extends="base_executevalidate_template">
          <TemplateConditions>
              <OrComposite>
                  <base:IsMember sourceAttrName="processingType" value="TERM" />
                  <base:IsMember sourceAttrName="processingType" value="CHANGE" />
              </OrComposite>
          </TemplateConditions>
          <RPMapping targetName="productCode" sourceAttrName="productCode/existing" />          
          <RPMapping targetName="terminationReason" 
              sourceAttrName="name(../..)" 
              decoding="'providerChange', 'AGKPW', 'contractPartnerChange', 'VPW'" />          
          <RPMapping targetName="serviceSubscriptionId" sourceAttrName="ccbId[@type='S']/existing" />
          <RPMapping targetName="contractNumber" sourceAttrName="contractNumber/existing" />
          <RPMapping targetName="customerNumber" sourceAttrName="/order/*/beneficiary[@role='default']/ccbId[@type='C']" />
          <RPMapping targetName="terminationFeeServiceCode" sourceAttrName="fee/configured" />
          <RPMapping targetName="terminationDate" sourceAttrName="/order/*/desiredDate" formatter="SOMToCCBDateFormatter" />
          <RPMapping targetName="noticePeriodStartDate" sourceAttrName="/order/*/orderReceivedDate" formatter="SOMToCCBDateFormatter" />
      </AbstractTransformationTemplate>
      
    <!-- abstract template for all product change scenarios: Umzug, VPW, PW, TW, upgrade, downgrade -->
    <AbstractTransformationTemplate ID="base_productChange_template" extends="base_executevalidate_template">
      <TemplateConditions>
        <OrComposite>
          <base:IsExisting sourceAttrName="functions/voice[@refAccessID=../../accesses/isdn/@ID]" />
          <base:IsExisting sourceAttrName="functions/voice[@refAccessID=../../accesses/ngn/@ID]" />
        </OrComposite>
      </TemplateConditions>

      <!-- targetTechnology mapping -->
      <TransformationTemplate>
        <TemplateConditions>
          <OrComposite>
            <base:IsExisting sourceAttrName="/*/*/*/isdn[@ID='${*/voice/@targetAccessID}'" />
            <AndComposite>
              <base:IsNotExisting sourceAttrName="*/voice/@targetAccessID" />
              <base:IsExisting sourceAttrName="/*/*/*/isdn[@ID='${*/voice/@refAccessID}'" />
            </AndComposite>
          </OrComposite>
        </TemplateConditions>
        <RPMapping staticValue="ISDN" targetName="targetTechnology" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <OrComposite>
            <base:IsExisting sourceAttrName="/*/*/*/ngn[@ID='${*/voice/@targetAccessID}'" />
            <AndComposite>
              <base:IsNotExisting sourceAttrName="*/voice/@targetAccessID" />
              <base:IsExisting sourceAttrName="/*/*/*/ngn[@ID='${*/voice/@refAccessID}'" />
            </AndComposite>
          </OrComposite>
        </TemplateConditions>
        <RPMapping staticValue="NGN" targetName="targetTechnology" />        
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsExisting sourceAttrName="*/internet/*/pricingStructureCode/configured" />
          </TemplateConditions>
          <RPMapping targetName="tariffDSL" sourceAttrName="*/internet/*/pricingStructureCode/configured" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsNotExisting sourceAttrName="*/internet/*/pricingStructureCode/configured" />
          </TemplateConditions>
          <RPMapping targetName="tariffDSL" sourceAttrName="*/internet/pricingStructureCode/existing" />
        </TransformationTemplate>        
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <OrComposite>
            <base:IsExisting sourceAttrName="/*/*/*/ipBitstream[@ID='${*/voice/@targetAccessID}'" />
            <AndComposite>
              <base:IsNotExisting sourceAttrName="*/voice/@targetAccessID" />
              <base:IsExisting sourceAttrName="/*/*/*/ipBitstream[@ID='${*/voice/@refAccessID}'" />
            </AndComposite>
          </OrComposite>
        </TemplateConditions>
        <RPMapping staticValue="BitStream" targetName="targetTechnology" />        
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsExisting sourceAttrName="*/internet/*/pricingStructureCode/configured" />
          </TemplateConditions>
          <RPMapping targetName="tariffDSL" sourceAttrName="*/internet/*/pricingStructureCode/configured" />
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsNotExisting sourceAttrName="*/internet/*/pricingStructureCode/configured" />
          </TemplateConditions>
          <RPMapping targetName="tariffDSL" sourceAttrName="*/internet/pricingStructureCode/existing" />
        </TransformationTemplate>
      </TransformationTemplate>

      <!-- current technology -->
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="*/isdn[@ID='${functions/voice/@refAccessID}']" />
        </TemplateConditions>
        <RPMapping staticValue="ISDN" targetName="currentTechnology" />
        <RPMapping targetName="serviceSubscriptionId" sourceAttrName="*/voice/ccbId[@type='S']/existing" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="*/ngn[@ID='${functions/voice/@refAccessID}']" />
        </TemplateConditions>
        <RPMapping staticValue="NGN" targetName="currentTechnology" />
        <RPMapping targetName="serviceSubscriptionId" sourceAttrName="*/internet/ccbId[@type='S']/existing" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="*/ipBitstream[@ID='${functions/voice/@refAccessID}']" />
        </TemplateConditions>
        <RPMapping staticValue="BitStream" targetName="currentTechnology" />
        <RPMapping targetName="serviceSubscriptionId" sourceAttrName="*/internet/ccbId[@type='S']/existing" />
      </TransformationTemplate>
      
      <!-- current product type -->
      <RPMapping targetName="currentProductType" 
        sourceAttrName="functions/voice/serviceCode/existing" 
        decoding="'V0003','Basis','VI002','Basis','VI009','Basis','Premium'" />
      
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="functions/voice/*/pricingStructureCode/configured" />
        </TemplateConditions>
        <RPMapping targetName="tariffVoice" sourceAttrName="functions/voice/*/pricingStructureCode/configured" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsNotExisting sourceAttrName="functions/voice/*/pricingStructureCode/configured" />
        </TemplateConditions>
        <RPMapping targetName="tariffVoice" sourceAttrName="functions/voice/pricingStructureCode/existing" />
      </TransformationTemplate>
      
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsNotExisting sourceAttrName="functions/voice/voicePremiumConfiguration" />
          <base:IsNotExisting sourceAttrName="functions/voice/voiceBasisConfiguration" />
        </TemplateConditions>
        <RPMapping targetName="targetProductType" 
          sourceAttrName="functions/voice/serviceCode/existing" 
          decoding="'V0003','Basis','VI002','Basis','VI009','Basis','Premium'" />
        <RPMapping staticValue="Y" targetName="keepAccessNumbers" />
        <RPMapping staticValue="0" targetName="numberOfNewAccessNumbers" />        
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="functions/voice/voicePremiumConfiguration" />
        </TemplateConditions>
        <RPMapping staticValue="Premium" targetName="targetProductType" />
        <RPMapping targetName="desiredPremiumType" sourceAttrName="functions/voice/*/desiredPremiumType/configured" />
        <RPMapping targetName="allowPremiumTypeChange" sourceAttrName="functions/voice/*/allowPremiumTypeChange/configured" decoding="'true','Ja','Nein'" />
        <RPMapping targetName="keepAccessNumbers" sourceAttrName="functions/voice/*/keepOldAccessNumbers/configured" decoding="'true','Y','N'" />
        <RPMapping targetName="numberOfNewAccessNumbers" sourceAttrName="functions/voice/*/numberNewAccessNumbers/configured" />
      </TransformationTemplate>
      <TransformationTemplate>
        <TemplateConditions>
          <base:IsExisting sourceAttrName="functions/voice/voiceBasisConfiguration" />
        </TemplateConditions>
        <RPMapping staticValue="Basis" targetName="targetProductType" />
        <RPMapping targetName="keepAccessNumbers" sourceAttrName="functions/voice/*/keepOldAccessNumbers/configured" decoding="'true','Y','N'" />

        <TransformationTemplate>
          <TemplateConditions>
            <base:IsExisting sourceAttrName="functions/voice/voiceBasisConfiguration/selectedAccessNumber/configured/pilotNumber" />
          </TemplateConditions>
          <RPMapping staticValue="0" targetName="numberOfNewAccessNumbers" />
          <RPListTemplate listName="accessNumberList">
            <RPListItemTemplate sourceWorkingPath="functions/voice/voiceBasisConfiguration/selectedAccessNumber">
              <RPMapping sourceAttrName="configured/countryCode" targetName="countryCode" />
              <RPMapping sourceAttrName="configured/localAreaCode" targetName="areaCode" />
              <RPMapping sourceAttrName="configured/pilotNumber" targetName="localNumber" />
            </RPListItemTemplate>
          </RPListTemplate>
        </TransformationTemplate>
        <TransformationTemplate>
          <TemplateConditions>
            <base:IsNotExisting sourceAttrName="functions/voice/voiceBasisConfiguration/selectedAccessNumber/configured/pilotNumber" />
          </TemplateConditions>
          <RPMapping staticValue="1" targetName="numberOfNewAccessNumbers" />
        </TransformationTemplate>

      </TransformationTemplate>

      <TransformationTemplate>
        <TemplateConditions>
          <base:IsMember value="ADD" sourceAttrName="functions/internet/processingType" />
          <base:IsMember value="CHANGE" sourceAttrName="functions/internet/processingType" />
        </TemplateConditions>

        <!-- only create DSL for the customer, if no narrowband flatrate is ordered -->
        <TransformationTemplate>
          <TemplateConditions>
            <OrComposite>
              <base:IsNotMember value="true" sourceAttrName="accesses/isdn/isdnConfiguration/narrowbandFlatrate/configured" />
            </OrComposite>
          </TemplateConditions>
          <RPMapping staticValue="Y" targetName="createDSL" />
        </TransformationTemplate>

        <!-- DSL bandwidth -->
        <RPMapping targetName="DSLBandwidth" 
          sourceAttrName="functions/internet/internetConfiguration/DSLBandwidth/configured" 
          decoding="  'V0118','DSL 1000',   'V0174','DSL 2000',   'V0178','DSL 6000',      
                    'V018C','DSL 16000',  'V018G','DSL 25000',  'V018H','DSL 50000', ''" />
        <RPMapping targetName="upstreamBandwidth" 
          sourceAttrName="functions/internet/internetConfiguration/upstreamBandwidth/configured" 
          decoding="'V0198', '384', 'Standard'" />
        <RPMapping targetName="desiredBandwidth" 
          sourceAttrName="functions/internet/internetConfiguration/desiredBandwidth/configured" 
          decoding="  'V0118','DSL 1000',   'V0174','DSL 2000',   'V0178','DSL 6000',      
                    'V018C','DSL 16000',  'V018G','DSL 25000',  'V018H','DSL 50000', ''" />
        <RPMapping targetName="allowDowngrade" 
          sourceAttrName="functions/internet/internetConfiguration/allowBandwidthDowngrade/configured" 
          decoding="'true','Ja','Nein'" />
      </TransformationTemplate>

      <RPMapping targetName="activationDate" sourceAttrName="desiredDate" formatter="SOMToCCBDateFormatter" />

      <TransformationTemplate>
        <TemplateConditions>
          <OrComposite>
            <base:IsExisting sourceAttrName="functions/voice/portingPhoneNumbers/phoneNumber/configured" />
          </OrComposite>
        </TemplateConditions>
        <RPListTemplate listName="accessNumberList">
          <RPListItemTemplate sourceWorkingPath="functions/voice/portingPhoneNumbers/phoneNumber/configured">
            <RPMapping sourceAttrName="countryCode" targetName="countryCode" />
            <RPMapping sourceAttrName="localAreaCode" targetName="areaCode" />
            <RPMapping sourceAttrName="pilotNumber" targetName="localNumber" />
          </RPListItemTemplate>
        </RPListTemplate>
      </TransformationTemplate>

    </AbstractTransformationTemplate>

    <AbstractTransformationTemplate ID="base_terminateServiceCancellation_template">
      <TemplateConditions>
        <base:IsMember value="TERM" sourceAttrName="processingType" />
        <base:IsMember value="cancel" sourceAttrName="/order/termination/transactionType" />
      </TemplateConditions>
      <RPMapping targetName="customerNumber" sourceAttrName="/order/termination/beneficiary[@role='default']/ccbId[@type='C']" />
      <RPMapping targetName="contractNumber" sourceAttrName="contractNumber/existing" />
    </AbstractTransformationTemplate>
    
      <!-- template for entity creation START -->
      <AbstractTransformationTemplate ID="entityCreation_template" extends="masterdata_template">
          <TransformationTemplate>
              <TemplateConditions>
                  <base:IsExisting sourceAttrName="organization" />
              </TemplateConditions>
              <RPMapping targetName="salutationDescription" sourceAttrName="organization/salutation/configured" />
              <RPMapping targetName="name" sourceAttrName="organization/name/configured" />
              <RPMapping targetName="organizationType" sourceAttrName="organization/organizationType/configured" />
              <RPMapping targetName="organizationSuffixName" sourceAttrName="organization/organizationSuffixName/configured" />
              <RPMapping targetName="incorporationNumber" sourceAttrName="organization/incorporationNumber/configured" />
              <RPMapping targetName="incorporationType" sourceAttrName="organization/incorporationType/configured" />
              <RPMapping targetName="incorporationCityName" sourceAttrName="organization/incorporationCityName/configured" />
          </TransformationTemplate>
          
          <TransformationTemplate>
              <TemplateConditions>
                  <base:IsExisting sourceAttrName="individual" />
              </TemplateConditions>
              <RPMapping targetName="salutationDescription" sourceAttrName="individual/salutation/configured" />
              <RPMapping targetName="name" sourceAttrName="individual/name/configured" />
              <RPMapping targetName="forename" sourceAttrName="individual/forename/configured" />
              <RPMapping targetName="titleDescription" sourceAttrName="individual/titleDescription/configured" />
              <RPMapping targetName="nobilityPrefixDescription" sourceAttrName="individual/nobilityPrefixDescription/configured" />
              <RPMapping targetName="surnamePrefix" sourceAttrName="individual/surnamePrefix/configured" />
              <RPMapping targetName="birthDate" sourceAttrName="individual/birthDate/configured" formatter="SOMToCCBDateFormatter" />
          </TransformationTemplate>
          
          <RPMapping targetName="phoneNumber" sourceAttrName="*/accessInformation/configured/phoneNumber" />
          <RPMapping targetName="contactName" sourceAttrName="*/accessInformation/configured/contactName" />
          <RPMapping targetName="mobileNumber" sourceAttrName="*/accessInformation/configured/mobileNumber" />
          <RPMapping targetName="faxNumber" sourceAttrName="*/accessInformation/configured/faxNumber" />
          <RPMapping targetName="emailAddress" sourceAttrName="*/accessInformation/configured/emailAddress" />
          <RPMapping targetName="electronicContactIndicator" sourceAttrName="*/accessInformation/configured/electronicContactIndicator" decoding="'true','Y','N'" />
          <RPMapping targetName="accessInformationTyp" sourceAttrName="*/accessInformation/configured/accessInformationType" />
          
          <RPMapping targetName="streetName" sourceAttrName="*/address/configured/street" />
          <RPMapping targetName="streetNumber" sourceAttrName="*/address/configured/streetNumber" />
          <RPMapping targetName="postalCode" sourceAttrName="*/address/configured/postalCode" />
          <RPMapping targetName="cityName" sourceAttrName="*/address/configured/city" />
          <RPMapping targetName="citySuffix" sourceAttrName="*/address/configured/citySuffix" />
          <RPMapping targetName="additionalText" sourceAttrName="*/address/configured/additionalAddressDescription" />
          <RPMapping targetName="numberSuffix" sourceAttrName="*/address/configured/streetNumberSuffix" />
          <RPMapping targetName="countryCode" sourceAttrName="*/address/configured/country" />
      </AbstractTransformationTemplate>
      <!-- template for entity creation END -->
      
      <!-- ****************************************************************** -->
      <AbstractTransformationTemplate ID="masterdata_template" extends="base_executevalidate_template">
          <TemplateConditions>
              <base:IsMember value="ADD" sourceAttrName="changeType" />
          </TemplateConditions>
          <RPMapping targetName="somElementID" sourceAttrName="@ID" />
      </AbstractTransformationTemplate>  
      
  </BaseTemplates>
</TransformationRepository>
